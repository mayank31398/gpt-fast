flash_kv_decode is set to True
Using device=cuda
Loading model ...
GPTEnsemble(
  (tok_embeddings): Embedding(128256, 4096)
  (layers): ModuleList(
    (0-31): 32 x EnsembleTransformerBlock(
      semi_compiled = False
      (attention): Attention(
        (wqkv): Linear(in_features=4096, out_features=6144, bias=False)
        (wo): Linear(in_features=4096, out_features=4096, bias=False)
      )
      (feed_forward): FeedForward(
        (w1): Linear(in_features=4096, out_features=28672, bias=False)
        (w2): Linear(in_features=14336, out_features=4096, bias=False)
      )
      (ffn_norm): RMSNorm()
      (attention_norm): RMSNorm()
    )
  )
  (norm): RMSNorm()
  (output): Linear(in_features=4096, out_features=128256, bias=False)
)
Time to load model: 1.05 seconds
Prefill latency: 0.15036217495799065 sec
Decode latency: 3.6055877031758428 sec
Compilation time: 3.76 seconds
Prefill latency: 0.15060291532427073 sec
Decode latency: 3.6052329214289784 sec
Prefill latency: 0.1505963560193777 sec
Decode latency: 3.5467152753844857 sec
Prefill latency: 0.15145542472600937 sec
Decode latency: 3.593413967639208 sec
Prefill latency: 0.1504531754180789 sec
Decode latency: 3.6056440947577357 sec
Prefill latency: 0.15094759222120047 sec
Decode latency: 3.6042837826535106 sec
Time for inference 1: 3.76 sec total, 272.63 tokens/sec
Decode latency: 3.60 sec
Prefill latency: 0.15 sec
Bandwidth achieved: 4092.16 GB/s
FLOPS achieved: 20.46 TF/s

Prefill latency: 0.1505960403010249 sec
Decode latency: 3.6058446634560823 sec
Time for inference 2: 3.76 sec total, 272.55 tokens/sec
Decode latency: 3.61 sec
Prefill latency: 0.15 sec
Bandwidth achieved: 4090.88 GB/s
FLOPS achieved: 20.45 TF/s

Prefill latency: 0.150949290022254 sec
Decode latency: 3.606046412140131 sec
Time for inference 3: 3.76 sec total, 272.51 tokens/sec
Decode latency: 3.61 sec
Prefill latency: 0.15 sec
Bandwidth achieved: 4090.35 GB/s
FLOPS achieved: 20.45 TF/s

Prefill latency: 0.15183292143046856 sec
Decode latency: 3.5430707205086946 sec
Time for inference 4: 3.70 sec total, 277.09 tokens/sec
Decode latency: 3.54 sec
Prefill latency: 0.15 sec
Bandwidth achieved: 4159.13 GB/s
FLOPS achieved: 20.80 TF/s

Prefill latency: 0.15068794507533312 sec
Decode latency: 3.6063663717359304 sec
Time for inference 5: 3.76 sec total, 272.50 tokens/sec
Decode latency: 3.61 sec
Prefill latency: 0.15 sec
Bandwidth achieved: 4090.18 GB/s
FLOPS achieved: 20.45 TF/s

Prefill latency: 0.15056421142071486 sec
Decode latency: 3.6057142289355397 sec
Time for inference 6: 3.76 sec total, 272.56 tokens/sec
Decode latency: 3.61 sec
Prefill latency: 0.15 sec
Bandwidth achieved: 4091.09 GB/s
FLOPS achieved: 20.46 TF/s

Prefill latency: 0.1513657020404935 sec
Decode latency: 3.5995290065184236 sec
Time for inference 7: 3.75 sec total, 272.96 tokens/sec
Decode latency: 3.60 sec
Prefill latency: 0.15 sec
Bandwidth achieved: 4097.03 GB/s
FLOPS achieved: 20.49 TF/s

Prefill latency: 0.1517267357558012 sec
Decode latency: 3.5659874072298408 sec
Time for inference 8: 3.72 sec total, 275.38 tokens/sec
Decode latency: 3.57 sec
Prefill latency: 0.15 sec
Bandwidth achieved: 4133.44 GB/s
FLOPS achieved: 20.67 TF/s

Prefill latency: 0.14995695371180773 sec
Decode latency: 3.6071291733533144 sec
Time for inference 9: 3.76 sec total, 272.50 tokens/sec
Decode latency: 3.61 sec
Prefill latency: 0.15 sec
Bandwidth achieved: 4090.17 GB/s
FLOPS achieved: 20.45 TF/s

Prefill latency: 0.1517804004251957 sec
Decode latency: 3.608280240558088 sec
Time for inference 10: 3.76 sec total, 272.29 tokens/sec
Decode latency: 3.61 sec
Prefill latency: 0.15 sec
Bandwidth achieved: 4087.06 GB/s
FLOPS achieved: 20.44 TF/s

==========
Batch Size: 4
Prompt Length: 1024
Generated tokens: 256
Average decode latency: 3.5952 sec
Average prefill latency: 0.1510 sec
Average tokens/sec: 273.30
Memory used: 19.82 GB
Done. we are killing the process
