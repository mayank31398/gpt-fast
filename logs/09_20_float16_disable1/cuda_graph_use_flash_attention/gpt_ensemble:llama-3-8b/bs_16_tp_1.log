flash_kv_decode is set to True
Using device=cuda
Loading model ...
GPTEnsemble(
  (tok_embeddings): Embedding(128256, 4096)
  (layers): ModuleList(
    (0-31): 32 x EnsembleTransformerBlock(
      semi_compiled = False
      (attention): Attention(
        (wqkv): Linear(in_features=4096, out_features=6144, bias=False)
        (wo): Linear(in_features=4096, out_features=4096, bias=False)
      )
      (feed_forward): FeedForward(
        (w1): Linear(in_features=4096, out_features=28672, bias=False)
        (w2): Linear(in_features=14336, out_features=4096, bias=False)
      )
      (ffn_norm): RMSNorm()
      (attention_norm): RMSNorm()
    )
  )
  (norm): RMSNorm()
  (output): Linear(in_features=4096, out_features=128256, bias=False)
)
Time to load model: 1.00 seconds
[rank0]:[W1001 00:47:24.201857811 CUDAGraph.cpp:150] Warning: Waiting for pending NCCL work to finish before starting graph capture. (function operator())
Prefill latency: 0.6124832890927792 sec
Decode latency: 6.65021840762347 sec
Compilation time: 7.26 seconds
Prefill latency: 0.6136279683560133 sec
Decode latency: 6.648643226362765 sec
Prefill latency: 0.6143835820257664 sec
Decode latency: 6.654851389117539 sec
Prefill latency: 0.6113273296505213 sec
Decode latency: 6.652208053506911 sec
Prefill latency: 0.6122917635366321 sec
Decode latency: 6.646803982555866 sec
Prefill latency: 0.6130173271521926 sec
Decode latency: 6.649544552899897 sec
Time for inference 1: 7.26 sec total, 563.92 tokens/sec
Decode latency: 6.65 sec
Prefill latency: 0.61 sec
Bandwidth achieved: 8464.41 GB/s
FLOPS achieved: 42.32 TF/s

Prefill latency: 0.614078669808805 sec
Decode latency: 6.6522967321798205 sec
Time for inference 2: 7.27 sec total, 563.62 tokens/sec
Decode latency: 6.65 sec
Prefill latency: 0.61 sec
Bandwidth achieved: 8459.78 GB/s
FLOPS achieved: 42.30 TF/s

Prefill latency: 0.611411552876234 sec
Decode latency: 6.651295818388462 sec
Time for inference 3: 7.26 sec total, 563.91 tokens/sec
Decode latency: 6.65 sec
Prefill latency: 0.61 sec
Bandwidth achieved: 8464.21 GB/s
FLOPS achieved: 42.32 TF/s

Prefill latency: 0.6107686115428805 sec
Decode latency: 6.649637003429234 sec
Time for inference 4: 7.26 sec total, 564.08 tokens/sec
Decode latency: 6.65 sec
Prefill latency: 0.61 sec
Bandwidth achieved: 8466.77 GB/s
FLOPS achieved: 42.33 TF/s

Prefill latency: 0.6130594657734036 sec
Decode latency: 6.648857520893216 sec
Time for inference 5: 7.26 sec total, 563.97 tokens/sec
Decode latency: 6.65 sec
Prefill latency: 0.61 sec
Bandwidth achieved: 8465.08 GB/s
FLOPS achieved: 42.33 TF/s

Prefill latency: 0.6130203194916248 sec
Decode latency: 6.648925079032779 sec
Time for inference 6: 7.26 sec total, 563.96 tokens/sec
Decode latency: 6.65 sec
Prefill latency: 0.61 sec
Bandwidth achieved: 8465.00 GB/s
FLOPS achieved: 42.32 TF/s

Prefill latency: 0.6143819084390998 sec
Decode latency: 6.653034177608788 sec
Time for inference 7: 7.27 sec total, 563.54 tokens/sec
Decode latency: 6.65 sec
Prefill latency: 0.61 sec
Bandwidth achieved: 8458.65 GB/s
FLOPS achieved: 42.29 TF/s

Prefill latency: 0.6115098809823394 sec
Decode latency: 6.647968697361648 sec
Time for inference 8: 7.26 sec total, 564.16 tokens/sec
Decode latency: 6.65 sec
Prefill latency: 0.61 sec
Bandwidth achieved: 8467.96 GB/s
FLOPS achieved: 42.34 TF/s

Prefill latency: 0.6130305314436555 sec
Decode latency: 6.650617694482207 sec
Time for inference 9: 7.26 sec total, 563.84 tokens/sec
Decode latency: 6.65 sec
Prefill latency: 0.61 sec
Bandwidth achieved: 8463.16 GB/s
FLOPS achieved: 42.32 TF/s

Prefill latency: 0.6102898260578513 sec
Decode latency: 6.653005748987198 sec
Time for inference 10: 7.26 sec total, 563.86 tokens/sec
Decode latency: 6.65 sec
Prefill latency: 0.61 sec
Bandwidth achieved: 8463.46 GB/s
FLOPS achieved: 42.32 TF/s

==========
Batch Size: 16
Prompt Length: 1024
Generated tokens: 256
Average decode latency: 6.6505 sec
Average prefill latency: 0.6125 sec
Average tokens/sec: 563.89
Memory used: 30.62 GB
Done. we are killing the process
