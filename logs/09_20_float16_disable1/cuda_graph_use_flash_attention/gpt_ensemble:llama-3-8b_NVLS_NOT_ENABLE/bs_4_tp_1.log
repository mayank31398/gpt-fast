flash_kv_decode is set to True
Using device=cuda
Loading model ...
GPTEnsemble(
  (tok_embeddings): Embedding(128256, 4096)
  (layers): ModuleList(
    (0-31): 32 x EnsembleTransformerBlock(
      semi_compiled = False
      (attention): Attention(
        (wqkv): Linear(in_features=4096, out_features=6144, bias=False)
        (wo): Linear(in_features=4096, out_features=4096, bias=False)
      )
      (feed_forward): FeedForward(
        (w1): Linear(in_features=4096, out_features=28672, bias=False)
        (w2): Linear(in_features=14336, out_features=4096, bias=False)
      )
      (ffn_norm): RMSNorm()
      (attention_norm): RMSNorm()
    )
  )
  (norm): RMSNorm()
  (output): Linear(in_features=4096, out_features=128256, bias=False)
)
Time to load model: 0.96 seconds
Prefill latency: 0.14831667102407664 sec
Decode latency: 3.5486331520369276 sec
Compilation time: 3.70 seconds
Prefill latency: 0.14831688289996237 sec
Decode latency: 3.5493182790232822 sec
Prefill latency: 0.148910594987683 sec
Decode latency: 3.5493516119895503 sec
Prefill latency: 0.149258553981781 sec
Decode latency: 3.5502314859768376 sec
Prefill latency: 0.15003380400594324 sec
Decode latency: 3.549713536980562 sec
Prefill latency: 0.1492165819508955 sec
Decode latency: 3.549891453003511 sec
Time for inference 1: 3.70 sec total, 276.76 tokens/sec
Decode latency: 3.55 sec
Prefill latency: 0.15 sec
Bandwidth achieved: 4154.17 GB/s
FLOPS achieved: 20.77 TF/s

Prefill latency: 0.14872280904091895 sec
Decode latency: 3.5499060510192066 sec
Time for inference 2: 3.70 sec total, 276.80 tokens/sec
Decode latency: 3.55 sec
Prefill latency: 0.15 sec
Bandwidth achieved: 4154.66 GB/s
FLOPS achieved: 20.77 TF/s

Prefill latency: 0.14928220689762384 sec
Decode latency: 3.5497812289977446 sec
Time for inference 3: 3.70 sec total, 276.77 tokens/sec
Decode latency: 3.55 sec
Prefill latency: 0.15 sec
Bandwidth achieved: 4154.28 GB/s
FLOPS achieved: 20.77 TF/s

Prefill latency: 0.14922305999789387 sec
Decode latency: 3.549901464022696 sec
Time for inference 4: 3.70 sec total, 276.77 tokens/sec
Decode latency: 3.55 sec
Prefill latency: 0.15 sec
Bandwidth achieved: 4154.27 GB/s
FLOPS achieved: 20.77 TF/s

Prefill latency: 0.14976296899840236 sec
Decode latency: 3.5499036100227386 sec
Time for inference 5: 3.70 sec total, 276.73 tokens/sec
Decode latency: 3.55 sec
Prefill latency: 0.15 sec
Bandwidth achieved: 4153.71 GB/s
FLOPS achieved: 20.77 TF/s

Prefill latency: 0.14937810297124088 sec
Decode latency: 3.5492096029920503 sec
Time for inference 6: 3.70 sec total, 276.81 tokens/sec
Decode latency: 3.55 sec
Prefill latency: 0.15 sec
Bandwidth achieved: 4154.92 GB/s
FLOPS achieved: 20.77 TF/s

Prefill latency: 0.14881072891876101 sec
Decode latency: 3.5497206930303946 sec
Time for inference 7: 3.70 sec total, 276.81 tokens/sec
Decode latency: 3.55 sec
Prefill latency: 0.15 sec
Bandwidth achieved: 4154.93 GB/s
FLOPS achieved: 20.77 TF/s

Prefill latency: 0.14950128400232643 sec
Decode latency: 3.5498369849519804 sec
Time for inference 8: 3.70 sec total, 276.76 tokens/sec
Decode latency: 3.55 sec
Prefill latency: 0.15 sec
Bandwidth achieved: 4154.07 GB/s
FLOPS achieved: 20.77 TF/s

Prefill latency: 0.14987723995000124 sec
Decode latency: 3.550213626003824 sec
Time for inference 9: 3.70 sec total, 276.70 tokens/sec
Decode latency: 3.55 sec
Prefill latency: 0.15 sec
Bandwidth achieved: 4153.24 GB/s
FLOPS achieved: 20.77 TF/s

Prefill latency: 0.1493356639984995 sec
Decode latency: 3.495311525068246 sec
Time for inference 10: 3.65 sec total, 280.90 tokens/sec
Decode latency: 3.50 sec
Prefill latency: 0.15 sec
Bandwidth achieved: 4216.32 GB/s
FLOPS achieved: 21.08 TF/s

==========
Batch Size: 4
Prompt Length: 1024
Generated tokens: 256
Average decode latency: 3.5444 sec
Average prefill latency: 0.1493 sec
Average tokens/sec: 277.18
Memory used: 18.88 GB
Done. we are killing the process
