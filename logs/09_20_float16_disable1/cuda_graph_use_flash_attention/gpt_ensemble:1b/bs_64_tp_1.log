flash_kv_decode is set to True
Using device=cuda
Loading model ...
GPTEnsemble(
  (tok_embeddings): Embedding(49152, 1536)
  (layers): ModuleList(
    (0-39): 40 x EnsembleTransformerBlock(
      semi_compiled = False
      (attention): Attention(
        (wqkv): Linear(in_features=1536, out_features=2560, bias=False)
        (wo): Linear(in_features=1536, out_features=1536, bias=False)
      )
      (feed_forward): FeedForward(
        (w1): Linear(in_features=1536, out_features=8192, bias=False)
        (w2): Linear(in_features=4096, out_features=1536, bias=False)
      )
      (ffn_norm): RMSNorm()
      (attention_norm): RMSNorm()
    )
  )
  (norm): RMSNorm()
  (output): Linear(in_features=1536, out_features=49152, bias=False)
)
Time to load model: 1.09 seconds
[rank0]:[W930 21:17:25.662250373 CUDAGraph.cpp:150] Warning: Waiting for pending NCCL work to finish before starting graph capture. (function operator())
Prefill latency: 0.7018543670419604 sec
Decode latency: 10.596687074983492 sec
Compilation time: 11.31 seconds
Prefill latency: 0.7036851149750873 sec
Decode latency: 10.598936791997403 sec
Prefill latency: 0.7037847159663215 sec
Decode latency: 10.596847846987657 sec
Prefill latency: 0.7033834450412542 sec
Decode latency: 10.599913201993331 sec
Prefill latency: 0.7032784989569336 sec
Decode latency: 10.597560315043665 sec
Prefill latency: 0.7035654269857332 sec
Decode latency: 10.595848562079482 sec
Time for inference 1: 11.30 sec total, 1449.84 tokens/sec
Decode latency: 10.60 sec
Prefill latency: 0.70 sec
Bandwidth achieved: 3138.20 GB/s
FLOPS achieved: 15.69 TF/s

Prefill latency: 0.7035383899929002 sec
Decode latency: 10.596192629891448 sec
Time for inference 2: 11.30 sec total, 1449.80 tokens/sec
Decode latency: 10.60 sec
Prefill latency: 0.70 sec
Bandwidth achieved: 3138.11 GB/s
FLOPS achieved: 15.69 TF/s

Prefill latency: 0.7038010579999536 sec
Decode latency: 10.59707139688544 sec
Time for inference 3: 11.30 sec total, 1449.64 tokens/sec
Decode latency: 10.60 sec
Prefill latency: 0.70 sec
Bandwidth achieved: 3137.77 GB/s
FLOPS achieved: 15.69 TF/s

Prefill latency: 0.703585940063931 sec
Decode latency: 10.597713881055824 sec
Time for inference 4: 11.30 sec total, 1449.61 tokens/sec
Decode latency: 10.60 sec
Prefill latency: 0.70 sec
Bandwidth achieved: 3137.69 GB/s
FLOPS achieved: 15.69 TF/s

Prefill latency: 0.7032315089600161 sec
Decode latency: 10.597771154018119 sec
Time for inference 5: 11.30 sec total, 1449.63 tokens/sec
Decode latency: 10.60 sec
Prefill latency: 0.70 sec
Bandwidth achieved: 3137.74 GB/s
FLOPS achieved: 15.69 TF/s

Prefill latency: 0.704020883073099 sec
Decode latency: 10.599794651032425 sec
Time for inference 6: 11.30 sec total, 1449.29 tokens/sec
Decode latency: 10.60 sec
Prefill latency: 0.70 sec
Bandwidth achieved: 3137.00 GB/s
FLOPS achieved: 15.68 TF/s

Prefill latency: 0.7038724978920072 sec
Decode latency: 10.600240287953056 sec
Time for inference 7: 11.31 sec total, 1449.27 tokens/sec
Decode latency: 10.60 sec
Prefill latency: 0.70 sec
Bandwidth achieved: 3136.96 GB/s
FLOPS achieved: 15.68 TF/s

Prefill latency: 0.7029811260290444 sec
Decode latency: 10.597052787896246 sec
Time for inference 8: 11.30 sec total, 1449.76 tokens/sec
Decode latency: 10.60 sec
Prefill latency: 0.70 sec
Bandwidth achieved: 3138.01 GB/s
FLOPS achieved: 15.69 TF/s

Prefill latency: 0.703572282101959 sec
Decode latency: 10.596421516966075 sec
Time for inference 9: 11.30 sec total, 1449.76 tokens/sec
Decode latency: 10.60 sec
Prefill latency: 0.70 sec
Bandwidth achieved: 3138.02 GB/s
FLOPS achieved: 15.69 TF/s

Prefill latency: 0.7027473580092192 sec
Decode latency: 10.595775802037679 sec
Time for inference 10: 11.30 sec total, 1449.96 tokens/sec
Decode latency: 10.60 sec
Prefill latency: 0.70 sec
Bandwidth achieved: 3138.45 GB/s
FLOPS achieved: 15.69 TF/s

==========
Batch Size: 64
Prompt Length: 1024
Generated tokens: 256
Average decode latency: 10.5974 sec
Average prefill latency: 0.7035 sec
Average tokens/sec: 1449.66
Memory used: 29.28 GB
Done. we are killing the process
