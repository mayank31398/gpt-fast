flash_kv_decode is set to True
Using device=cuda
Loading model ...
GPTEnsemble(
  (tok_embeddings): Embedding(49152, 1536)
  (layers): ModuleList(
    (0-39): 40 x EnsembleTransformerBlock(
      semi_compiled = False
      (attention): Attention(
        (wqkv): Linear(in_features=1536, out_features=4608, bias=False)
        (wo): Linear(in_features=1536, out_features=1536, bias=False)
      )
      (feed_forward): FeedForward(
        (w1): Linear(in_features=1536, out_features=8192, bias=False)
        (w2): Linear(in_features=4096, out_features=1536, bias=False)
      )
      (ffn_norm): RMSNorm()
      (attention_norm): RMSNorm()
    )
  )
  (norm): RMSNorm()
  (output): Linear(in_features=1536, out_features=49152, bias=False)
)
Time to load model: 1.04 seconds
Prefill latency: 0.8053062809631228 sec
Decode latency: 8.467537033022381 sec
Compilation time: 9.27 seconds
Prefill latency: 0.8051207100506872 sec
Decode latency: 8.503327414044179 sec
Prefill latency: 0.806868726038374 sec
Decode latency: 8.462843735003844 sec
Prefill latency: 0.8044431569287553 sec
Decode latency: 8.596888017957099 sec
Prefill latency: 0.806702669011429 sec
Decode latency: 8.461226298008114 sec
Prefill latency: 0.8054496719269082 sec
Decode latency: 8.460459116962738 sec
Time for inference 1: 9.27 sec total, 1768.03 tokens/sec
Decode latency: 8.46 sec
Prefill latency: 0.81 sec
Bandwidth achieved: 4271.86 GB/s
FLOPS achieved: 21.36 TF/s

Prefill latency: 0.8044018349610269 sec
Decode latency: 8.47092394309584 sec
Time for inference 2: 9.28 sec total, 1766.22 tokens/sec
Decode latency: 8.47 sec
Prefill latency: 0.80 sec
Bandwidth achieved: 4267.48 GB/s
FLOPS achieved: 21.34 TF/s

Prefill latency: 0.8043868670938537 sec
Decode latency: 8.520124490954913 sec
Time for inference 3: 9.33 sec total, 1756.90 tokens/sec
Decode latency: 8.52 sec
Prefill latency: 0.80 sec
Bandwidth achieved: 4244.98 GB/s
FLOPS achieved: 21.22 TF/s

Prefill latency: 0.8054007230093703 sec
Decode latency: 8.596676254062913 sec
Time for inference 4: 9.40 sec total, 1742.44 tokens/sec
Decode latency: 8.60 sec
Prefill latency: 0.81 sec
Bandwidth achieved: 4210.02 GB/s
FLOPS achieved: 21.05 TF/s

Prefill latency: 0.809027920011431 sec
Decode latency: 8.490337715949863 sec
Time for inference 5: 9.30 sec total, 1761.67 tokens/sec
Decode latency: 8.49 sec
Prefill latency: 0.81 sec
Bandwidth achieved: 4256.49 GB/s
FLOPS achieved: 21.28 TF/s

Prefill latency: 0.8127326460089535 sec
Decode latency: 8.453360002022237 sec
Time for inference 6: 9.27 sec total, 1767.99 tokens/sec
Decode latency: 8.45 sec
Prefill latency: 0.81 sec
Bandwidth achieved: 4271.77 GB/s
FLOPS achieved: 21.36 TF/s

Prefill latency: 0.806085943011567 sec
Decode latency: 8.594166627968661 sec
Time for inference 7: 9.40 sec total, 1742.77 tokens/sec
Decode latency: 8.59 sec
Prefill latency: 0.81 sec
Bandwidth achieved: 4210.83 GB/s
FLOPS achieved: 21.05 TF/s

Prefill latency: 0.8060621409676969 sec
Decode latency: 8.594175621983595 sec
Time for inference 8: 9.40 sec total, 1742.74 tokens/sec
Decode latency: 8.59 sec
Prefill latency: 0.81 sec
Bandwidth achieved: 4210.76 GB/s
FLOPS achieved: 21.05 TF/s

Prefill latency: 0.8044236949644983 sec
Decode latency: 8.483703562989831 sec
Time for inference 9: 9.29 sec total, 1763.80 tokens/sec
Decode latency: 8.48 sec
Prefill latency: 0.80 sec
Bandwidth achieved: 4261.63 GB/s
FLOPS achieved: 21.31 TF/s

Prefill latency: 0.805374072981067 sec
Decode latency: 8.53450165700633 sec
Time for inference 10: 9.34 sec total, 1754.04 tokens/sec
Decode latency: 8.53 sec
Prefill latency: 0.81 sec
Bandwidth achieved: 4238.07 GB/s
FLOPS achieved: 21.19 TF/s

==========
Batch Size: 64
Prompt Length: 1024
Generated tokens: 256
Average decode latency: 8.5198 sec
Average prefill latency: 0.8063 sec
Average tokens/sec: 1756.66
Memory used: 34.58 GB
Done. we are killing the process
