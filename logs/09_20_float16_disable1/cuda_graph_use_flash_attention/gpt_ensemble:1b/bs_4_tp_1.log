flash_kv_decode is set to True
Using device=cuda
Loading model ...
GPTEnsemble(
  (tok_embeddings): Embedding(49152, 1536)
  (layers): ModuleList(
    (0-39): 40 x EnsembleTransformerBlock(
      semi_compiled = False
      (attention): Attention(
        (wqkv): Linear(in_features=1536, out_features=2560, bias=False)
        (wo): Linear(in_features=1536, out_features=1536, bias=False)
      )
      (feed_forward): FeedForward(
        (w1): Linear(in_features=1536, out_features=8192, bias=False)
        (w2): Linear(in_features=4096, out_features=1536, bias=False)
      )
      (ffn_norm): RMSNorm()
      (attention_norm): RMSNorm()
    )
  )
  (norm): RMSNorm()
  (output): Linear(in_features=1536, out_features=49152, bias=False)
)
Time to load model: 0.97 seconds
Prefill latency: 0.048864296986721456 sec
Decode latency: 2.547302640043199 sec
Compilation time: 2.60 seconds
Prefill latency: 0.048474441980943084 sec
Decode latency: 2.5160187769215554 sec
Prefill latency: 0.04844284395221621 sec
Decode latency: 2.5461758699966595 sec
Prefill latency: 0.048428255948238075 sec
Decode latency: 2.4306282219477 sec
Prefill latency: 0.048492699046619236 sec
Decode latency: 2.419494236004539 sec
Prefill latency: 0.048401686013676226 sec
Decode latency: 2.544763493933715 sec
Time for inference 1: 2.59 sec total, 394.78 tokens/sec
Decode latency: 2.54 sec
Prefill latency: 0.05 sec
Bandwidth achieved: 854.51 GB/s
FLOPS achieved: 4.27 TF/s

Prefill latency: 0.04853228398133069 sec
Decode latency: 2.5101740079699084 sec
Time for inference 2: 2.56 sec total, 400.06 tokens/sec
Decode latency: 2.51 sec
Prefill latency: 0.05 sec
Bandwidth achieved: 865.94 GB/s
FLOPS achieved: 4.33 TF/s

Prefill latency: 0.048490012995898724 sec
Decode latency: 2.5455177660332993 sec
Time for inference 3: 2.59 sec total, 394.62 tokens/sec
Decode latency: 2.55 sec
Prefill latency: 0.05 sec
Bandwidth achieved: 854.15 GB/s
FLOPS achieved: 4.27 TF/s

Prefill latency: 0.048497947049327195 sec
Decode latency: 2.4651973120635375 sec
Time for inference 4: 2.51 sec total, 407.24 tokens/sec
Decode latency: 2.47 sec
Prefill latency: 0.05 sec
Bandwidth achieved: 881.47 GB/s
FLOPS achieved: 4.41 TF/s

Prefill latency: 0.04847431799862534 sec
Decode latency: 2.48051897296682 sec
Time for inference 5: 2.53 sec total, 404.79 tokens/sec
Decode latency: 2.48 sec
Prefill latency: 0.05 sec
Bandwidth achieved: 876.17 GB/s
FLOPS achieved: 4.38 TF/s

Prefill latency: 0.04848540003877133 sec
Decode latency: 2.430826538009569 sec
Time for inference 6: 2.48 sec total, 412.90 tokens/sec
Decode latency: 2.43 sec
Prefill latency: 0.05 sec
Bandwidth achieved: 893.72 GB/s
FLOPS achieved: 4.47 TF/s

Prefill latency: 0.0484919500304386 sec
Decode latency: 2.4633674930082634 sec
Time for inference 7: 2.51 sec total, 407.56 tokens/sec
Decode latency: 2.46 sec
Prefill latency: 0.05 sec
Bandwidth achieved: 882.17 GB/s
FLOPS achieved: 4.41 TF/s

Prefill latency: 0.048387028044089675 sec
Decode latency: 2.540171414031647 sec
Time for inference 8: 2.59 sec total, 395.48 tokens/sec
Decode latency: 2.54 sec
Prefill latency: 0.05 sec
Bandwidth achieved: 856.02 GB/s
FLOPS achieved: 4.28 TF/s

Prefill latency: 0.04846411198377609 sec
Decode latency: 2.4736500759609044 sec
Time for inference 9: 2.52 sec total, 405.90 tokens/sec
Decode latency: 2.47 sec
Prefill latency: 0.05 sec
Bandwidth achieved: 878.57 GB/s
FLOPS achieved: 4.39 TF/s

Prefill latency: 0.04828019894193858 sec
Decode latency: 2.4228284710552543 sec
Time for inference 10: 2.47 sec total, 414.28 tokens/sec
Decode latency: 2.42 sec
Prefill latency: 0.05 sec
Bandwidth achieved: 896.72 GB/s
FLOPS achieved: 4.48 TF/s

==========
Batch Size: 4
Prompt Length: 1024
Generated tokens: 256
Average decode latency: 2.4877 sec
Average prefill latency: 0.0485 sec
Average tokens/sec: 403.76
Memory used: 4.19 GB
Done. we are killing the process
