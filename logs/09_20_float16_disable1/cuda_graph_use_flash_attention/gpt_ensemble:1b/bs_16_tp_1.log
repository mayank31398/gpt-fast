flash_kv_decode is set to True
Using device=cuda
Loading model ...
GPTEnsemble(
  (tok_embeddings): Embedding(49152, 1536)
  (layers): ModuleList(
    (0-39): 40 x EnsembleTransformerBlock(
      semi_compiled = False
      (attention): Attention(
        (wqkv): Linear(in_features=1536, out_features=2560, bias=False)
        (wo): Linear(in_features=1536, out_features=1536, bias=False)
      )
      (feed_forward): FeedForward(
        (w1): Linear(in_features=1536, out_features=8192, bias=False)
        (w2): Linear(in_features=4096, out_features=1536, bias=False)
      )
      (ffn_norm): RMSNorm()
      (attention_norm): RMSNorm()
    )
  )
  (norm): RMSNorm()
  (output): Linear(in_features=1536, out_features=49152, bias=False)
)
Time to load model: 0.96 seconds
[rank0]:[W930 21:13:13.911637117 CUDAGraph.cpp:150] Warning: Waiting for pending NCCL work to finish before starting graph capture. (function operator())
Prefill latency: 0.18066712596919388 sec
Decode latency: 3.8503303850302473 sec
Compilation time: 4.03 seconds
Prefill latency: 0.18009914900176227 sec
Decode latency: 3.8450223420513794 sec
Prefill latency: 0.17996995197609067 sec
Decode latency: 3.851528585073538 sec
Prefill latency: 0.18006885808426887 sec
Decode latency: 3.853877359069884 sec
Prefill latency: 0.18006138305645436 sec
Decode latency: 3.8261518790386617 sec
Prefill latency: 0.18009325303137302 sec
Decode latency: 3.853936931001954 sec
Time for inference 1: 4.03 sec total, 1015.19 tokens/sec
Decode latency: 3.85 sec
Prefill latency: 0.18 sec
Bandwidth achieved: 2197.39 GB/s
FLOPS achieved: 10.99 TF/s

Prefill latency: 0.18012217606883496 sec
Decode latency: 3.8503247760236263 sec
Time for inference 2: 4.03 sec total, 1016.09 tokens/sec
Decode latency: 3.85 sec
Prefill latency: 0.18 sec
Bandwidth achieved: 2199.34 GB/s
FLOPS achieved: 11.00 TF/s

Prefill latency: 0.18007322901394218 sec
Decode latency: 3.732462425949052 sec
Time for inference 3: 3.91 sec total, 1046.71 tokens/sec
Decode latency: 3.73 sec
Prefill latency: 0.18 sec
Bandwidth achieved: 2265.62 GB/s
FLOPS achieved: 11.33 TF/s

Prefill latency: 0.18016319791786373 sec
Decode latency: 3.854100011056289 sec
Time for inference 4: 4.04 sec total, 1015.08 tokens/sec
Decode latency: 3.85 sec
Prefill latency: 0.18 sec
Bandwidth achieved: 2197.16 GB/s
FLOPS achieved: 10.99 TF/s

Prefill latency: 0.18006657401565462 sec
Decode latency: 3.8089491419959813 sec
Time for inference 5: 3.99 sec total, 1026.60 tokens/sec
Decode latency: 3.81 sec
Prefill latency: 0.18 sec
Bandwidth achieved: 2222.08 GB/s
FLOPS achieved: 11.11 TF/s

Prefill latency: 0.18012192100286484 sec
Decode latency: 3.728920054039918 sec
Time for inference 6: 3.91 sec total, 1047.62 tokens/sec
Decode latency: 3.73 sec
Prefill latency: 0.18 sec
Bandwidth achieved: 2267.59 GB/s
FLOPS achieved: 11.34 TF/s

Prefill latency: 0.18005360604729503 sec
Decode latency: 3.851997372927144 sec
Time for inference 7: 4.03 sec total, 1015.68 tokens/sec
Decode latency: 3.85 sec
Prefill latency: 0.18 sec
Bandwidth achieved: 2198.44 GB/s
FLOPS achieved: 10.99 TF/s

Prefill latency: 0.18012126896064728 sec
Decode latency: 3.7999142699409276 sec
Time for inference 8: 3.98 sec total, 1028.95 tokens/sec
Decode latency: 3.80 sec
Prefill latency: 0.18 sec
Bandwidth achieved: 2227.16 GB/s
FLOPS achieved: 11.14 TF/s

Prefill latency: 0.18004382005892694 sec
Decode latency: 3.851907785050571 sec
Time for inference 9: 4.03 sec total, 1015.70 tokens/sec
Decode latency: 3.85 sec
Prefill latency: 0.18 sec
Bandwidth achieved: 2198.49 GB/s
FLOPS achieved: 10.99 TF/s

Prefill latency: 0.18021139898337424 sec
Decode latency: 3.853022988070734 sec
Time for inference 10: 4.03 sec total, 1015.39 tokens/sec
Decode latency: 3.85 sec
Prefill latency: 0.18 sec
Bandwidth achieved: 2197.81 GB/s
FLOPS achieved: 10.99 TF/s

==========
Batch Size: 16
Prompt Length: 1024
Generated tokens: 256
Average decode latency: 3.8186 sec
Average prefill latency: 0.1801 sec
Average tokens/sec: 1024.30
Memory used: 9.22 GB
Done. we are killing the process
