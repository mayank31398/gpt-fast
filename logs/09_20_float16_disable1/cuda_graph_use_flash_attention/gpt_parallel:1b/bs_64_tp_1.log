flash_kv_decode is set to True
Using device=cuda
Loading model ...
GPTParallel(
  (tok_embeddings): Embedding(49152, 1536)
  (layers): ModuleList(
    (0-39): 40 x ParallelTransformerBlock(
      semi_compiled = False
      (attention): FuseAttentionMLP(
        (wqkv1): Linear(in_features=1536, out_features=12800, bias=False)
        (wo): Linear(in_features=1536, out_features=1536, bias=False)
        (w2): Linear(in_features=4096, out_features=1536, bias=False)
      )
      (attention_norm): RMSNorm()
    )
  )
  (norm): RMSNorm()
  (output): Linear(in_features=1536, out_features=49152, bias=False)
)
Time to load model: 1.01 seconds
[rank0]:[W1001 03:59:55.328030393 CUDAGraph.cpp:150] Warning: Waiting for pending NCCL work to finish before starting graph capture. (function operator())
Prefill latency: 0.8094456510152668 sec
Decode latency: 8.575389410019852 sec
Compilation time: 9.39 seconds
Prefill latency: 0.8087575760437176 sec
Decode latency: 8.51900497393217 sec
Prefill latency: 0.8140067580388859 sec
Decode latency: 8.575945178978145 sec
Prefill latency: 0.809054582961835 sec
Decode latency: 8.478910724050365 sec
Prefill latency: 0.8137881549773738 sec
Decode latency: 8.56255005998537 sec
Prefill latency: 0.8168729190947488 sec
Decode latency: 8.557382415048778 sec
Time for inference 1: 9.38 sec total, 1747.55 tokens/sec
Decode latency: 8.56 sec
Prefill latency: 0.82 sec
Bandwidth achieved: 4222.15 GB/s
FLOPS achieved: 21.11 TF/s

Prefill latency: 0.8087108350591734 sec
Decode latency: 8.580919620930217 sec
Time for inference 2: 9.39 sec total, 1744.72 tokens/sec
Decode latency: 8.58 sec
Prefill latency: 0.81 sec
Bandwidth achieved: 4215.32 GB/s
FLOPS achieved: 21.08 TF/s

Prefill latency: 0.8108730980893597 sec
Decode latency: 8.574369249981828 sec
Time for inference 3: 9.39 sec total, 1745.55 tokens/sec
Decode latency: 8.57 sec
Prefill latency: 0.81 sec
Bandwidth achieved: 4217.32 GB/s
FLOPS achieved: 21.09 TF/s

Prefill latency: 0.8086155159398913 sec
Decode latency: 8.5731152810622 sec
Time for inference 4: 9.38 sec total, 1746.16 tokens/sec
Decode latency: 8.57 sec
Prefill latency: 0.81 sec
Bandwidth achieved: 4218.80 GB/s
FLOPS achieved: 21.09 TF/s

Prefill latency: 0.8086813000263646 sec
Decode latency: 8.576758845010772 sec
Time for inference 5: 9.39 sec total, 1745.48 tokens/sec
Decode latency: 8.58 sec
Prefill latency: 0.81 sec
Bandwidth achieved: 4217.15 GB/s
FLOPS achieved: 21.09 TF/s

Prefill latency: 0.8146696140756831 sec
Decode latency: 8.516596561996266 sec
Time for inference 6: 9.33 sec total, 1755.63 tokens/sec
Decode latency: 8.52 sec
Prefill latency: 0.81 sec
Bandwidth achieved: 4241.68 GB/s
FLOPS achieved: 21.21 TF/s

Prefill latency: 0.8087456750217825 sec
Decode latency: 8.580380141036585 sec
Time for inference 7: 9.39 sec total, 1744.81 tokens/sec
Decode latency: 8.58 sec
Prefill latency: 0.81 sec
Bandwidth achieved: 4215.54 GB/s
FLOPS achieved: 21.08 TF/s

Prefill latency: 0.8123557720100507 sec
Decode latency: 8.57679027901031 sec
Time for inference 8: 9.39 sec total, 1744.79 tokens/sec
Decode latency: 8.58 sec
Prefill latency: 0.81 sec
Bandwidth achieved: 4215.49 GB/s
FLOPS achieved: 21.08 TF/s

Prefill latency: 0.8086193690542132 sec
Decode latency: 8.57808326301165 sec
Time for inference 9: 9.39 sec total, 1745.26 tokens/sec
Decode latency: 8.58 sec
Prefill latency: 0.81 sec
Bandwidth achieved: 4216.63 GB/s
FLOPS achieved: 21.08 TF/s

Prefill latency: 0.8143305759876966 sec
Decode latency: 8.574565976974554 sec
Time for inference 10: 9.39 sec total, 1744.85 tokens/sec
Decode latency: 8.57 sec
Prefill latency: 0.81 sec
Bandwidth achieved: 4215.64 GB/s
FLOPS achieved: 21.08 TF/s

==========
Batch Size: 64
Prompt Length: 1024
Generated tokens: 256
Average decode latency: 8.5689 sec
Average prefill latency: 0.8112 sec
Average tokens/sec: 1746.48
Memory used: 43.73 GB
Done. we are killing the process
