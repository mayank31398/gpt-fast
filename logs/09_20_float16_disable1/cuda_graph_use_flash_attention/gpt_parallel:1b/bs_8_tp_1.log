flash_kv_decode is set to True
Using device=cuda
Loading model ...
GPTParallel(
  (tok_embeddings): Embedding(49152, 1536)
  (layers): ModuleList(
    (0-39): 40 x ParallelTransformerBlock(
      semi_compiled = False
      (attention): FuseAttentionMLP(
        (wqkv1): Linear(in_features=1536, out_features=12800, bias=False)
        (wo): Linear(in_features=1536, out_features=1536, bias=False)
        (w2): Linear(in_features=4096, out_features=1536, bias=False)
      )
      (attention_norm): RMSNorm()
    )
  )
  (norm): RMSNorm()
  (output): Linear(in_features=1536, out_features=49152, bias=False)
)
Time to load model: 0.91 seconds
[rank0]:[W1001 03:52:38.555165461 CUDAGraph.cpp:150] Warning: Waiting for pending NCCL work to finish before starting graph capture. (function operator())
Prefill latency: 0.10640340892132372 sec
Decode latency: 2.626793266972527 sec
Compilation time: 2.73 seconds
Prefill latency: 0.10607503599021584 sec
Decode latency: 2.6076486139791086 sec
Prefill latency: 0.10598495998419821 sec
Decode latency: 2.661094620008953 sec
Prefill latency: 0.10602960200048983 sec
Decode latency: 2.634399184025824 sec
Prefill latency: 0.10606710100546479 sec
Decode latency: 2.6630124469520524 sec
Prefill latency: 0.10613111010752618 sec
Decode latency: 2.689651202992536 sec
Time for inference 1: 2.80 sec total, 732.32 tokens/sec
Decode latency: 2.69 sec
Prefill latency: 0.11 sec
Bandwidth achieved: 1769.33 GB/s
FLOPS achieved: 8.85 TF/s

Prefill latency: 0.10582094104029238 sec
Decode latency: 2.6898394719464704 sec
Time for inference 2: 2.80 sec total, 732.36 tokens/sec
Decode latency: 2.69 sec
Prefill latency: 0.11 sec
Bandwidth achieved: 1769.42 GB/s
FLOPS achieved: 8.85 TF/s

Prefill latency: 0.10581540805287659 sec
Decode latency: 2.6650539110414684 sec
Time for inference 3: 2.77 sec total, 738.93 tokens/sec
Decode latency: 2.67 sec
Prefill latency: 0.11 sec
Bandwidth achieved: 1785.30 GB/s
FLOPS achieved: 8.93 TF/s

Prefill latency: 0.10578975197859108 sec
Decode latency: 2.576753017026931 sec
Time for inference 4: 2.68 sec total, 763.26 tokens/sec
Decode latency: 2.58 sec
Prefill latency: 0.11 sec
Bandwidth achieved: 1844.06 GB/s
FLOPS achieved: 9.22 TF/s

Prefill latency: 0.10574861406348646 sec
Decode latency: 2.6902804700657725 sec
Time for inference 5: 2.80 sec total, 732.29 tokens/sec
Decode latency: 2.69 sec
Prefill latency: 0.11 sec
Bandwidth achieved: 1769.25 GB/s
FLOPS achieved: 8.85 TF/s

Prefill latency: 0.10585607797838748 sec
Decode latency: 2.6862320590298623 sec
Time for inference 6: 2.79 sec total, 733.34 tokens/sec
Decode latency: 2.69 sec
Prefill latency: 0.11 sec
Bandwidth achieved: 1771.77 GB/s
FLOPS achieved: 8.86 TF/s

Prefill latency: 0.10582010995130986 sec
Decode latency: 2.625692573026754 sec
Time for inference 7: 2.73 sec total, 749.58 tokens/sec
Decode latency: 2.63 sec
Prefill latency: 0.11 sec
Bandwidth achieved: 1811.03 GB/s
FLOPS achieved: 9.06 TF/s

Prefill latency: 0.10587234690319747 sec
Decode latency: 2.638715132023208 sec
Time for inference 8: 2.75 sec total, 746.00 tokens/sec
Decode latency: 2.64 sec
Prefill latency: 0.11 sec
Bandwidth achieved: 1802.37 GB/s
FLOPS achieved: 9.01 TF/s

Prefill latency: 0.10574443207588047 sec
Decode latency: 2.6905669620027766 sec
Time for inference 9: 2.80 sec total, 732.16 tokens/sec
Decode latency: 2.69 sec
Prefill latency: 0.11 sec
Bandwidth achieved: 1768.94 GB/s
FLOPS achieved: 8.84 TF/s

Prefill latency: 0.10575467895250767 sec
Decode latency: 2.569434672011994 sec
Time for inference 10: 2.68 sec total, 765.31 tokens/sec
Decode latency: 2.57 sec
Prefill latency: 0.11 sec
Bandwidth achieved: 1849.03 GB/s
FLOPS achieved: 9.25 TF/s

==========
Batch Size: 8
Prompt Length: 1024
Generated tokens: 256
Average decode latency: 2.6522 sec
Average prefill latency: 0.1058 sec
Average tokens/sec: 742.56
Memory used: 7.98 GB
Done. we are killing the process
