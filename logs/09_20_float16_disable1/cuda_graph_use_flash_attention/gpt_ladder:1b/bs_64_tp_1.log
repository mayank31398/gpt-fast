flash_kv_decode is set to True
Using device=cuda
Loading model ...
GPTLadder(
  (tok_embeddings): Embedding(49152, 1536)
  (layers): ModuleList(
    (0-39): 40 x LadderTransformerBlock(
      semi_compiled = False
      (attention): Attention(
        (wqkv): Linear(in_features=1536, out_features=4608, bias=False)
        (wo): Linear(in_features=1536, out_features=1536, bias=False)
      )
      (feed_forward): FeedForward(
        (w1): Linear(in_features=1536, out_features=8192, bias=False)
        (w2): Linear(in_features=4096, out_features=1536, bias=False)
      )
      (ffn_norm): RMSNorm()
      (attention_norm): RMSNorm()
    )
  )
  (norm): RMSNorm()
  (output): Linear(in_features=1536, out_features=49152, bias=False)
)
Time to load model: 0.18 seconds
[rank0]:[W1001 02:55:54.681460149 CUDAGraph.cpp:150] Warning: Waiting for pending NCCL work to finish before starting graph capture. (function operator())
Prefill latency: 0.8058674399508163 sec
Decode latency: 8.665613347897306 sec
Compilation time: 9.47 seconds
Prefill latency: 0.8072727950057015 sec
Decode latency: 8.656909754034132 sec
Prefill latency: 0.8068510199664161 sec
Decode latency: 8.667249838006683 sec
Prefill latency: 0.8075388619909063 sec
Decode latency: 8.53654236102011 sec
Prefill latency: 0.807143013109453 sec
Decode latency: 8.66596664104145 sec
Prefill latency: 0.8081406550481915 sec
Decode latency: 8.578936674050055 sec
Time for inference 1: 9.39 sec total, 1745.17 tokens/sec
Decode latency: 8.58 sec
Prefill latency: 0.81 sec
Bandwidth achieved: 4216.62 GB/s
FLOPS achieved: 21.08 TF/s

Prefill latency: 0.8060913470108062 sec
Decode latency: 8.553520557004958 sec
Time for inference 2: 9.36 sec total, 1750.31 tokens/sec
Decode latency: 8.55 sec
Prefill latency: 0.81 sec
Bandwidth achieved: 4229.04 GB/s
FLOPS achieved: 21.15 TF/s

Prefill latency: 0.8059588420437649 sec
Decode latency: 8.6670213410398 sec
Time for inference 3: 9.47 sec total, 1729.37 tokens/sec
Decode latency: 8.67 sec
Prefill latency: 0.81 sec
Bandwidth achieved: 4178.45 GB/s
FLOPS achieved: 20.89 TF/s

Prefill latency: 0.807242444017902 sec
Decode latency: 8.663729866035283 sec
Time for inference 4: 9.47 sec total, 1729.71 tokens/sec
Decode latency: 8.66 sec
Prefill latency: 0.81 sec
Bandwidth achieved: 4179.27 GB/s
FLOPS achieved: 20.90 TF/s

Prefill latency: 0.8131777420639992 sec
Decode latency: 8.665540138958022 sec
Time for inference 5: 9.48 sec total, 1728.28 tokens/sec
Decode latency: 8.67 sec
Prefill latency: 0.81 sec
Bandwidth achieved: 4175.80 GB/s
FLOPS achieved: 20.88 TF/s

Prefill latency: 0.8121979549759999 sec
Decode latency: 8.557100828969851 sec
Time for inference 6: 9.37 sec total, 1748.49 tokens/sec
Decode latency: 8.56 sec
Prefill latency: 0.81 sec
Bandwidth achieved: 4224.64 GB/s
FLOPS achieved: 21.12 TF/s

Prefill latency: 0.8060938329435885 sec
Decode latency: 8.665432563051581 sec
Time for inference 7: 9.47 sec total, 1729.60 tokens/sec
Decode latency: 8.67 sec
Prefill latency: 0.81 sec
Bandwidth achieved: 4179.00 GB/s
FLOPS achieved: 20.89 TF/s

Prefill latency: 0.8101297660032287 sec
Decode latency: 8.572037850972265 sec
Time for inference 8: 9.38 sec total, 1746.09 tokens/sec
Decode latency: 8.57 sec
Prefill latency: 0.81 sec
Bandwidth achieved: 4218.85 GB/s
FLOPS achieved: 21.09 TF/s

Prefill latency: 0.8069380189990625 sec
Decode latency: 8.662985208909959 sec
Time for inference 9: 9.47 sec total, 1729.91 tokens/sec
Decode latency: 8.66 sec
Prefill latency: 0.81 sec
Bandwidth achieved: 4179.75 GB/s
FLOPS achieved: 20.90 TF/s

Prefill latency: 0.8076467210194096 sec
Decode latency: 8.66507175390143 sec
Time for inference 10: 9.47 sec total, 1729.40 tokens/sec
Decode latency: 8.67 sec
Prefill latency: 0.81 sec
Bandwidth achieved: 4178.53 GB/s
FLOPS achieved: 20.89 TF/s

==========
Batch Size: 64
Prompt Length: 1024
Generated tokens: 256
Average decode latency: 8.6251 sec
Average prefill latency: 0.8084 sec
Average tokens/sec: 1736.63
Memory used: 54.53 GB
Done. we are killing the process
