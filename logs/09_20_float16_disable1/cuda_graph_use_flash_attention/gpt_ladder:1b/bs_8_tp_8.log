W0930 20:03:58.931000 23060138358592 torch/distributed/run.py:779] 
W0930 20:03:58.931000 23060138358592 torch/distributed/run.py:779] *****************************************
W0930 20:03:58.931000 23060138358592 torch/distributed/run.py:779] Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
W0930 20:03:58.931000 23060138358592 torch/distributed/run.py:779] *****************************************
flash_kv_decode is set to True
Using device=cuda
Loading model ...
GPTLadder(
  (tok_embeddings): Embedding(49152, 1536)
  (layers): ModuleList(
    (0-39): 40 x LadderTransformerBlock(
      semi_compiled = False
      (attention): Attention(
        (wqkv): Linear(in_features=1536, out_features=320, bias=False)
        (wo): Linear(in_features=192, out_features=1536, bias=False)
      )
      (feed_forward): FeedForward(
        (w1): Linear(in_features=1536, out_features=1024, bias=False)
        (w2): Linear(in_features=512, out_features=1536, bias=False)
      )
      (ffn_norm): RMSNorm()
      (attention_norm): RMSNorm()
    )
  )
  (norm): RMSNorm()
  (output): Linear(in_features=1536, out_features=49152, bias=False)
)
Time to load model: 0.16 seconds
[rank1]:[W930 20:04:12.587939890 CUDAGraph.cpp:150] Warning: Waiting for pending NCCL work to finish before starting graph capture. (function operator())
[rank7]:[W930 20:04:12.595683068 CUDAGraph.cpp:150] Warning: Waiting for pending NCCL work to finish before starting graph capture. (function operator())
[rank6]:[W930 20:04:12.611276560 CUDAGraph.cpp:150] Warning: Waiting for pending NCCL work to finish before starting graph capture. (function operator())
Prefill latency: 0.036766225937753916 sec
Decode latency: 2.4472426859429106 sec
Compilation time: 2.51 seconds
Compilation time: 2.49 secondsCompilation time: 2.52 seconds

Compilation time: 2.49 seconds
Compilation time: 2.49 seconds
Compilation time: 2.49 seconds
Compilation time: 2.52 seconds
Compilation time: 2.49 seconds
Prefill latency: 0.03252271702513099 sec
Decode latency: 2.459280840936117 sec
Prefill latency: 0.03186189697589725 sec
Decode latency: 2.4647300749784335 sec
Prefill latency: 0.031365152914077044 sec
Decode latency: 2.4570294469594955 sec
Prefill latency: 0.03175238100811839 sec
Decode latency: 2.456608445965685 sec
Prefill latency: 0.033005150966346264 sec
Decode latency: 2.4490784669760615 sec
Time for inference 1: 2.48 sec total, 824.81 tokens/sec
Decode latency: 2.45 sec
Prefill latency: 0.03 sec
Bandwidth achieved: 332.32 GB/s
FLOPS achieved: 1.66 TF/s

Prefill latency: 0.03112342895474285 sec
Decode latency: 2.4681268950225785 sec
Time for inference 2: 2.50 sec total, 819.14 tokens/sec
Decode latency: 2.47 sec
Prefill latency: 0.03 sec
Bandwidth achieved: 330.03 GB/s
FLOPS achieved: 1.65 TF/s

Prefill latency: 0.032546838046982884 sec
Decode latency: 2.4718205749522895 sec
Time for inference 3: 2.51 sec total, 817.49 tokens/sec
Decode latency: 2.47 sec
Prefill latency: 0.03 sec
Bandwidth achieved: 329.37 GB/s
FLOPS achieved: 1.65 TF/s

Prefill latency: 0.03987175296060741 sec
Decode latency: 2.4605334990192205 sec
Time for inference 4: 2.50 sec total, 818.77 tokens/sec
Decode latency: 2.46 sec
Prefill latency: 0.04 sec
Bandwidth achieved: 329.88 GB/s
FLOPS achieved: 1.65 TF/s

Prefill latency: 0.03186922403983772 sec
Decode latency: 2.4558156890561804 sec
Time for inference 5: 2.49 sec total, 822.93 tokens/sec
Decode latency: 2.46 sec
Prefill latency: 0.03 sec
Bandwidth achieved: 331.56 GB/s
FLOPS achieved: 1.66 TF/s

Prefill latency: 0.031134988996200264 sec
Decode latency: 2.4589495620457456 sec
Time for inference 6: 2.49 sec total, 822.14 tokens/sec
Decode latency: 2.46 sec
Prefill latency: 0.03 sec
Bandwidth achieved: 331.24 GB/s
FLOPS achieved: 1.66 TF/s

Prefill latency: 0.033801940036937594 sec
Decode latency: 2.4571703110123053 sec
Time for inference 7: 2.49 sec total, 821.85 tokens/sec
Decode latency: 2.46 sec
Prefill latency: 0.03 sec
Bandwidth achieved: 331.12 GB/s
FLOPS achieved: 1.66 TF/s

Prefill latency: 0.031745961983688176 sec
Decode latency: 2.4601920769782737 sec
Time for inference 8: 2.49 sec total, 821.53 tokens/sec
Decode latency: 2.46 sec
Prefill latency: 0.03 sec
Bandwidth achieved: 331.00 GB/s
FLOPS achieved: 1.65 TF/s

Prefill latency: 0.03090405196417123 sec
Decode latency: 2.451132945017889 sec
Time for inference 9: 2.48 sec total, 824.82 tokens/sec
Decode latency: 2.45 sec
Prefill latency: 0.03 sec
Bandwidth achieved: 332.32 GB/s
FLOPS achieved: 1.66 TF/s

Prefill latency: 0.031207949039526284 sec
Decode latency: 2.4557973430491984 sec
Time for inference 10: 2.49 sec total, 823.16 tokens/sec
Decode latency: 2.46 sec
Prefill latency: 0.03 sec
Bandwidth achieved: 331.65 GB/s
FLOPS achieved: 1.66 TF/s

==========
Batch Size: 8
Prompt Length: 1024
Generated tokens: 256
Average decode latency: 2.4589 sec
Average prefill latency: 0.0327 sec
Average tokens/sec: 821.66
Memory used: 3.77 GB
Done. we are killing the process
