flash_kv_decode is set to True
Using device=cuda
Loading model ...
GPTDense(
  (tok_embeddings): Embedding(49152, 1536)
  (layers): ModuleList(
    (0-39): 40 x DenseTransformerBlock(
      semi_compiled = False
      (attention): Attention(
        (wqkv): Linear(in_features=1536, out_features=4608, bias=False)
        (wo): Linear(in_features=1536, out_features=1536, bias=False)
      )
      (feed_forward): FeedForward(
        (w1): Linear(in_features=1536, out_features=8192, bias=False)
        (w2): Linear(in_features=4096, out_features=1536, bias=False)
      )
      (ffn_norm): RMSNorm()
      (attention_norm): RMSNorm()
    )
  )
  (norm): RMSNorm()
  (output): Linear(in_features=1536, out_features=49152, bias=False)
)
Time to load model: 0.94 seconds
[rank0]:[W1001 03:13:16.412644799 CUDAGraph.cpp:150] Warning: Waiting for pending NCCL work to finish before starting graph capture. (function operator())
Prefill latency: 0.20749711396638304 sec
Decode latency: 3.3885628290008754 sec
Compilation time: 3.60 seconds
Prefill latency: 0.20709417795296758 sec
Decode latency: 3.381227510049939 sec
Prefill latency: 0.20680705306585878 sec
Decode latency: 3.242032245034352 sec
Prefill latency: 0.20684647699818015 sec
Decode latency: 3.2499080889392644 sec
Prefill latency: 0.20698364404961467 sec
Decode latency: 3.2719680640148 sec
Prefill latency: 0.20687431702390313 sec
Decode latency: 3.287627781042829 sec
Time for inference 1: 3.50 sec total, 1171.88 tokens/sec
Decode latency: 3.29 sec
Prefill latency: 0.21 sec
Bandwidth achieved: 2831.47 GB/s
FLOPS achieved: 14.16 TF/s

Prefill latency: 0.20684955909382552 sec
Decode latency: 3.3831076059723273 sec
Time for inference 2: 3.59 sec total, 1140.74 tokens/sec
Decode latency: 3.38 sec
Prefill latency: 0.21 sec
Bandwidth achieved: 2756.21 GB/s
FLOPS achieved: 13.78 TF/s

Prefill latency: 0.20685654296539724 sec
Decode latency: 3.3827054239809513 sec
Time for inference 3: 3.59 sec total, 1140.84 tokens/sec
Decode latency: 3.38 sec
Prefill latency: 0.21 sec
Bandwidth achieved: 2756.46 GB/s
FLOPS achieved: 13.78 TF/s

Prefill latency: 0.20695064100436866 sec
Decode latency: 3.384290836052969 sec
Time for inference 4: 3.59 sec total, 1140.23 tokens/sec
Decode latency: 3.38 sec
Prefill latency: 0.21 sec
Bandwidth achieved: 2754.98 GB/s
FLOPS achieved: 13.77 TF/s

Prefill latency: 0.2069377270527184 sec
Decode latency: 3.382139984983951 sec
Time for inference 5: 3.59 sec total, 1140.93 tokens/sec
Decode latency: 3.38 sec
Prefill latency: 0.21 sec
Bandwidth achieved: 2756.67 GB/s
FLOPS achieved: 13.78 TF/s

Prefill latency: 0.20691499405074865 sec
Decode latency: 3.2966085569933057 sec
Time for inference 6: 3.50 sec total, 1168.81 tokens/sec
Decode latency: 3.30 sec
Prefill latency: 0.21 sec
Bandwidth achieved: 2824.05 GB/s
FLOPS achieved: 14.12 TF/s

Prefill latency: 0.20701244403608143 sec
Decode latency: 3.352408272912726 sec
Time for inference 7: 3.56 sec total, 1150.50 tokens/sec
Decode latency: 3.35 sec
Prefill latency: 0.21 sec
Bandwidth achieved: 2779.81 GB/s
FLOPS achieved: 13.90 TF/s

Prefill latency: 0.20696199499070644 sec
Decode latency: 3.304944114992395 sec
Time for inference 8: 3.51 sec total, 1166.05 tokens/sec
Decode latency: 3.30 sec
Prefill latency: 0.21 sec
Bandwidth achieved: 2817.38 GB/s
FLOPS achieved: 14.09 TF/s

Prefill latency: 0.20704592403490096 sec
Decode latency: 3.3837089280132204 sec
Time for inference 9: 3.59 sec total, 1140.47 tokens/sec
Decode latency: 3.38 sec
Prefill latency: 0.21 sec
Bandwidth achieved: 2755.57 GB/s
FLOPS achieved: 13.78 TF/s

Prefill latency: 0.20691128494217992 sec
Decode latency: 3.381527567980811 sec
Time for inference 10: 3.59 sec total, 1141.21 tokens/sec
Decode latency: 3.38 sec
Prefill latency: 0.21 sec
Bandwidth achieved: 2757.36 GB/s
FLOPS achieved: 13.79 TF/s

==========
Batch Size: 16
Prompt Length: 1024
Generated tokens: 256
Average decode latency: 3.3539 sec
Average prefill latency: 0.2069 sec
Average tokens/sec: 1150.17
Memory used: 15.76 GB
Done. we are killing the process
