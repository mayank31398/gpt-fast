flash_kv_decode is set to True
Using device=cuda
Loading model ...
GPTParallel(
  (tok_embeddings): Embedding(49152, 2304)
  (layers): ModuleList(
    (0-39): 40 x ParallelTransformerBlock(
      semi_compiled = False
      (attention): FuseAttentionMLP(
        (wqkv1): Linear(in_features=2304, out_features=25344, bias=False)
        (wo): Linear(in_features=2304, out_features=2304, bias=False)
        (w2): Linear(in_features=9216, out_features=2304, bias=False)
      )
      (attention_norm): RMSNorm()
    )
  )
  (norm): RMSNorm()
  (output): Linear(in_features=2304, out_features=49152, bias=False)
)
Time to load model: 0.93 seconds
[rank0]:[W1001 03:51:16.888844530 CUDAGraph.cpp:150] Warning: Waiting for pending NCCL work to finish before starting graph capture. (function operator())
Prefill latency: 0.10322282300330698 sec
Decode latency: 2.938781225006096 sec
Compilation time: 3.04 seconds
Prefill latency: 0.10251375404186547 sec
Decode latency: 2.9596282560378313 sec
Prefill latency: 0.10259754804428667 sec
Decode latency: 3.0006866889307275 sec
Prefill latency: 0.10240216506645083 sec
Decode latency: 2.872862108051777 sec
Prefill latency: 0.10248443798627704 sec
Decode latency: 3.000890539959073 sec
Prefill latency: 0.10250582406297326 sec
Decode latency: 3.0015307209687307 sec
Time for inference 1: 3.10 sec total, 329.81 tokens/sec
Decode latency: 3.00 sec
Prefill latency: 0.10 sec
Bandwidth achieved: 2315.78 GB/s
FLOPS achieved: 11.58 TF/s

Prefill latency: 0.10242616198956966 sec
Decode latency: 3.001890560030006 sec
Time for inference 2: 3.11 sec total, 329.79 tokens/sec
Decode latency: 3.00 sec
Prefill latency: 0.10 sec
Bandwidth achieved: 2315.59 GB/s
FLOPS achieved: 11.58 TF/s

Prefill latency: 0.10244201391469687 sec
Decode latency: 2.88616129104048 sec
Time for inference 3: 2.99 sec total, 342.55 tokens/sec
Decode latency: 2.89 sec
Prefill latency: 0.10 sec
Bandwidth achieved: 2405.23 GB/s
FLOPS achieved: 12.03 TF/s

Prefill latency: 0.10248537093866616 sec
Decode latency: 2.8787239840021357 sec
Time for inference 4: 2.98 sec total, 343.40 tokens/sec
Decode latency: 2.88 sec
Prefill latency: 0.10 sec
Bandwidth achieved: 2411.20 GB/s
FLOPS achieved: 12.06 TF/s

Prefill latency: 0.10273940907791257 sec
Decode latency: 2.879715009010397 sec
Time for inference 5: 2.98 sec total, 343.26 tokens/sec
Decode latency: 2.88 sec
Prefill latency: 0.10 sec
Bandwidth achieved: 2410.20 GB/s
FLOPS achieved: 12.05 TF/s

Prefill latency: 0.10259368096012622 sec
Decode latency: 2.9589004160370678 sec
Time for inference 6: 3.06 sec total, 334.39 tokens/sec
Decode latency: 2.96 sec
Prefill latency: 0.10 sec
Bandwidth achieved: 2347.88 GB/s
FLOPS achieved: 11.74 TF/s

Prefill latency: 0.10256133310031146 sec
Decode latency: 2.9491433890070766 sec
Time for inference 7: 3.05 sec total, 335.47 tokens/sec
Decode latency: 2.95 sec
Prefill latency: 0.10 sec
Bandwidth achieved: 2355.47 GB/s
FLOPS achieved: 11.78 TF/s

Prefill latency: 0.10249097307678312 sec
Decode latency: 3.0011664769845083 sec
Time for inference 8: 3.10 sec total, 329.83 tokens/sec
Decode latency: 3.00 sec
Prefill latency: 0.10 sec
Bandwidth achieved: 2315.92 GB/s
FLOPS achieved: 11.58 TF/s

Prefill latency: 0.10264210891909897 sec
Decode latency: 3.0022246999433264 sec
Time for inference 9: 3.11 sec total, 329.72 tokens/sec
Decode latency: 3.00 sec
Prefill latency: 0.10 sec
Bandwidth achieved: 2315.14 GB/s
FLOPS achieved: 11.58 TF/s

Prefill latency: 0.10243890702258795 sec
Decode latency: 2.9174218139378354 sec
Time for inference 10: 3.02 sec total, 339.01 tokens/sec
Decode latency: 2.92 sec
Prefill latency: 0.10 sec
Bandwidth achieved: 2380.31 GB/s
FLOPS achieved: 11.90 TF/s

==========
Batch Size: 4
Prompt Length: 1024
Generated tokens: 256
Average decode latency: 2.9477 sec
Average prefill latency: 0.1025 sec
Average tokens/sec: 335.72
Memory used: 11.26 GB
Done. we are killing the process
