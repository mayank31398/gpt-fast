flash_kv_decode is set to True
Using device=cuda
Loading model ...
GPTParallel(
  (tok_embeddings): Embedding(49152, 2304)
  (layers): ModuleList(
    (0-39): 40 x ParallelTransformerBlock(
      semi_compiled = False
      (attention): FuseAttentionMLP(
        (wqkv1): Linear(in_features=2304, out_features=25344, bias=False)
        (wo): Linear(in_features=2304, out_features=2304, bias=False)
        (w2): Linear(in_features=9216, out_features=2304, bias=False)
      )
      (attention_norm): RMSNorm()
    )
  )
  (norm): RMSNorm()
  (output): Linear(in_features=2304, out_features=49152, bias=False)
)
Time to load model: 0.97 seconds
[rank0]:[W1001 04:00:57.135985593 CUDAGraph.cpp:150] Warning: Waiting for pending NCCL work to finish before starting graph capture. (function operator())
Prefill latency: 1.610296328086406 sec
Decode latency: 12.61428469303064 sec
Compilation time: 14.23 seconds
Prefill latency: 1.6243359900545329 sec
Decode latency: 12.501679114997387 sec
Prefill latency: 1.6169614910613745 sec
Decode latency: 12.614468771032989 sec
Prefill latency: 1.6246260040206835 sec
Decode latency: 12.614568304968998 sec
Prefill latency: 1.6248093559406698 sec
Decode latency: 12.612733787042089 sec
Prefill latency: 1.6258208480430767 sec
Decode latency: 12.615407346980646 sec
Time for inference 1: 14.24 sec total, 1150.38 tokens/sec
Decode latency: 12.62 sec
Prefill latency: 1.63 sec
Bandwidth achieved: 8077.34 GB/s
FLOPS achieved: 40.39 TF/s

Prefill latency: 1.6228606200311333 sec
Decode latency: 12.485970014007762 sec
Time for inference 2: 14.11 sec total, 1161.16 tokens/sec
Decode latency: 12.49 sec
Prefill latency: 1.62 sec
Bandwidth achieved: 8153.04 GB/s
FLOPS achieved: 40.77 TF/s

Prefill latency: 1.6130644330987707 sec
Decode latency: 12.61372520797886 sec
Time for inference 3: 14.23 sec total, 1151.54 tokens/sec
Decode latency: 12.61 sec
Prefill latency: 1.61 sec
Bandwidth achieved: 8085.48 GB/s
FLOPS achieved: 40.43 TF/s

Prefill latency: 1.6255702869966626 sec
Decode latency: 12.61497644695919 sec
Time for inference 4: 14.24 sec total, 1150.43 tokens/sec
Decode latency: 12.61 sec
Prefill latency: 1.63 sec
Bandwidth achieved: 8077.66 GB/s
FLOPS achieved: 40.39 TF/s

Prefill latency: 1.6242421149509028 sec
Decode latency: 12.584703761036508 sec
Time for inference 5: 14.21 sec total, 1153.00 tokens/sec
Decode latency: 12.58 sec
Prefill latency: 1.62 sec
Bandwidth achieved: 8095.70 GB/s
FLOPS achieved: 40.48 TF/s

Prefill latency: 1.6138936979696155 sec
Decode latency: 12.614644184010103 sec
Time for inference 6: 14.23 sec total, 1151.40 tokens/sec
Decode latency: 12.61 sec
Prefill latency: 1.61 sec
Bandwidth achieved: 8084.50 GB/s
FLOPS achieved: 40.42 TF/s

Prefill latency: 1.6243453840725124 sec
Decode latency: 12.550042830989696 sec
Time for inference 7: 14.18 sec total, 1155.80 tokens/sec
Decode latency: 12.55 sec
Prefill latency: 1.62 sec
Bandwidth achieved: 8115.42 GB/s
FLOPS achieved: 40.58 TF/s

Prefill latency: 1.6283934159437194 sec
Decode latency: 12.531705649918877 sec
Time for inference 8: 14.16 sec total, 1156.97 tokens/sec
Decode latency: 12.53 sec
Prefill latency: 1.63 sec
Bandwidth achieved: 8123.58 GB/s
FLOPS achieved: 40.62 TF/s

Prefill latency: 1.6270191600779071 sec
Decode latency: 12.546125728054903 sec
Time for inference 9: 14.17 sec total, 1155.91 tokens/sec
Decode latency: 12.55 sec
Prefill latency: 1.63 sec
Bandwidth achieved: 8116.13 GB/s
FLOPS achieved: 40.58 TF/s

Prefill latency: 1.6128631809260696 sec
Decode latency: 12.571723436936736 sec
Time for inference 10: 14.19 sec total, 1154.97 tokens/sec
Decode latency: 12.57 sec
Prefill latency: 1.61 sec
Bandwidth achieved: 8109.57 GB/s
FLOPS achieved: 40.55 TF/s

==========
Batch Size: 64
Prompt Length: 1024
Generated tokens: 256
Average decode latency: 12.5729 sec
Average prefill latency: 1.6218 sec
Average tokens/sec: 1154.15
Memory used: 65.21 GB
Done. we are killing the process
