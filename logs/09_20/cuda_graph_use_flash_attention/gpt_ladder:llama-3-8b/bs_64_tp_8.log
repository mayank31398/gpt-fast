W0920 06:18:00.053000 22927665223488 torch/distributed/run.py:779] 
W0920 06:18:00.053000 22927665223488 torch/distributed/run.py:779] *****************************************
W0920 06:18:00.053000 22927665223488 torch/distributed/run.py:779] Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
W0920 06:18:00.053000 22927665223488 torch/distributed/run.py:779] *****************************************
flash_kv_decode is set to True
Using device=cuda
Loading model ...
GPTLadder(
  (tok_embeddings): Embedding(128256, 4096)
  (layers): ModuleList(
    (0-31): 32 x LadderTransformerBlock(
      semi_compiled = False
      (attention): Attention(
        (wqkv): Linear(in_features=4096, out_features=768, bias=False)
        (wo): Linear(in_features=512, out_features=4096, bias=False)
      )
      (feed_forward): FeedForward(
        (w1): Linear(in_features=4096, out_features=3584, bias=False)
        (w2): Linear(in_features=1792, out_features=4096, bias=False)
      )
      (ffn_norm): RMSNorm()
      (attention_norm): RMSNorm()
    )
  )
  (norm): RMSNorm()
  (output): Linear(in_features=4096, out_features=128256, bias=False)
)
Time to load model: 0.09 seconds
Prefill latency: 0.5231234282255173 sec
Decode latency: 3.866282654926181 sec
Compilation time: 4.38 secondsCompilation time: 4.41 seconds

Compilation time: 4.38 seconds
Compilation time: 4.39 seconds
Compilation time: 4.41 seconds
Compilation time: 4.40 seconds
Compilation time: 4.41 seconds
Compilation time: 4.38 seconds
Prefill latency: 0.5011960957199335 sec
Decode latency: 3.8637816477566957 sec
Prefill latency: 0.5043677873909473 sec
Decode latency: 3.8631839491426945 sec
Prefill latency: 0.5018564164638519 sec
Decode latency: 3.8270806837826967 sec
Prefill latency: 0.5050897728651762 sec
Decode latency: 3.866193749010563 sec
Prefill latency: 0.5042425524443388 sec
Decode latency: 3.840533809736371 sec
Time for inference 1: 4.35 sec total, 3770.36 tokens/sec
Decode latency: 3.84 sec
Prefill latency: 0.50 sec
Bandwidth achieved: 10542.06 GB/s
FLOPS achieved: 52.71 TF/s

Prefill latency: 0.5048410017043352 sec
Decode latency: 3.8645400665700436 sec
Time for inference 2: 4.37 sec total, 3749.18 tokens/sec
Decode latency: 3.86 sec
Prefill latency: 0.50 sec
Bandwidth achieved: 10482.84 GB/s
FLOPS achieved: 52.41 TF/s

Prefill latency: 0.5047911703586578 sec
Decode latency: 3.864195339381695 sec
Time for inference 3: 4.37 sec total, 3749.42 tokens/sec
Decode latency: 3.86 sec
Prefill latency: 0.50 sec
Bandwidth achieved: 10483.51 GB/s
FLOPS achieved: 52.42 TF/s

Prefill latency: 0.5020547602325678 sec
Decode latency: 3.867871806025505 sec
Time for inference 4: 4.37 sec total, 3748.73 tokens/sec
Decode latency: 3.87 sec
Prefill latency: 0.50 sec
Bandwidth achieved: 10481.59 GB/s
FLOPS achieved: 52.41 TF/s

Prefill latency: 0.5049894079566002 sec
Decode latency: 3.865148799493909 sec
Time for inference 5: 4.37 sec total, 3748.53 tokens/sec
Decode latency: 3.87 sec
Prefill latency: 0.50 sec
Bandwidth achieved: 10481.03 GB/s
FLOPS achieved: 52.41 TF/s

Prefill latency: 0.5053817238658667 sec
Decode latency: 3.864558769389987 sec
Time for inference 6: 4.37 sec total, 3748.69 tokens/sec
Decode latency: 3.86 sec
Prefill latency: 0.51 sec
Bandwidth achieved: 10481.49 GB/s
FLOPS achieved: 52.41 TF/s

Prefill latency: 0.5060370042920113 sec
Decode latency: 3.864561727270484 sec
Time for inference 7: 4.37 sec total, 3748.13 tokens/sec
Decode latency: 3.86 sec
Prefill latency: 0.51 sec
Bandwidth achieved: 10479.90 GB/s
FLOPS achieved: 52.40 TF/s

Prefill latency: 0.5056238751858473 sec
Decode latency: 3.8557323329150677 sec
Time for inference 8: 4.36 sec total, 3756.08 tokens/sec
Decode latency: 3.86 sec
Prefill latency: 0.51 sec
Bandwidth achieved: 10502.14 GB/s
FLOPS achieved: 52.51 TF/s

Prefill latency: 0.5060587283223867 sec
Decode latency: 3.863521136343479 sec
Time for inference 9: 4.37 sec total, 3749.01 tokens/sec
Decode latency: 3.86 sec
Prefill latency: 0.51 sec
Bandwidth achieved: 10482.38 GB/s
FLOPS achieved: 52.41 TF/s

Prefill latency: 0.5068202335387468 sec
Decode latency: 3.864379186183214 sec
Time for inference 10: 4.37 sec total, 3747.65 tokens/sec
Decode latency: 3.86 sec
Prefill latency: 0.51 sec
Bandwidth achieved: 10478.56 GB/s
FLOPS achieved: 52.39 TF/s

==========
Batch Size: 64
Prompt Length: 1024
Generated tokens: 256
Average decode latency: 3.8615 sec
Average prefill latency: 0.5051 sec
Average tokens/sec: 3751.58
Memory used: 60.33 GB
[rank5]:[E920 06:29:48.618808575 ProcessGroupNCCL.cpp:1076] [PG 0 (default_pg) Rank 5] Future for ProcessGroup abort timed out after 600000 ms
[rank1]:[E920 06:29:48.618811893 ProcessGroupNCCL.cpp:1076] [PG 0 (default_pg) Rank 1] Future for ProcessGroup abort timed out after 600000 ms
[rank6]:[E920 06:29:48.618809199 ProcessGroupNCCL.cpp:1076] [PG 0 (default_pg) Rank 6] Future for ProcessGroup abort timed out after 600000 ms
[rank2]:[E920 06:29:48.618811924 ProcessGroupNCCL.cpp:1076] [PG 0 (default_pg) Rank 2] Future for ProcessGroup abort timed out after 600000 ms
[rank3]:[E920 06:29:48.618840919 ProcessGroupNCCL.cpp:1076] [PG 0 (default_pg) Rank 3] Future for ProcessGroup abort timed out after 600000 ms
[rank0]:[E920 06:29:48.618842747 ProcessGroupNCCL.cpp:1076] [PG 0 (default_pg) Rank 0] Future for ProcessGroup abort timed out after 600000 ms
[rank7]:[E920 06:29:48.618842950 ProcessGroupNCCL.cpp:1076] [PG 0 (default_pg) Rank 7] Future for ProcessGroup abort timed out after 600000 ms
[rank4]:[E920 06:29:48.618850786 ProcessGroupNCCL.cpp:1076] [PG 0 (default_pg) Rank 4] Future for ProcessGroup abort timed out after 600000 ms
[rank7]:[E920 06:38:14.060107984 ProcessGroupNCCL.cpp:1375] [PG 0 (default_pg) Rank 7] First PG on this rank that detected no heartbeat of its watchdog.
[rank7]:[E920 06:38:14.060169689 ProcessGroupNCCL.cpp:1413] [PG 0 (default_pg) Rank 7] Heartbeat monitor timed out! Process will be terminated after dumping debug info. workMetaList_.size()=0
[rank5]:[E920 06:38:14.081959877 ProcessGroupNCCL.cpp:1375] [PG 0 (default_pg) Rank 5] First PG on this rank that detected no heartbeat of its watchdog.
[rank5]:[E920 06:38:14.082005266 ProcessGroupNCCL.cpp:1413] [PG 0 (default_pg) Rank 5] Heartbeat monitor timed out! Process will be terminated after dumping debug info. workMetaList_.size()=0
[rank1]:[E920 06:38:14.094943907 ProcessGroupNCCL.cpp:1375] [PG 0 (default_pg) Rank 1] First PG on this rank that detected no heartbeat of its watchdog.
[rank1]:[E920 06:38:14.094989761 ProcessGroupNCCL.cpp:1413] [PG 0 (default_pg) Rank 1] Heartbeat monitor timed out! Process will be terminated after dumping debug info. workMetaList_.size()=0
[rank6]:[E920 06:38:14.104078456 ProcessGroupNCCL.cpp:1375] [PG 0 (default_pg) Rank 6] First PG on this rank that detected no heartbeat of its watchdog.
[rank6]:[E920 06:38:14.104127959 ProcessGroupNCCL.cpp:1413] [PG 0 (default_pg) Rank 6] Heartbeat monitor timed out! Process will be terminated after dumping debug info. workMetaList_.size()=0
[rank0]:[E920 06:38:14.128713723 ProcessGroupNCCL.cpp:1375] [PG 0 (default_pg) Rank 0] First PG on this rank that detected no heartbeat of its watchdog.
[rank0]:[E920 06:38:14.128757523 ProcessGroupNCCL.cpp:1413] [PG 0 (default_pg) Rank 0] Heartbeat monitor timed out! Process will be terminated after dumping debug info. workMetaList_.size()=0
[rank2]:[E920 06:38:14.138709770 ProcessGroupNCCL.cpp:1375] [PG 0 (default_pg) Rank 2] First PG on this rank that detected no heartbeat of its watchdog.
[rank2]:[E920 06:38:14.138750327 ProcessGroupNCCL.cpp:1413] [PG 0 (default_pg) Rank 2] Heartbeat monitor timed out! Process will be terminated after dumping debug info. workMetaList_.size()=0
[rank3]:[E920 06:38:14.140107746 ProcessGroupNCCL.cpp:1375] [PG 0 (default_pg) Rank 3] First PG on this rank that detected no heartbeat of its watchdog.
[rank3]:[E920 06:38:14.140159281 ProcessGroupNCCL.cpp:1413] [PG 0 (default_pg) Rank 3] Heartbeat monitor timed out! Process will be terminated after dumping debug info. workMetaList_.size()=0
[rank4]:[E920 06:38:14.144995334 ProcessGroupNCCL.cpp:1375] [PG 0 (default_pg) Rank 4] First PG on this rank that detected no heartbeat of its watchdog.
[rank4]:[E920 06:38:14.145078536 ProcessGroupNCCL.cpp:1413] [PG 0 (default_pg) Rank 4] Heartbeat monitor timed out! Process will be terminated after dumping debug info. workMetaList_.size()=0
W0920 06:38:35.778000 22927665223488 torch/distributed/elastic/agent/server/api.py:688] Received Signals.SIGTERM death signal, shutting down workers
W0920 06:38:35.780000 22927665223488 torch/distributed/elastic/multiprocessing/api.py:858] Sending process 1778895 closing signal SIGTERM
W0920 06:38:35.781000 22927665223488 torch/distributed/elastic/multiprocessing/api.py:858] Sending process 1778896 closing signal SIGTERM
W0920 06:38:35.781000 22927665223488 torch/distributed/elastic/multiprocessing/api.py:858] Sending process 1778897 closing signal SIGTERM
W0920 06:38:35.781000 22927665223488 torch/distributed/elastic/multiprocessing/api.py:858] Sending process 1778898 closing signal SIGTERM
W0920 06:38:35.781000 22927665223488 torch/distributed/elastic/multiprocessing/api.py:858] Sending process 1778899 closing signal SIGTERM
W0920 06:38:35.781000 22927665223488 torch/distributed/elastic/multiprocessing/api.py:858] Sending process 1778900 closing signal SIGTERM
W0920 06:38:35.781000 22927665223488 torch/distributed/elastic/multiprocessing/api.py:858] Sending process 1778901 closing signal SIGTERM
W0920 06:38:35.781000 22927665223488 torch/distributed/elastic/multiprocessing/api.py:858] Sending process 1778902 closing signal SIGTERM
Traceback (most recent call last):
  File "/home/charlie/anaconda3/envs/gpt-fast/bin/torchrun", line 8, in <module>
    sys.exit(main())
  File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/distributed/elastic/multiprocessing/errors/__init__.py", line 348, in wrapper
    return f(*args, **kwargs)
  File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/distributed/run.py", line 901, in main
    run(args)
  File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/distributed/run.py", line 892, in run
    elastic_launch(
  File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/distributed/launcher/api.py", line 133, in __call__
    return launch_agent(self._config, self._entrypoint, list(args))
  File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/distributed/launcher/api.py", line 255, in launch_agent
    result = agent.run()
  File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/distributed/elastic/metrics/api.py", line 124, in wrapper
    result = f(*args, **kwargs)
  File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/distributed/elastic/agent/server/api.py", line 680, in run
    result = self._invoke_run(role)
  File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/distributed/elastic/agent/server/api.py", line 835, in _invoke_run
    time.sleep(monitor_interval)
  File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/distributed/elastic/multiprocessing/api.py", line 79, in _terminate_process_handler
    raise SignalException(f"Process {os.getpid()} got signal: {sigval}", sigval=sigval)
torch.distributed.elastic.multiprocessing.api.SignalException: Process 1778821 got signal: 15
