flash_kv_decode is set to True
Using device=cuda
Loading model ...
GPTLadder(
  (tok_embeddings): Embedding(128256, 4096)
  (layers): ModuleList(
    (0-31): 32 x LadderTransformerBlock(
      semi_compiled = False
      (attention): Attention(
        (wqkv): Linear(in_features=4096, out_features=6144, bias=False)
        (wo): Linear(in_features=4096, out_features=4096, bias=False)
      )
      (feed_forward): FeedForward(
        (w1): Linear(in_features=4096, out_features=28672, bias=False)
        (w2): Linear(in_features=14336, out_features=4096, bias=False)
      )
      (ffn_norm): RMSNorm()
      (attention_norm): RMSNorm()
    )
  )
  (norm): RMSNorm()
  (output): Linear(in_features=4096, out_features=128256, bias=False)
)
Time to load model: 0.24 seconds
/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/contextlib.py:103: FutureWarning: `torch.backends.cuda.sdp_kernel()` is deprecated. In the future, this context manager will be removed. Please see `torch.nn.attention.sdpa_kernel()` for the new context manager, with updated signature.
  self.gen = func(*args, **kwds)
Prefill latency: 1.4740233328193426 sec
Decode latency: 7.366099322214723 sec
Compilation time: 8.84 seconds
Prefill latency: 0.04451279155910015 sec
Decode latency: 7.009685022756457 sec
Prefill latency: 0.04323973506689072 sec
Decode latency: 6.992765944451094 sec
Prefill latency: 0.044083498418331146 sec
Decode latency: 7.008340127766132 sec
Prefill latency: 0.04386315122246742 sec
Decode latency: 6.991956988349557 sec
Prefill latency: 0.04308714345097542 sec
Decode latency: 7.109355507418513 sec
Time for inference 1: 7.15 sec total, 35.79 tokens/sec
Decode latency: 7.11 sec
Prefill latency: 0.04 sec
Bandwidth achieved: 537.15 GB/s
FLOPS achieved: 2.69 TF/s

Prefill latency: 0.043637024238705635 sec
Decode latency: 7.089562026783824 sec
Time for inference 2: 7.13 sec total, 35.88 tokens/sec
Decode latency: 7.09 sec
Prefill latency: 0.04 sec
Bandwidth achieved: 538.59 GB/s
FLOPS achieved: 2.69 TF/s

Prefill latency: 0.042856475338339806 sec
Decode latency: 6.988429808989167 sec
Time for inference 3: 7.03 sec total, 36.40 tokens/sec
Decode latency: 6.99 sec
Prefill latency: 0.04 sec
Bandwidth achieved: 546.41 GB/s
FLOPS achieved: 2.73 TF/s

Prefill latency: 0.044205810874700546 sec
Decode latency: 7.054516961798072 sec
Time for inference 4: 7.10 sec total, 36.06 tokens/sec
Decode latency: 7.05 sec
Prefill latency: 0.04 sec
Bandwidth achieved: 541.20 GB/s
FLOPS achieved: 2.71 TF/s

Prefill latency: 0.044267332181334496 sec
Decode latency: 7.507758634164929 sec
Time for inference 5: 7.55 sec total, 33.89 tokens/sec
Decode latency: 7.51 sec
Prefill latency: 0.04 sec
Bandwidth achieved: 508.73 GB/s
FLOPS achieved: 2.54 TF/s

Prefill latency: 0.04409180022776127 sec
Decode latency: 7.398760128766298 sec
Time for inference 6: 7.44 sec total, 34.39 tokens/sec
Decode latency: 7.40 sec
Prefill latency: 0.04 sec
Bandwidth achieved: 516.19 GB/s
FLOPS achieved: 2.58 TF/s

Prefill latency: 0.04374440014362335 sec
Decode latency: 7.32674583978951 sec
Time for inference 7: 7.37 sec total, 34.73 tokens/sec
Decode latency: 7.33 sec
Prefill latency: 0.04 sec
Bandwidth achieved: 521.26 GB/s
FLOPS achieved: 2.61 TF/s

Prefill latency: 0.04357050359249115 sec
Decode latency: 7.322082692757249 sec
Time for inference 8: 7.37 sec total, 34.75 tokens/sec
Decode latency: 7.32 sec
Prefill latency: 0.04 sec
Bandwidth achieved: 521.60 GB/s
FLOPS achieved: 2.61 TF/s

Prefill latency: 0.043332548812031746 sec
Decode latency: 7.307143593207002 sec
Time for inference 9: 7.35 sec total, 34.82 tokens/sec
Decode latency: 7.31 sec
Prefill latency: 0.04 sec
Bandwidth achieved: 522.68 GB/s
FLOPS achieved: 2.61 TF/s

Prefill latency: 0.0434594601392746 sec
Decode latency: 7.504433052614331 sec
Time for inference 10: 7.55 sec total, 33.91 tokens/sec
Decode latency: 7.50 sec
Prefill latency: 0.04 sec
Bandwidth achieved: 509.01 GB/s
FLOPS achieved: 2.55 TF/s

==========
Batch Size: 1
Prompt Length: 1024
Generated tokens: 256
Average decode latency: 7.2609 sec
Average prefill latency: 0.0436 sec
Average tokens/sec: 35.06
Memory used: 16.86 GB
