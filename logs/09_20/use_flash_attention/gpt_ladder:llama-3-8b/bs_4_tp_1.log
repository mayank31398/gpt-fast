flash_kv_decode is set to True
Using device=cuda
Loading model ...
GPTLadder(
  (tok_embeddings): Embedding(128256, 4096)
  (layers): ModuleList(
    (0-31): 32 x LadderTransformerBlock(
      semi_compiled = False
      (attention): Attention(
        (wqkv): Linear(in_features=4096, out_features=6144, bias=False)
        (wo): Linear(in_features=4096, out_features=4096, bias=False)
      )
      (feed_forward): FeedForward(
        (w1): Linear(in_features=4096, out_features=28672, bias=False)
        (w2): Linear(in_features=14336, out_features=4096, bias=False)
      )
      (ffn_norm): RMSNorm()
      (attention_norm): RMSNorm()
    )
  )
  (norm): RMSNorm()
  (output): Linear(in_features=4096, out_features=128256, bias=False)
)
Time to load model: 0.23 seconds
/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/contextlib.py:103: FutureWarning: `torch.backends.cuda.sdp_kernel()` is deprecated. In the future, this context manager will be removed. Please see `torch.nn.attention.sdpa_kernel()` for the new context manager, with updated signature.
  self.gen = func(*args, **kwds)
Prefill latency: 1.5785342510789633 sec
Decode latency: 7.802573766559362 sec
Compilation time: 9.38 seconds
Prefill latency: 0.13075242936611176 sec
Decode latency: 7.615759456530213 sec
Prefill latency: 0.13010313920676708 sec
Decode latency: 7.627319512888789 sec
Prefill latency: 0.12964246235787868 sec
Decode latency: 7.736576994881034 sec
Prefill latency: 0.13079477287828922 sec
Decode latency: 7.57752276211977 sec
Prefill latency: 0.13016320765018463 sec
Decode latency: 7.564968951046467 sec
Time for inference 1: 7.70 sec total, 133.05 tokens/sec
Decode latency: 7.56 sec
Prefill latency: 0.13 sec
Bandwidth achieved: 1997.11 GB/s
FLOPS achieved: 9.99 TF/s

Prefill latency: 0.1303818579763174 sec
Decode latency: 7.616919314488769 sec
Time for inference 2: 7.75 sec total, 132.16 tokens/sec
Decode latency: 7.62 sec
Prefill latency: 0.13 sec
Bandwidth achieved: 1983.67 GB/s
FLOPS achieved: 9.92 TF/s

Prefill latency: 0.13107724115252495 sec
Decode latency: 7.639815775677562 sec
Time for inference 3: 7.77 sec total, 131.76 tokens/sec
Decode latency: 7.64 sec
Prefill latency: 0.13 sec
Bandwidth achieved: 1977.65 GB/s
FLOPS achieved: 9.89 TF/s

Prefill latency: 0.13059067353606224 sec
Decode latency: 7.589613746851683 sec
Time for inference 4: 7.72 sec total, 132.62 tokens/sec
Decode latency: 7.59 sec
Prefill latency: 0.13 sec
Bandwidth achieved: 1990.61 GB/s
FLOPS achieved: 9.95 TF/s

Prefill latency: 0.13102187402546406 sec
Decode latency: 7.587937479838729 sec
Time for inference 5: 7.72 sec total, 132.64 tokens/sec
Decode latency: 7.59 sec
Prefill latency: 0.13 sec
Bandwidth achieved: 1990.95 GB/s
FLOPS achieved: 9.95 TF/s

Prefill latency: 0.13063166476786137 sec
Decode latency: 7.652312804013491 sec
Time for inference 6: 7.78 sec total, 131.55 tokens/sec
Decode latency: 7.65 sec
Prefill latency: 0.13 sec
Bandwidth achieved: 1974.58 GB/s
FLOPS achieved: 9.87 TF/s

Prefill latency: 0.1302313655614853 sec
Decode latency: 7.676556849852204 sec
Time for inference 7: 7.81 sec total, 131.15 tokens/sec
Decode latency: 7.68 sec
Prefill latency: 0.13 sec
Bandwidth achieved: 1968.51 GB/s
FLOPS achieved: 9.84 TF/s

Prefill latency: 0.13048494793474674 sec
Decode latency: 7.683901758864522 sec
Time for inference 8: 7.82 sec total, 131.02 tokens/sec
Decode latency: 7.68 sec
Prefill latency: 0.13 sec
Bandwidth achieved: 1966.62 GB/s
FLOPS achieved: 9.83 TF/s

Prefill latency: 0.130692720413208 sec
Decode latency: 7.692637532949448 sec
Time for inference 9: 7.82 sec total, 130.87 tokens/sec
Decode latency: 7.69 sec
Prefill latency: 0.13 sec
Bandwidth achieved: 1964.39 GB/s
FLOPS achieved: 9.82 TF/s

Prefill latency: 0.13108996860682964 sec
Decode latency: 7.687229972332716 sec
Time for inference 10: 7.82 sec total, 130.96 tokens/sec
Decode latency: 7.69 sec
Prefill latency: 0.13 sec
Bandwidth achieved: 1965.63 GB/s
FLOPS achieved: 9.83 TF/s

==========
Batch Size: 4
Prompt Length: 1024
Generated tokens: 256
Average decode latency: 7.6392 sec
Average prefill latency: 0.1306 sec
Average tokens/sec: 131.78
Memory used: 19.07 GB
