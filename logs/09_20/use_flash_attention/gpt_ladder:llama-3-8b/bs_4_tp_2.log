W0920 01:16:47.421000 23328834713408 torch/distributed/run.py:779] 
W0920 01:16:47.421000 23328834713408 torch/distributed/run.py:779] *****************************************
W0920 01:16:47.421000 23328834713408 torch/distributed/run.py:779] Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
W0920 01:16:47.421000 23328834713408 torch/distributed/run.py:779] *****************************************
flash_kv_decode is set to True
Using device=cuda
Loading model ...
GPTLadder(
  (tok_embeddings): Embedding(128256, 4096)
  (layers): ModuleList(
    (0-31): 32 x LadderTransformerBlock(
      semi_compiled = False
      (attention): Attention(
        (wqkv): Linear(in_features=4096, out_features=3072, bias=False)
        (wo): Linear(in_features=2048, out_features=4096, bias=False)
      )
      (feed_forward): FeedForward(
        (w1): Linear(in_features=4096, out_features=14336, bias=False)
        (w2): Linear(in_features=7168, out_features=4096, bias=False)
      )
      (ffn_norm): RMSNorm()
      (attention_norm): RMSNorm()
    )
  )
  (norm): RMSNorm()
  (output): Linear(in_features=4096, out_features=128256, bias=False)
)
Time to load model: 0.05 seconds
/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/contextlib.py:103: FutureWarning: `torch.backends.cuda.sdp_kernel()` is deprecated. In the future, this context manager will be removed. Please see `torch.nn.attention.sdpa_kernel()` for the new context manager, with updated signature.
  self.gen = func(*args, **kwds)
/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/contextlib.py:103: FutureWarning: `torch.backends.cuda.sdp_kernel()` is deprecated. In the future, this context manager will be removed. Please see `torch.nn.attention.sdpa_kernel()` for the new context manager, with updated signature.
  self.gen = func(*args, **kwds)
Prefill latency: 2.398533947765827 sec
Decode latency: 6.679816961288452 sec
Compilation time: 9.08 seconds
Compilation time: 9.08 seconds
Prefill latency: 0.08097125217318535 sec
Decode latency: 6.4590674340724945 sec
Prefill latency: 0.08313075080513954 sec
Decode latency: 6.422615157440305 sec
Prefill latency: 0.08119365014135838 sec
Decode latency: 6.48238356038928 sec
Prefill latency: 0.08236748725175858 sec
Decode latency: 6.464455036446452 sec
Prefill latency: 0.08126338943839073 sec
Decode latency: 6.304089426994324 sec
Time for inference 1: 6.39 sec total, 160.34 tokens/sec
Decode latency: 6.30 sec
Prefill latency: 0.08 sec
Bandwidth achieved: 1287.64 GB/s
FLOPS achieved: 6.44 TF/s

Prefill latency: 0.0821909923106432 sec
Decode latency: 6.253426890820265 sec
Time for inference 2: 6.34 sec total, 161.60 tokens/sec
Decode latency: 6.25 sec
Prefill latency: 0.08 sec
Bandwidth achieved: 1297.74 GB/s
FLOPS achieved: 6.49 TF/s

Prefill latency: 0.08092237263917923 sec
Decode latency: 6.260124491527677 sec
Time for inference 3: 6.34 sec total, 161.46 tokens/sec
Decode latency: 6.26 sec
Prefill latency: 0.08 sec
Bandwidth achieved: 1296.64 GB/s
FLOPS achieved: 6.48 TF/s

Prefill latency: 0.08215777575969696 sec
Decode latency: 6.26655556820333 sec
Time for inference 4: 6.35 sec total, 161.26 tokens/sec
Decode latency: 6.27 sec
Prefill latency: 0.08 sec
Bandwidth achieved: 1295.04 GB/s
FLOPS achieved: 6.48 TF/s

Prefill latency: 0.08083524368703365 sec
Decode latency: 6.259211003780365 sec
Time for inference 5: 6.34 sec total, 161.49 tokens/sec
Decode latency: 6.26 sec
Prefill latency: 0.08 sec
Bandwidth achieved: 1296.84 GB/s
FLOPS achieved: 6.48 TF/s

Prefill latency: 0.0822612103074789 sec
Decode latency: 6.256075572222471 sec
Time for inference 6: 6.34 sec total, 161.53 tokens/sec
Decode latency: 6.26 sec
Prefill latency: 0.08 sec
Bandwidth achieved: 1297.19 GB/s
FLOPS achieved: 6.49 TF/s

Prefill latency: 0.08114414103329182 sec
Decode latency: 6.25272542797029 sec
Time for inference 7: 6.33 sec total, 161.65 tokens/sec
Decode latency: 6.25 sec
Prefill latency: 0.08 sec
Bandwidth achieved: 1298.11 GB/s
FLOPS achieved: 6.49 TF/s

Prefill latency: 0.08162875846028328 sec
Decode latency: 6.253598641604185 sec
Time for inference 8: 6.34 sec total, 161.61 tokens/sec
Decode latency: 6.25 sec
Prefill latency: 0.08 sec
Bandwidth achieved: 1297.79 GB/s
FLOPS achieved: 6.49 TF/s

Prefill latency: 0.08117466792464256 sec
Decode latency: 6.247068215161562 sec
Time for inference 9: 6.33 sec total, 161.79 tokens/sec
Decode latency: 6.25 sec
Prefill latency: 0.08 sec
Bandwidth achieved: 1299.25 GB/s
FLOPS achieved: 6.50 TF/s

Prefill latency: 0.08216387033462524 sec
Decode latency: 6.2428559847176075 sec
Time for inference 10: 6.33 sec total, 161.87 tokens/sec
Decode latency: 6.24 sec
Prefill latency: 0.08 sec
Bandwidth achieved: 1299.92 GB/s
FLOPS achieved: 6.50 TF/s

==========
Batch Size: 4
Prompt Length: 1024
Generated tokens: 256
Average decode latency: 6.2596 sec
Average prefill latency: 0.0816 sec
Average tokens/sec: 161.46
Memory used: 11.36 GB
