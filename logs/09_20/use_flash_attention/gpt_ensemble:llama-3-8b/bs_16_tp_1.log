flash_kv_decode is set to True
Using device=cuda
Loading model ...
GPTEnsemble(
  (tok_embeddings): Embedding(128256, 4096)
  (layers): ModuleList(
    (0-31): 32 x EnsembleTransformerBlock(
      semi_compiled = False
      (attention): Attention(
        (wqkv): Linear(in_features=4096, out_features=6144, bias=False)
        (wo): Linear(in_features=4096, out_features=4096, bias=False)
      )
      (feed_forward): FeedForward(
        (w1): Linear(in_features=4096, out_features=28672, bias=False)
        (w2): Linear(in_features=14336, out_features=4096, bias=False)
      )
      (ffn_norm): RMSNorm()
      (attention_norm): RMSNorm()
    )
  )
  (norm): RMSNorm()
  (output): Linear(in_features=4096, out_features=128256, bias=False)
)
Time to load model: 1.29 seconds
/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/contextlib.py:103: FutureWarning: `torch.backends.cuda.sdp_kernel()` is deprecated. In the future, this context manager will be removed. Please see `torch.nn.attention.sdpa_kernel()` for the new context manager, with updated signature.
  self.gen = func(*args, **kwds)
Prefill latency: 1.9744109269231558 sec
Decode latency: 5.343232760205865 sec
Compilation time: 7.32 seconds
Prefill latency: 0.5071271285414696 sec
Decode latency: 5.316922282800078 sec
Prefill latency: 0.5071911457926035 sec
Decode latency: 5.2955875266343355 sec
Prefill latency: 0.506340840831399 sec
Decode latency: 5.298970863223076 sec
Prefill latency: 0.5076798815280199 sec
Decode latency: 5.46622690372169 sec
Prefill latency: 0.5083735156804323 sec
Decode latency: 5.300543788820505 sec
Time for inference 1: 5.81 sec total, 705.01 tokens/sec
Decode latency: 5.30 sec
Prefill latency: 0.51 sec
Bandwidth achieved: 10582.13 GB/s
FLOPS achieved: 52.91 TF/s

Prefill latency: 0.5077261012047529 sec
Decode latency: 5.300591118633747 sec
Time for inference 2: 5.81 sec total, 705.09 tokens/sec
Decode latency: 5.30 sec
Prefill latency: 0.51 sec
Bandwidth achieved: 10583.26 GB/s
FLOPS achieved: 52.92 TF/s

Prefill latency: 0.506319135427475 sec
Decode latency: 5.299952624365687 sec
Time for inference 3: 5.81 sec total, 705.33 tokens/sec
Decode latency: 5.30 sec
Prefill latency: 0.51 sec
Bandwidth achieved: 10586.88 GB/s
FLOPS achieved: 52.93 TF/s

Prefill latency: 0.5086297523230314 sec
Decode latency: 5.252453124150634 sec
Time for inference 4: 5.76 sec total, 710.86 tokens/sec
Decode latency: 5.25 sec
Prefill latency: 0.51 sec
Bandwidth achieved: 10669.97 GB/s
FLOPS achieved: 53.35 TF/s

Prefill latency: 0.5071021895855665 sec
Decode latency: 5.258528267964721 sec
Time for inference 5: 5.77 sec total, 710.29 tokens/sec
Decode latency: 5.26 sec
Prefill latency: 0.51 sec
Bandwidth achieved: 10661.28 GB/s
FLOPS achieved: 53.31 TF/s

Prefill latency: 0.5090284962207079 sec
Decode latency: 5.33616996742785 sec
Time for inference 6: 5.85 sec total, 700.62 tokens/sec
Decode latency: 5.34 sec
Prefill latency: 0.51 sec
Bandwidth achieved: 10516.26 GB/s
FLOPS achieved: 52.58 TF/s

Prefill latency: 0.5082539189606905 sec
Decode latency: 5.287008734419942 sec
Time for inference 7: 5.80 sec total, 706.67 tokens/sec
Decode latency: 5.29 sec
Prefill latency: 0.51 sec
Bandwidth achieved: 10607.02 GB/s
FLOPS achieved: 53.04 TF/s

Prefill latency: 0.5077780205756426 sec
Decode latency: 5.249495375901461 sec
Time for inference 8: 5.76 sec total, 711.34 tokens/sec
Decode latency: 5.25 sec
Prefill latency: 0.51 sec
Bandwidth achieved: 10677.11 GB/s
FLOPS achieved: 53.39 TF/s

Prefill latency: 0.5065509118139744 sec
Decode latency: 5.251164780929685 sec
Time for inference 9: 5.76 sec total, 711.28 tokens/sec
Decode latency: 5.25 sec
Prefill latency: 0.51 sec
Bandwidth achieved: 10676.23 GB/s
FLOPS achieved: 53.38 TF/s

Prefill latency: 0.5062056854367256 sec
Decode latency: 5.319097612053156 sec
Time for inference 10: 5.83 sec total, 703.03 tokens/sec
Decode latency: 5.32 sec
Prefill latency: 0.51 sec
Bandwidth achieved: 10552.30 GB/s
FLOPS achieved: 52.76 TF/s

==========
Batch Size: 16
Prompt Length: 1024
Generated tokens: 256
Average decode latency: 5.2855 sec
Average prefill latency: 0.5076 sec
Average tokens/sec: 706.95
Memory used: 26.43 GB
