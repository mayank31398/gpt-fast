flash_kv_decode is set to True
Using device=cuda
Loading model ...
GPTParallel(
  (tok_embeddings): Embedding(128256, 4096)
  (layers): ModuleList(
    (0-31): 32 x ParallelTransformerBlock(
      semi_compiled = False
      (attention): Attention(
        (wqkv): Linear(in_features=4096, out_features=6144, bias=False)
        (wo): Linear(in_features=4096, out_features=4096, bias=False)
      )
      (feed_forward): FeedForward(
        (w1): Linear(in_features=4096, out_features=28672, bias=False)
        (w2): Linear(in_features=14336, out_features=4096, bias=False)
      )
      (ffn_norm): RMSNorm()
      (attention_norm): RMSNorm()
    )
  )
  (norm): RMSNorm()
  (output): Linear(in_features=4096, out_features=128256, bias=False)
)
Time to load model: 1.00 seconds
/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/contextlib.py:103: FutureWarning: `torch.backends.cuda.sdp_kernel()` is deprecated. In the future, this context manager will be removed. Please see `torch.nn.attention.sdpa_kernel()` for the new context manager, with updated signature.
  self.gen = func(*args, **kwds)
Prefill latency: 1.70186597853899 sec
Decode latency: 6.743030900135636 sec
Compilation time: 8.45 seconds
Prefill latency: 0.04026174359023571 sec
Decode latency: 6.370091266930103 sec
Prefill latency: 0.040043871849775314 sec
Decode latency: 6.483425037935376 sec
Prefill latency: 0.03995019197463989 sec
Decode latency: 6.4614645298570395 sec
Prefill latency: 0.0398574061691761 sec
Decode latency: 6.3105545695871115 sec
Prefill latency: 0.03989991545677185 sec
Decode latency: 6.345295626670122 sec
Time for inference 1: 6.39 sec total, 40.09 tokens/sec
Decode latency: 6.35 sec
Prefill latency: 0.04 sec
Bandwidth achieved: 601.70 GB/s
FLOPS achieved: 3.01 TF/s

Prefill latency: 0.03979775495827198 sec
Decode latency: 6.47760926745832 sec
Time for inference 2: 6.52 sec total, 39.27 tokens/sec
Decode latency: 6.48 sec
Prefill latency: 0.04 sec
Bandwidth achieved: 589.48 GB/s
FLOPS achieved: 2.95 TF/s

Prefill latency: 0.0398440845310688 sec
Decode latency: 6.369240308180451 sec
Time for inference 3: 6.41 sec total, 39.94 tokens/sec
Decode latency: 6.37 sec
Prefill latency: 0.04 sec
Bandwidth achieved: 599.45 GB/s
FLOPS achieved: 3.00 TF/s

Prefill latency: 0.03989679180085659 sec
Decode latency: 6.495791759341955 sec
Time for inference 4: 6.54 sec total, 39.16 tokens/sec
Decode latency: 6.50 sec
Prefill latency: 0.04 sec
Bandwidth achieved: 587.84 GB/s
FLOPS achieved: 2.94 TF/s

Prefill latency: 0.04003601893782616 sec
Decode latency: 6.388120112940669 sec
Time for inference 5: 6.43 sec total, 39.82 tokens/sec
Decode latency: 6.39 sec
Prefill latency: 0.04 sec
Bandwidth achieved: 597.68 GB/s
FLOPS achieved: 2.99 TF/s

Prefill latency: 0.040142036974430084 sec
Decode latency: 6.350126279518008 sec
Time for inference 6: 6.39 sec total, 40.05 tokens/sec
Decode latency: 6.35 sec
Prefill latency: 0.04 sec
Bandwidth achieved: 601.21 GB/s
FLOPS achieved: 3.01 TF/s

Prefill latency: 0.04010739549994469 sec
Decode latency: 6.445233421400189 sec
Time for inference 7: 6.49 sec total, 39.47 tokens/sec
Decode latency: 6.45 sec
Prefill latency: 0.04 sec
Bandwidth achieved: 592.40 GB/s
FLOPS achieved: 2.96 TF/s

Prefill latency: 0.03993846848607063 sec
Decode latency: 6.3503120597451925 sec
Time for inference 8: 6.39 sec total, 40.05 tokens/sec
Decode latency: 6.35 sec
Prefill latency: 0.04 sec
Bandwidth achieved: 601.22 GB/s
FLOPS achieved: 3.01 TF/s

Prefill latency: 0.040517207235097885 sec
Decode latency: 6.3758548479527235 sec
Time for inference 9: 6.42 sec total, 39.89 tokens/sec
Decode latency: 6.38 sec
Prefill latency: 0.04 sec
Bandwidth achieved: 598.77 GB/s
FLOPS achieved: 2.99 TF/s

Prefill latency: 0.03986245207488537 sec
Decode latency: 6.315382286906242 sec
Time for inference 10: 6.36 sec total, 40.28 tokens/sec
Decode latency: 6.32 sec
Prefill latency: 0.04 sec
Bandwidth achieved: 604.53 GB/s
FLOPS achieved: 3.02 TF/s

==========
Batch Size: 1
Prompt Length: 1024
Generated tokens: 256
Average decode latency: 6.3913 sec
Average prefill latency: 0.0400 sec
Average tokens/sec: 39.80
Memory used: 16.86 GB
