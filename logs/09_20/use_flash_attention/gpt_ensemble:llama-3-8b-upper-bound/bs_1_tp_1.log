flash_kv_decode is set to True
Using device=cuda
Loading model ...
GPTEnsemble(
  (tok_embeddings): Embedding(128256, 4096)
  (layers): ModuleList(
    (0-31): 32 x EnsembleTransformerBlock(
      semi_compiled = False
      (attention): Attention(
        (wqkv): Linear(in_features=4096, out_features=6144, bias=False)
        (wo): Linear(in_features=4096, out_features=4096, bias=False)
      )
      (feed_forward): FeedForward(
        (w1): Linear(in_features=4096, out_features=28672, bias=False)
        (w2): Linear(in_features=14336, out_features=4096, bias=False)
      )
      (ffn_norm): RMSNorm()
      (attention_norm): RMSNorm()
    )
  )
  (norm): RMSNorm()
  (output): Linear(in_features=4096, out_features=128256, bias=False)
)
Time to load model: 1.05 seconds
/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/contextlib.py:103: FutureWarning: `torch.backends.cuda.sdp_kernel()` is deprecated. In the future, this context manager will be removed. Please see `torch.nn.attention.sdpa_kernel()` for the new context manager, with updated signature.
  self.gen = func(*args, **kwds)
Prefill latency: 0.8704307433217764 sec
Decode latency: 5.250510213896632 sec
Compilation time: 6.12 seconds
Prefill latency: 0.0400286540389061 sec
Decode latency: 5.076526930555701 sec
Prefill latency: 0.0398669745773077 sec
Decode latency: 5.074390223249793 sec
Prefill latency: 0.039687471464276314 sec
Decode latency: 5.054470520466566 sec
Prefill latency: 0.03962414711713791 sec
Decode latency: 5.184640826657414 sec
Prefill latency: 0.03972567059099674 sec
Decode latency: 5.039362743496895 sec
Time for inference 1: 5.08 sec total, 50.39 tokens/sec
Decode latency: 5.04 sec
Prefill latency: 0.04 sec
Bandwidth achieved: 756.40 GB/s
FLOPS achieved: 3.78 TF/s

Prefill latency: 0.03965480625629425 sec
Decode latency: 5.049503833055496 sec
Time for inference 2: 5.09 sec total, 50.29 tokens/sec
Decode latency: 5.05 sec
Prefill latency: 0.04 sec
Bandwidth achieved: 754.88 GB/s
FLOPS achieved: 3.77 TF/s

Prefill latency: 0.03965986333787441 sec
Decode latency: 5.041587771847844 sec
Time for inference 3: 5.08 sec total, 50.37 tokens/sec
Decode latency: 5.04 sec
Prefill latency: 0.04 sec
Bandwidth achieved: 756.08 GB/s
FLOPS achieved: 3.78 TF/s

Prefill latency: 0.03969134762883186 sec
Decode latency: 5.044397220015526 sec
Time for inference 4: 5.09 sec total, 50.34 tokens/sec
Decode latency: 5.04 sec
Prefill latency: 0.04 sec
Bandwidth achieved: 755.66 GB/s
FLOPS achieved: 3.78 TF/s

Prefill latency: 0.039584847167134285 sec
Decode latency: 5.047745687887073 sec
Time for inference 5: 5.09 sec total, 50.31 tokens/sec
Decode latency: 5.05 sec
Prefill latency: 0.04 sec
Bandwidth achieved: 755.19 GB/s
FLOPS achieved: 3.78 TF/s

Prefill latency: 0.0396247822791338 sec
Decode latency: 5.062884459272027 sec
Time for inference 6: 5.10 sec total, 50.16 tokens/sec
Decode latency: 5.06 sec
Prefill latency: 0.04 sec
Bandwidth achieved: 752.93 GB/s
FLOPS achieved: 3.76 TF/s

Prefill latency: 0.039716001600027084 sec
Decode latency: 5.115615636110306 sec
Time for inference 7: 5.16 sec total, 49.65 tokens/sec
Decode latency: 5.12 sec
Prefill latency: 0.04 sec
Bandwidth achieved: 745.21 GB/s
FLOPS achieved: 3.73 TF/s

Prefill latency: 0.03971773572266102 sec
Decode latency: 5.067381331697106 sec
Time for inference 8: 5.11 sec total, 50.12 tokens/sec
Decode latency: 5.07 sec
Prefill latency: 0.04 sec
Bandwidth achieved: 752.24 GB/s
FLOPS achieved: 3.76 TF/s

Prefill latency: 0.03974461555480957 sec
Decode latency: 5.075883882120252 sec
Time for inference 9: 5.12 sec total, 50.03 tokens/sec
Decode latency: 5.08 sec
Prefill latency: 0.04 sec
Bandwidth achieved: 751.00 GB/s
FLOPS achieved: 3.75 TF/s

Prefill latency: 0.039680877700448036 sec
Decode latency: 5.093757543712854 sec
Time for inference 10: 5.13 sec total, 49.86 tokens/sec
Decode latency: 5.09 sec
Prefill latency: 0.04 sec
Bandwidth achieved: 748.39 GB/s
FLOPS achieved: 3.74 TF/s

==========
Batch Size: 1
Prompt Length: 1024
Generated tokens: 256
Average decode latency: 5.0638 sec
Average prefill latency: 0.0397 sec
Average tokens/sec: 50.15
Memory used: 16.83 GB
