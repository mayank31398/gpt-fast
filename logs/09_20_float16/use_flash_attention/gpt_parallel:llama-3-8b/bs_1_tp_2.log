W0920 09:44:37.137000 22741040211776 torch/distributed/run.py:779] 
W0920 09:44:37.137000 22741040211776 torch/distributed/run.py:779] *****************************************
W0920 09:44:37.137000 22741040211776 torch/distributed/run.py:779] Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
W0920 09:44:37.137000 22741040211776 torch/distributed/run.py:779] *****************************************
flash_kv_decode is set to True
Using device=cuda
Loading model ...
GPTParallel(
  (tok_embeddings): Embedding(128256, 4096)
  (layers): ModuleList(
    (0-31): 32 x ParallelTransformerBlock(
      semi_compiled = False
      (attention): Attention(
        (wqkv): Linear(in_features=4096, out_features=3072, bias=False)
        (wo): Linear(in_features=2048, out_features=4096, bias=False)
      )
      (feed_forward): FeedForward(
        (w1): Linear(in_features=4096, out_features=14336, bias=False)
        (w2): Linear(in_features=7168, out_features=4096, bias=False)
      )
      (ffn_norm): RMSNorm()
      (attention_norm): RMSNorm()
    )
  )
  (norm): RMSNorm()
  (output): Linear(in_features=4096, out_features=128256, bias=False)
)
Time to load model: 1.11 seconds
/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/contextlib.py:103: FutureWarning: `torch.backends.cuda.sdp_kernel()` is deprecated. In the future, this context manager will be removed. Please see `torch.nn.attention.sdpa_kernel()` for the new context manager, with updated signature.
  self.gen = func(*args, **kwds)
/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/contextlib.py:103: FutureWarning: `torch.backends.cuda.sdp_kernel()` is deprecated. In the future, this context manager will be removed. Please see `torch.nn.attention.sdpa_kernel()` for the new context manager, with updated signature.
  self.gen = func(*args, **kwds)
Prefill latency: 3.116585062816739 sec
Decode latency: 7.1094812117516994 sec
Compilation time: 10.23 seconds
Compilation time: 10.23 seconds
Prefill latency: 0.03700103983283043 sec
Decode latency: 7.104554587975144 sec
Prefill latency: 0.03760957717895508 sec
Decode latency: 7.296688845381141 sec
Prefill latency: 0.05047821253538132 sec
Decode latency: 7.082482734695077 sec
Prefill latency: 0.03694782964885235 sec
Decode latency: 7.0931993424892426 sec
Prefill latency: 0.03713671304285526 sec
Decode latency: 6.979612773284316 sec
Time for inference 1: 7.02 sec total, 36.48 tokens/sec
Decode latency: 6.98 sec
Prefill latency: 0.04 sec
Bandwidth achieved: 292.94 GB/s
FLOPS achieved: 1.46 TF/s

Prefill latency: 0.0368955135345459 sec
Decode latency: 6.9174663089215755 sec
Time for inference 2: 6.96 sec total, 36.81 tokens/sec
Decode latency: 6.92 sec
Prefill latency: 0.04 sec
Bandwidth achieved: 295.57 GB/s
FLOPS achieved: 1.48 TF/s

Prefill latency: 0.03693225793540478 sec
Decode latency: 7.196769217029214 sec
Time for inference 3: 7.23 sec total, 35.38 tokens/sec
Decode latency: 7.20 sec
Prefill latency: 0.04 sec
Bandwidth achieved: 284.16 GB/s
FLOPS achieved: 1.42 TF/s

Prefill latency: 0.03698823228478432 sec
Decode latency: 7.0688219759613276 sec
Time for inference 4: 7.11 sec total, 36.02 tokens/sec
Decode latency: 7.07 sec
Prefill latency: 0.04 sec
Bandwidth achieved: 289.27 GB/s
FLOPS achieved: 1.45 TF/s

Prefill latency: 0.03767586871981621 sec
Decode latency: 6.966276282444596 sec
Time for inference 5: 7.01 sec total, 36.55 tokens/sec
Decode latency: 6.97 sec
Prefill latency: 0.04 sec
Bandwidth achieved: 293.48 GB/s
FLOPS achieved: 1.47 TF/s

Prefill latency: 0.03709128312766552 sec
Decode latency: 7.005312329158187 sec
Time for inference 6: 7.04 sec total, 36.35 tokens/sec
Decode latency: 7.01 sec
Prefill latency: 0.04 sec
Bandwidth achieved: 291.88 GB/s
FLOPS achieved: 1.46 TF/s

Prefill latency: 0.037457264959812164 sec
Decode latency: 6.964504661038518 sec
Time for inference 7: 7.00 sec total, 36.56 tokens/sec
Decode latency: 6.96 sec
Prefill latency: 0.04 sec
Bandwidth achieved: 293.56 GB/s
FLOPS achieved: 1.47 TF/s

Prefill latency: 0.03810275346040726 sec
Decode latency: 7.101845171302557 sec
Time for inference 8: 7.14 sec total, 35.85 tokens/sec
Decode latency: 7.10 sec
Prefill latency: 0.04 sec
Bandwidth achieved: 287.88 GB/s
FLOPS achieved: 1.44 TF/s

Prefill latency: 0.036766158416867256 sec
Decode latency: 6.939690275117755 sec
Time for inference 9: 6.98 sec total, 36.69 tokens/sec
Decode latency: 6.94 sec
Prefill latency: 0.04 sec
Bandwidth achieved: 294.63 GB/s
FLOPS achieved: 1.47 TF/s

Prefill latency: 0.03698313236236572 sec
Decode latency: 7.006258107721806 sec
Time for inference 10: 7.04 sec total, 36.34 tokens/sec
Decode latency: 7.01 sec
Prefill latency: 0.04 sec
Bandwidth achieved: 291.84 GB/s
FLOPS achieved: 1.46 TF/s

==========
Batch Size: 1
Prompt Length: 1024
Generated tokens: 256
Average decode latency: 7.0147 sec
Average prefill latency: 0.0372 sec
Average tokens/sec: 36.30
Memory used: 9.65 GB
