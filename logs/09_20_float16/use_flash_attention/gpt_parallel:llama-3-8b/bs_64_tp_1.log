flash_kv_decode is set to True
Using device=cuda
Loading model ...
GPTParallel(
  (tok_embeddings): Embedding(128256, 4096)
  (layers): ModuleList(
    (0-31): 32 x ParallelTransformerBlock(
      semi_compiled = False
      (attention): Attention(
        (wqkv): Linear(in_features=4096, out_features=6144, bias=False)
        (wo): Linear(in_features=4096, out_features=4096, bias=False)
      )
      (feed_forward): FeedForward(
        (w1): Linear(in_features=4096, out_features=28672, bias=False)
        (w2): Linear(in_features=14336, out_features=4096, bias=False)
      )
      (ffn_norm): RMSNorm()
      (attention_norm): RMSNorm()
    )
  )
  (norm): RMSNorm()
  (output): Linear(in_features=4096, out_features=128256, bias=False)
)
Time to load model: 1.11 seconds
/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/contextlib.py:103: FutureWarning: `torch.backends.cuda.sdp_kernel()` is deprecated. In the future, this context manager will be removed. Please see `torch.nn.attention.sdpa_kernel()` for the new context manager, with updated signature.
  self.gen = func(*args, **kwds)
Prefill latency: 4.1320198606699705 sec
Decode latency: 6.465291295200586 sec
Compilation time: 10.60 seconds
Prefill latency: 2.3083601500838995 sec
Decode latency: 6.47546518035233 sec
Prefill latency: 2.3074592407792807 sec
Decode latency: 6.450541669502854 sec
Prefill latency: 2.305543703958392 sec
Decode latency: 6.300019986927509 sec
Prefill latency: 2.304695315659046 sec
Decode latency: 6.285566510632634 sec
Prefill latency: 2.303572630509734 sec
Decode latency: 6.494311921298504 sec
Time for inference 1: 8.80 sec total, 1862.06 tokens/sec
Decode latency: 6.49 sec
Prefill latency: 2.30 sec
Bandwidth achieved: 27949.28 GB/s
FLOPS achieved: 139.75 TF/s

Prefill latency: 2.3062863759696484 sec
Decode latency: 6.4597343523055315 sec
Time for inference 2: 8.77 sec total, 1868.82 tokens/sec
Decode latency: 6.46 sec
Prefill latency: 2.31 sec
Bandwidth achieved: 28050.63 GB/s
FLOPS achieved: 140.25 TF/s

Prefill latency: 2.3084874600172043 sec
Decode latency: 6.404118936508894 sec
Time for inference 3: 8.71 sec total, 1880.27 tokens/sec
Decode latency: 6.40 sec
Prefill latency: 2.31 sec
Bandwidth achieved: 28222.52 GB/s
FLOPS achieved: 141.11 TF/s

Prefill latency: 2.2980285566300154 sec
Decode latency: 6.310111302882433 sec
Time for inference 4: 8.61 sec total, 1903.09 tokens/sec
Decode latency: 6.31 sec
Prefill latency: 2.30 sec
Bandwidth achieved: 28565.13 GB/s
FLOPS achieved: 142.83 TF/s

Prefill latency: 2.2934347558766603 sec
Decode latency: 6.3213241677731276 sec
Time for inference 5: 8.62 sec total, 1901.62 tokens/sec
Decode latency: 6.32 sec
Prefill latency: 2.29 sec
Bandwidth achieved: 28543.04 GB/s
FLOPS achieved: 142.72 TF/s

Prefill latency: 2.2964792288839817 sec
Decode latency: 6.374946331605315 sec
Time for inference 6: 8.67 sec total, 1889.21 tokens/sec
Decode latency: 6.37 sec
Prefill latency: 2.30 sec
Bandwidth achieved: 28356.70 GB/s
FLOPS achieved: 141.78 TF/s

Prefill latency: 2.300983674824238 sec
Decode latency: 6.344811372458935 sec
Time for inference 7: 8.65 sec total, 1894.81 tokens/sec
Decode latency: 6.34 sec
Prefill latency: 2.30 sec
Bandwidth achieved: 28440.85 GB/s
FLOPS achieved: 142.20 TF/s

Prefill latency: 2.2944544721394777 sec
Decode latency: 6.402842972427607 sec
Time for inference 8: 8.70 sec total, 1883.60 tokens/sec
Decode latency: 6.40 sec
Prefill latency: 2.29 sec
Bandwidth achieved: 28272.53 GB/s
FLOPS achieved: 141.36 TF/s

Prefill latency: 2.294396374374628 sec
Decode latency: 6.335726777091622 sec
Time for inference 9: 8.63 sec total, 1898.23 tokens/sec
Decode latency: 6.34 sec
Prefill latency: 2.29 sec
Bandwidth achieved: 28492.21 GB/s
FLOPS achieved: 142.46 TF/s

Prefill latency: 2.2997594848275185 sec
Decode latency: 6.33759331703186 sec
Time for inference 10: 8.64 sec total, 1896.64 tokens/sec
Decode latency: 6.34 sec
Prefill latency: 2.30 sec
Bandwidth achieved: 28468.23 GB/s
FLOPS achieved: 142.34 TF/s

==========
Batch Size: 64
Prompt Length: 1024
Generated tokens: 256
Average decode latency: 6.3786 sec
Average prefill latency: 2.2996 sec
Average tokens/sec: 1887.83
Memory used: 57.36 GB
