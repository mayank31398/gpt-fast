W0920 08:52:11.543000 23076479563584 torch/distributed/run.py:779] 
W0920 08:52:11.543000 23076479563584 torch/distributed/run.py:779] *****************************************
W0920 08:52:11.543000 23076479563584 torch/distributed/run.py:779] Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
W0920 08:52:11.543000 23076479563584 torch/distributed/run.py:779] *****************************************
flash_kv_decode is set to True
Using device=cuda
Loading model ...
GPTDense(
  (tok_embeddings): Embedding(128256, 4096)
  (layers): ModuleList(
    (0-31): 32 x DenseTransformerBlock(
      semi_compiled = False
      (attention): Attention(
        (wqkv): Linear(in_features=4096, out_features=3072, bias=False)
        (wo): Linear(in_features=2048, out_features=4096, bias=False)
      )
      (feed_forward): FeedForward(
        (w1): Linear(in_features=4096, out_features=14336, bias=False)
        (w2): Linear(in_features=7168, out_features=4096, bias=False)
      )
      (ffn_norm): RMSNorm()
      (attention_norm): RMSNorm()
    )
  )
  (norm): RMSNorm()
  (output): Linear(in_features=4096, out_features=128256, bias=False)
)
Time to load model: 0.82 seconds
/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/contextlib.py:103: FutureWarning: `torch.backends.cuda.sdp_kernel()` is deprecated. In the future, this context manager will be removed. Please see `torch.nn.attention.sdpa_kernel()` for the new context manager, with updated signature.
  self.gen = func(*args, **kwds)
/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/contextlib.py:103: FutureWarning: `torch.backends.cuda.sdp_kernel()` is deprecated. In the future, this context manager will be removed. Please see `torch.nn.attention.sdpa_kernel()` for the new context manager, with updated signature.
  self.gen = func(*args, **kwds)
Prefill latency: 4.058759881183505 sec
Decode latency: 7.851226601749659 sec
Compilation time: 11.78 seconds
Compilation time: 11.91 seconds
Prefill latency: 0.1592615768313408 sec
Decode latency: 8.186433844268322 sec
Prefill latency: 0.16026684269309044 sec
Decode latency: 7.7316406685858965 sec
Prefill latency: 0.16007223539054394 sec
Decode latency: 7.8431419767439365 sec
Prefill latency: 0.15973707847297192 sec
Decode latency: 7.788595808669925 sec
Prefill latency: 0.15976572409272194 sec
Decode latency: 8.01949487440288 sec
Time for inference 1: 8.18 sec total, 250.36 tokens/sec
Decode latency: 8.02 sec
Prefill latency: 0.16 sec
Bandwidth achieved: 2010.49 GB/s
FLOPS achieved: 10.05 TF/s

Prefill latency: 0.1596377845853567 sec
Decode latency: 7.823611261323094 sec
Time for inference 2: 7.98 sec total, 256.50 tokens/sec
Decode latency: 7.82 sec
Prefill latency: 0.16 sec
Bandwidth achieved: 2059.86 GB/s
FLOPS achieved: 10.30 TF/s

Prefill latency: 0.15953456051647663 sec
Decode latency: 7.742910724133253 sec
Time for inference 3: 7.90 sec total, 259.12 tokens/sec
Decode latency: 7.74 sec
Prefill latency: 0.16 sec
Bandwidth achieved: 2080.88 GB/s
FLOPS achieved: 10.40 TF/s

Prefill latency: 0.15957012586295605 sec
Decode latency: 7.538902943953872 sec
Time for inference 4: 7.70 sec total, 265.99 tokens/sec
Decode latency: 7.54 sec
Prefill latency: 0.16 sec
Bandwidth achieved: 2136.05 GB/s
FLOPS achieved: 10.68 TF/s

Prefill latency: 0.15970888175070286 sec
Decode latency: 7.721348011866212 sec
Time for inference 5: 7.88 sec total, 259.83 tokens/sec
Decode latency: 7.72 sec
Prefill latency: 0.16 sec
Bandwidth achieved: 2086.56 GB/s
FLOPS achieved: 10.43 TF/s

Prefill latency: 0.15946798957884312 sec
Decode latency: 7.518017146736383 sec
Time for inference 6: 7.68 sec total, 266.72 tokens/sec
Decode latency: 7.52 sec
Prefill latency: 0.16 sec
Bandwidth achieved: 2141.89 GB/s
FLOPS achieved: 10.71 TF/s

Prefill latency: 0.1598203256726265 sec
Decode latency: 7.493353644385934 sec
Time for inference 7: 7.65 sec total, 267.57 tokens/sec
Decode latency: 7.49 sec
Prefill latency: 0.16 sec
Bandwidth achieved: 2148.71 GB/s
FLOPS achieved: 10.74 TF/s

Prefill latency: 0.15953455120325089 sec
Decode latency: 7.562364209443331 sec
Time for inference 8: 7.72 sec total, 265.19 tokens/sec
Decode latency: 7.56 sec
Prefill latency: 0.16 sec
Bandwidth achieved: 2129.58 GB/s
FLOPS achieved: 10.65 TF/s

Prefill latency: 0.159530745819211 sec
Decode latency: 7.543591136112809 sec
Time for inference 9: 7.70 sec total, 265.83 tokens/sec
Decode latency: 7.54 sec
Prefill latency: 0.16 sec
Bandwidth achieved: 2134.78 GB/s
FLOPS achieved: 10.67 TF/s

Prefill latency: 0.15988285280764103 sec
Decode latency: 7.69906067289412 sec
Time for inference 10: 7.86 sec total, 260.56 tokens/sec
Decode latency: 7.70 sec
Prefill latency: 0.16 sec
Bandwidth achieved: 2092.45 GB/s
FLOPS achieved: 10.46 TF/s

==========
Batch Size: 8
Prompt Length: 1024
Generated tokens: 256
Average decode latency: 7.6663 sec
Average prefill latency: 0.1596 sec
Average tokens/sec: 261.77
Memory used: 12.84 GB
