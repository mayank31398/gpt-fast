flash_kv_decode is set to True
Using device=cuda
Loading model ...
GPTEnsemble(
  (tok_embeddings): Embedding(128256, 4096)
  (layers): ModuleList(
    (0-31): 32 x EnsembleTransformerBlock(
      semi_compiled = False
      (attention): Attention(
        (wqkv): Linear(in_features=4096, out_features=6144, bias=False)
        (wo): Linear(in_features=4096, out_features=4096, bias=False)
      )
      (feed_forward): FeedForward(
        (w1): Linear(in_features=4096, out_features=28672, bias=False)
        (w2): Linear(in_features=14336, out_features=4096, bias=False)
      )
      (ffn_norm): RMSNorm()
      (attention_norm): RMSNorm()
    )
  )
  (norm): RMSNorm()
  (output): Linear(in_features=4096, out_features=128256, bias=False)
)
Time to load model: 1.16 seconds
/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/contextlib.py:103: FutureWarning: `torch.backends.cuda.sdp_kernel()` is deprecated. In the future, this context manager will be removed. Please see `torch.nn.attention.sdpa_kernel()` for the new context manager, with updated signature.
  self.gen = func(*args, **kwds)
Prefill latency: 1.9618879053741693 sec
Decode latency: 5.753177283331752 sec
Compilation time: 7.72 seconds
Prefill latency: 0.1311734803020954 sec
Decode latency: 5.539282206445932 sec
Prefill latency: 0.13155070506036282 sec
Decode latency: 5.603286504745483 sec
Prefill latency: 0.13169575668871403 sec
Decode latency: 5.487342368811369 sec
Prefill latency: 0.13220005854964256 sec
Decode latency: 5.519001699984074 sec
Prefill latency: 0.13138676062226295 sec
Decode latency: 5.490043459460139 sec
Time for inference 1: 5.62 sec total, 182.13 tokens/sec
Decode latency: 5.49 sec
Prefill latency: 0.13 sec
Bandwidth achieved: 2733.68 GB/s
FLOPS achieved: 13.67 TF/s

Prefill latency: 0.13232932426035404 sec
Decode latency: 5.491877626627684 sec
Time for inference 2: 5.63 sec total, 182.04 tokens/sec
Decode latency: 5.49 sec
Prefill latency: 0.13 sec
Bandwidth achieved: 2732.35 GB/s
FLOPS achieved: 13.66 TF/s

Prefill latency: 0.1327843852341175 sec
Decode latency: 5.490901906043291 sec
Time for inference 3: 5.62 sec total, 182.06 tokens/sec
Decode latency: 5.49 sec
Prefill latency: 0.13 sec
Bandwidth achieved: 2732.63 GB/s
FLOPS achieved: 13.66 TF/s

Prefill latency: 0.13312689401209354 sec
Decode latency: 5.49817612208426 sec
Time for inference 4: 5.63 sec total, 181.81 tokens/sec
Decode latency: 5.50 sec
Prefill latency: 0.13 sec
Bandwidth achieved: 2728.92 GB/s
FLOPS achieved: 13.64 TF/s

Prefill latency: 0.13314772956073284 sec
Decode latency: 5.5259033385664225 sec
Time for inference 5: 5.66 sec total, 180.92 tokens/sec
Decode latency: 5.53 sec
Prefill latency: 0.13 sec
Bandwidth achieved: 2715.52 GB/s
FLOPS achieved: 13.58 TF/s

Prefill latency: 0.1326979473233223 sec
Decode latency: 5.5182116366922855 sec
Time for inference 6: 5.65 sec total, 181.18 tokens/sec
Decode latency: 5.52 sec
Prefill latency: 0.13 sec
Bandwidth achieved: 2719.46 GB/s
FLOPS achieved: 13.60 TF/s

Prefill latency: 0.13282642513513565 sec
Decode latency: 5.530544240027666 sec
Time for inference 7: 5.66 sec total, 180.78 tokens/sec
Decode latency: 5.53 sec
Prefill latency: 0.13 sec
Bandwidth achieved: 2713.47 GB/s
FLOPS achieved: 13.57 TF/s

Prefill latency: 0.13300531171262264 sec
Decode latency: 5.524698304012418 sec
Time for inference 8: 5.66 sec total, 180.96 tokens/sec
Decode latency: 5.52 sec
Prefill latency: 0.13 sec
Bandwidth achieved: 2716.17 GB/s
FLOPS achieved: 13.58 TF/s

Prefill latency: 0.13281319104135036 sec
Decode latency: 5.510225487872958 sec
Time for inference 9: 5.64 sec total, 181.43 tokens/sec
Decode latency: 5.51 sec
Prefill latency: 0.13 sec
Bandwidth achieved: 2723.26 GB/s
FLOPS achieved: 13.62 TF/s

Prefill latency: 0.1333299931138754 sec
Decode latency: 5.5356220826506615 sec
Time for inference 10: 5.67 sec total, 180.60 tokens/sec
Decode latency: 5.54 sec
Prefill latency: 0.13 sec
Bandwidth achieved: 2710.82 GB/s
FLOPS achieved: 13.55 TF/s

==========
Batch Size: 4
Prompt Length: 1024
Generated tokens: 256
Average decode latency: 5.5116 sec
Average prefill latency: 0.1327 sec
Average tokens/sec: 181.39
Memory used: 18.96 GB
