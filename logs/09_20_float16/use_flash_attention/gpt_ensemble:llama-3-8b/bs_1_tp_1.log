flash_kv_decode is set to True
Using device=cuda
Loading model ...
GPTEnsemble(
  (tok_embeddings): Embedding(128256, 4096)
  (layers): ModuleList(
    (0-31): 32 x EnsembleTransformerBlock(
      semi_compiled = False
      (attention): Attention(
        (wqkv): Linear(in_features=4096, out_features=6144, bias=False)
        (wo): Linear(in_features=4096, out_features=4096, bias=False)
      )
      (feed_forward): FeedForward(
        (w1): Linear(in_features=4096, out_features=28672, bias=False)
        (w2): Linear(in_features=14336, out_features=4096, bias=False)
      )
      (ffn_norm): RMSNorm()
      (attention_norm): RMSNorm()
    )
  )
  (norm): RMSNorm()
  (output): Linear(in_features=4096, out_features=128256, bias=False)
)
Time to load model: 1.05 seconds
/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/contextlib.py:103: FutureWarning: `torch.backends.cuda.sdp_kernel()` is deprecated. In the future, this context manager will be removed. Please see `torch.nn.attention.sdpa_kernel()` for the new context manager, with updated signature.
  self.gen = func(*args, **kwds)
Prefill latency: 1.957146067172289 sec
Decode latency: 5.945646110922098 sec
Compilation time: 7.90 seconds
Prefill latency: 0.04077243246138096 sec
Decode latency: 5.8639385886490345 sec
Prefill latency: 0.040595199912786484 sec
Decode latency: 5.863896511495113 sec
Prefill latency: 0.04068828746676445 sec
Decode latency: 5.926391372457147 sec
Prefill latency: 0.040623823180794716 sec
Decode latency: 5.827883882448077 sec
Prefill latency: 0.04084869287908077 sec
Decode latency: 5.826018827036023 sec
Time for inference 1: 5.87 sec total, 43.63 tokens/sec
Decode latency: 5.83 sec
Prefill latency: 0.04 sec
Bandwidth achieved: 654.84 GB/s
FLOPS achieved: 3.27 TF/s

Prefill latency: 0.04076771438121796 sec
Decode latency: 5.833501849323511 sec
Time for inference 2: 5.88 sec total, 43.57 tokens/sec
Decode latency: 5.83 sec
Prefill latency: 0.04 sec
Bandwidth achieved: 654.02 GB/s
FLOPS achieved: 3.27 TF/s

Prefill latency: 0.040717875584959984 sec
Decode latency: 5.824092356488109 sec
Time for inference 3: 5.87 sec total, 43.64 tokens/sec
Decode latency: 5.82 sec
Prefill latency: 0.04 sec
Bandwidth achieved: 655.09 GB/s
FLOPS achieved: 3.28 TF/s

Prefill latency: 0.040607333183288574 sec
Decode latency: 5.808856882154942 sec
Time for inference 4: 5.85 sec total, 43.76 tokens/sec
Decode latency: 5.81 sec
Prefill latency: 0.04 sec
Bandwidth achieved: 656.80 GB/s
FLOPS achieved: 3.28 TF/s

Prefill latency: 0.040513643994927406 sec
Decode latency: 5.864822568371892 sec
Time for inference 5: 5.91 sec total, 43.34 tokens/sec
Decode latency: 5.86 sec
Prefill latency: 0.04 sec
Bandwidth achieved: 650.58 GB/s
FLOPS achieved: 3.25 TF/s

Prefill latency: 0.04070782847702503 sec
Decode latency: 5.817260129377246 sec
Time for inference 6: 5.86 sec total, 43.69 tokens/sec
Decode latency: 5.82 sec
Prefill latency: 0.04 sec
Bandwidth achieved: 655.84 GB/s
FLOPS achieved: 3.28 TF/s

Prefill latency: 0.04070678539574146 sec
Decode latency: 5.829986682161689 sec
Time for inference 7: 5.87 sec total, 43.60 tokens/sec
Decode latency: 5.83 sec
Prefill latency: 0.04 sec
Bandwidth achieved: 654.42 GB/s
FLOPS achieved: 3.27 TF/s

Prefill latency: 0.040589841082692146 sec
Decode latency: 5.829103356227279 sec
Time for inference 8: 5.87 sec total, 43.61 tokens/sec
Decode latency: 5.83 sec
Prefill latency: 0.04 sec
Bandwidth achieved: 654.53 GB/s
FLOPS achieved: 3.27 TF/s

Prefill latency: 0.04076812043786049 sec
Decode latency: 5.814724665135145 sec
Time for inference 9: 5.86 sec total, 43.71 tokens/sec
Decode latency: 5.81 sec
Prefill latency: 0.04 sec
Bandwidth achieved: 656.12 GB/s
FLOPS achieved: 3.28 TF/s

Prefill latency: 0.04065493308007717 sec
Decode latency: 5.878349727019668 sec
Time for inference 10: 5.92 sec total, 43.24 tokens/sec
Decode latency: 5.88 sec
Prefill latency: 0.04 sec
Bandwidth achieved: 649.07 GB/s
FLOPS achieved: 3.25 TF/s

==========
Batch Size: 1
Prompt Length: 1024
Generated tokens: 256
Average decode latency: 5.8327 sec
Average prefill latency: 0.0407 sec
Average tokens/sec: 43.58
Memory used: 16.83 GB
