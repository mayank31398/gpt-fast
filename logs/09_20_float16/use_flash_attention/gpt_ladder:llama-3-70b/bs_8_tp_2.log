W0920 08:26:46.217000 22697480537920 torch/distributed/run.py:779] 
W0920 08:26:46.217000 22697480537920 torch/distributed/run.py:779] *****************************************
W0920 08:26:46.217000 22697480537920 torch/distributed/run.py:779] Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
W0920 08:26:46.217000 22697480537920 torch/distributed/run.py:779] *****************************************
flash_kv_decode is set to True
Using device=cuda
Loading model ...
GPTLadder(
  (tok_embeddings): Embedding(128256, 8192)
  (layers): ModuleList(
    (0-79): 80 x LadderTransformerBlock(
      semi_compiled = False
      (attention): Attention(
        (wqkv): Linear(in_features=8192, out_features=5120, bias=False)
        (wo): Linear(in_features=4096, out_features=8192, bias=False)
      )
      (feed_forward): FeedForward(
        (w1): Linear(in_features=8192, out_features=28672, bias=False)
        (w2): Linear(in_features=14336, out_features=8192, bias=False)
      )
      (ffn_norm): RMSNorm()
      (attention_norm): RMSNorm()
    )
  )
  (norm): RMSNorm()
  (output): Linear(in_features=8192, out_features=128256, bias=False)
)
Time to load model: 0.30 seconds
/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/contextlib.py:103: FutureWarning: `torch.backends.cuda.sdp_kernel()` is deprecated. In the future, this context manager will be removed. Please see `torch.nn.attention.sdpa_kernel()` for the new context manager, with updated signature.
  self.gen = func(*args, **kwds)
/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/contextlib.py:103: FutureWarning: `torch.backends.cuda.sdp_kernel()` is deprecated. In the future, this context manager will be removed. Please see `torch.nn.attention.sdpa_kernel()` for the new context manager, with updated signature.
  self.gen = func(*args, **kwds)
Prefill latency: 3.748563202098012 sec
Decode latency: 15.933171978220344 sec
Compilation time: 19.66 seconds
Compilation time: 19.68 seconds
Prefill latency: 1.1771377511322498 sec
Decode latency: 15.31306704878807 sec
Prefill latency: 1.1791975162923336 sec
Decode latency: 14.976814342662692 sec
Prefill latency: 1.1768695395439863 sec
Decode latency: 15.23033200763166 sec
Prefill latency: 1.177895449101925 sec
Decode latency: 15.410522246733308 sec
Prefill latency: 1.1779893711209297 sec
Decode latency: 15.102575423195958 sec
Time for inference 1: 16.28 sec total, 125.79 tokens/sec
Decode latency: 15.10 sec
Prefill latency: 1.18 sec
Bandwidth achieved: 8874.95 GB/s
FLOPS achieved: 44.37 TF/s

Prefill latency: 1.1786459907889366 sec
Decode latency: 14.94151089899242 sec
Time for inference 2: 16.12 sec total, 127.04 tokens/sec
Decode latency: 14.94 sec
Prefill latency: 1.18 sec
Bandwidth achieved: 8963.24 GB/s
FLOPS achieved: 44.82 TF/s

Prefill latency: 1.1779259890317917 sec
Decode latency: 14.96949721314013 sec
Time for inference 3: 16.15 sec total, 126.82 tokens/sec
Decode latency: 14.97 sec
Prefill latency: 1.18 sec
Bandwidth achieved: 8948.13 GB/s
FLOPS achieved: 44.74 TF/s

Prefill latency: 1.17825130186975 sec
Decode latency: 15.070266025140882 sec
Time for inference 4: 16.25 sec total, 126.04 tokens/sec
Decode latency: 15.07 sec
Prefill latency: 1.18 sec
Bandwidth achieved: 8892.46 GB/s
FLOPS achieved: 44.46 TF/s

Prefill latency: 1.1781370546668768 sec
Decode latency: 14.976055411621928 sec
Time for inference 5: 16.16 sec total, 126.77 tokens/sec
Decode latency: 14.98 sec
Prefill latency: 1.18 sec
Bandwidth achieved: 8944.38 GB/s
FLOPS achieved: 44.72 TF/s

Prefill latency: 1.1777339670807123 sec
Decode latency: 15.005387276411057 sec
Time for inference 6: 16.18 sec total, 126.55 tokens/sec
Decode latency: 15.01 sec
Prefill latency: 1.18 sec
Bandwidth achieved: 8928.40 GB/s
FLOPS achieved: 44.64 TF/s

Prefill latency: 1.1804962884634733 sec
Decode latency: 15.074139470234513 sec
Time for inference 7: 16.26 sec total, 125.99 tokens/sec
Decode latency: 15.07 sec
Prefill latency: 1.18 sec
Bandwidth achieved: 8889.06 GB/s
FLOPS achieved: 44.45 TF/s

Prefill latency: 1.1820485815405846 sec
Decode latency: 15.098558468744159 sec
Time for inference 8: 16.28 sec total, 125.79 tokens/sec
Decode latency: 15.10 sec
Prefill latency: 1.18 sec
Bandwidth achieved: 8874.91 GB/s
FLOPS achieved: 44.37 TF/s

Prefill latency: 1.1809584982693195 sec
Decode latency: 15.091002842411399 sec
Time for inference 9: 16.27 sec total, 125.85 tokens/sec
Decode latency: 15.09 sec
Prefill latency: 1.18 sec
Bandwidth achieved: 8879.64 GB/s
FLOPS achieved: 44.40 TF/s

Prefill latency: 1.1791118048131466 sec
Decode latency: 15.058934548869729 sec
Time for inference 10: 16.24 sec total, 126.12 tokens/sec
Decode latency: 15.06 sec
Prefill latency: 1.18 sec
Bandwidth achieved: 8898.14 GB/s
FLOPS achieved: 44.49 TF/s

==========
Batch Size: 8
Prompt Length: 1024
Generated tokens: 256
Average decode latency: 15.0388 sec
Average prefill latency: 1.1791 sec
Average tokens/sec: 126.27
Memory used: 78.73 GB
