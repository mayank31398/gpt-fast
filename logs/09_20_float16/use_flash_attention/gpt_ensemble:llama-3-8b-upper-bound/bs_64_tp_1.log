flash_kv_decode is set to True
Using device=cuda
Loading model ...
GPTEnsemble(
  (tok_embeddings): Embedding(128256, 4096)
  (layers): ModuleList(
    (0-31): 32 x EnsembleTransformerBlock(
      semi_compiled = False
      (attention): Attention(
        (wqkv): Linear(in_features=4096, out_features=6144, bias=False)
        (wo): Linear(in_features=4096, out_features=4096, bias=False)
      )
      (feed_forward): FeedForward(
        (w1): Linear(in_features=4096, out_features=28672, bias=False)
        (w2): Linear(in_features=14336, out_features=4096, bias=False)
      )
      (ffn_norm): RMSNorm()
      (attention_norm): RMSNorm()
    )
  )
  (norm): RMSNorm()
  (output): Linear(in_features=4096, out_features=128256, bias=False)
)
Time to load model: 1.03 seconds
/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/contextlib.py:103: FutureWarning: `torch.backends.cuda.sdp_kernel()` is deprecated. In the future, this context manager will be removed. Please see `torch.nn.attention.sdpa_kernel()` for the new context manager, with updated signature.
  self.gen = func(*args, **kwds)
Prefill latency: 3.682976322248578 sec
Decode latency: 5.0527674071490765 sec
Compilation time: 8.74 seconds
Prefill latency: 2.2932961620390415 sec
Decode latency: 5.069901587441564 sec
Prefill latency: 2.3014288898557425 sec
Decode latency: 5.082254303619266 sec
Prefill latency: 2.2963189389556646 sec
Decode latency: 5.105747975409031 sec
Prefill latency: 2.301843812689185 sec
Decode latency: 5.071492072194815 sec
Prefill latency: 2.2980128321796656 sec
Decode latency: 5.0459846239537 sec
Time for inference 1: 7.34 sec total, 2230.67 tokens/sec
Decode latency: 5.05 sec
Prefill latency: 2.30 sec
Bandwidth achieved: 33481.99 GB/s
FLOPS achieved: 167.41 TF/s

Prefill latency: 2.2981114219874144 sec
Decode latency: 5.04332316853106 sec
Time for inference 2: 7.34 sec total, 2231.40 tokens/sec
Decode latency: 5.04 sec
Prefill latency: 2.30 sec
Bandwidth achieved: 33493.02 GB/s
FLOPS achieved: 167.47 TF/s

Prefill latency: 2.3062777034938335 sec
Decode latency: 5.045346053317189 sec
Time for inference 3: 7.35 sec total, 2228.33 tokens/sec
Decode latency: 5.05 sec
Prefill latency: 2.31 sec
Bandwidth achieved: 33446.92 GB/s
FLOPS achieved: 167.23 TF/s

Prefill latency: 2.299053492024541 sec
Decode latency: 5.066901192069054 sec
Time for inference 4: 7.37 sec total, 2224.03 tokens/sec
Decode latency: 5.07 sec
Prefill latency: 2.30 sec
Bandwidth achieved: 33382.36 GB/s
FLOPS achieved: 166.91 TF/s

Prefill latency: 2.2995055709034204 sec
Decode latency: 5.058336304500699 sec
Time for inference 5: 7.36 sec total, 2226.46 tokens/sec
Decode latency: 5.06 sec
Prefill latency: 2.30 sec
Bandwidth achieved: 33418.79 GB/s
FLOPS achieved: 167.09 TF/s

Prefill latency: 2.303068546578288 sec
Decode latency: 5.084528233855963 sec
Time for inference 6: 7.39 sec total, 2217.45 tokens/sec
Decode latency: 5.08 sec
Prefill latency: 2.30 sec
Bandwidth achieved: 33283.63 GB/s
FLOPS achieved: 166.42 TF/s

Prefill latency: 2.307246433570981 sec
Decode latency: 5.022203117609024 sec
Time for inference 7: 7.33 sec total, 2235.09 tokens/sec
Decode latency: 5.02 sec
Prefill latency: 2.31 sec
Bandwidth achieved: 33548.30 GB/s
FLOPS achieved: 167.74 TF/s

Prefill latency: 2.3058454394340515 sec
Decode latency: 5.017845079302788 sec
Time for inference 8: 7.32 sec total, 2236.85 tokens/sec
Decode latency: 5.02 sec
Prefill latency: 2.31 sec
Bandwidth achieved: 33574.77 GB/s
FLOPS achieved: 167.87 TF/s

Prefill latency: 2.3029898032546043 sec
Decode latency: 5.036614075303078 sec
Time for inference 9: 7.34 sec total, 2231.98 tokens/sec
Decode latency: 5.04 sec
Prefill latency: 2.30 sec
Bandwidth achieved: 33501.75 GB/s
FLOPS achieved: 167.51 TF/s

Prefill latency: 2.297692848369479 sec
Decode latency: 5.090731581673026 sec
Time for inference 10: 7.39 sec total, 2217.22 tokens/sec
Decode latency: 5.09 sec
Prefill latency: 2.30 sec
Bandwidth achieved: 33280.11 GB/s
FLOPS achieved: 166.40 TF/s

==========
Batch Size: 64
Prompt Length: 1024
Generated tokens: 256
Average decode latency: 5.0512 sec
Average prefill latency: 2.3018 sec
Average tokens/sec: 2227.95
Memory used: 57.36 GB
