flash_kv_decode is set to True
Using device=cuda
Loading model ...
GPTEnsemble(
  (tok_embeddings): Embedding(128256, 4096)
  (layers): ModuleList(
    (0-31): 32 x EnsembleTransformerBlock(
      semi_compiled = False
      (attention): Attention(
        (wqkv): Linear(in_features=4096, out_features=6144, bias=False)
        (wo): Linear(in_features=4096, out_features=4096, bias=False)
      )
      (feed_forward): FeedForward(
        (w1): Linear(in_features=4096, out_features=28672, bias=False)
        (w2): Linear(in_features=14336, out_features=4096, bias=False)
      )
      (ffn_norm): RMSNorm()
      (attention_norm): RMSNorm()
    )
  )
  (norm): RMSNorm()
  (output): Linear(in_features=4096, out_features=128256, bias=False)
)
Time to load model: 1.13 seconds
/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/contextlib.py:103: FutureWarning: `torch.backends.cuda.sdp_kernel()` is deprecated. In the future, this context manager will be removed. Please see `torch.nn.attention.sdpa_kernel()` for the new context manager, with updated signature.
  self.gen = func(*args, **kwds)
Prefill latency: 1.336566235870123 sec
Decode latency: 5.494695570319891 sec
Compilation time: 6.83 seconds
Prefill latency: 0.13246076740324497 sec
Decode latency: 5.157622097060084 sec
Prefill latency: 0.13132547214627266 sec
Decode latency: 5.181395905092359 sec
Prefill latency: 0.1323679555207491 sec
Decode latency: 5.144317351281643 sec
Prefill latency: 0.1316488105803728 sec
Decode latency: 5.225161571055651 sec
Prefill latency: 0.1325406450778246 sec
Decode latency: 5.160313138738275 sec
Time for inference 1: 5.29 sec total, 193.43 tokens/sec
Decode latency: 5.16 sec
Prefill latency: 0.13 sec
Bandwidth achieved: 2903.43 GB/s
FLOPS achieved: 14.52 TF/s

Prefill latency: 0.13191762566566467 sec
Decode latency: 5.226670993492007 sec
Time for inference 2: 5.36 sec total, 191.06 tokens/sec
Decode latency: 5.23 sec
Prefill latency: 0.13 sec
Bandwidth achieved: 2867.73 GB/s
FLOPS achieved: 14.34 TF/s

Prefill latency: 0.132008021697402 sec
Decode latency: 5.076609041541815 sec
Time for inference 3: 5.21 sec total, 196.56 tokens/sec
Decode latency: 5.08 sec
Prefill latency: 0.13 sec
Bandwidth achieved: 2950.37 GB/s
FLOPS achieved: 14.75 TF/s

Prefill latency: 0.13226461224257946 sec
Decode latency: 5.078350555151701 sec
Time for inference 4: 5.21 sec total, 196.49 tokens/sec
Decode latency: 5.08 sec
Prefill latency: 0.13 sec
Bandwidth achieved: 2949.25 GB/s
FLOPS achieved: 14.75 TF/s

Prefill latency: 0.13243108987808228 sec
Decode latency: 5.085185019299388 sec
Time for inference 5: 5.22 sec total, 196.22 tokens/sec
Decode latency: 5.09 sec
Prefill latency: 0.13 sec
Bandwidth achieved: 2945.30 GB/s
FLOPS achieved: 14.73 TF/s

Prefill latency: 0.13231396302580833 sec
Decode latency: 5.076968559995294 sec
Time for inference 6: 5.21 sec total, 196.54 tokens/sec
Decode latency: 5.08 sec
Prefill latency: 0.13 sec
Bandwidth achieved: 2949.99 GB/s
FLOPS achieved: 14.75 TF/s

Prefill latency: 0.13252775557339191 sec
Decode latency: 5.070880815386772 sec
Time for inference 7: 5.20 sec total, 196.76 tokens/sec
Decode latency: 5.07 sec
Prefill latency: 0.13 sec
Bandwidth achieved: 2953.34 GB/s
FLOPS achieved: 14.77 TF/s

Prefill latency: 0.13272292539477348 sec
Decode latency: 5.084711411967874 sec
Time for inference 8: 5.22 sec total, 196.23 tokens/sec
Decode latency: 5.08 sec
Prefill latency: 0.13 sec
Bandwidth achieved: 2945.34 GB/s
FLOPS achieved: 14.73 TF/s

Prefill latency: 0.13245450519025326 sec
Decode latency: 5.068714119493961 sec
Time for inference 9: 5.20 sec total, 196.84 tokens/sec
Decode latency: 5.07 sec
Prefill latency: 0.13 sec
Bandwidth achieved: 2954.60 GB/s
FLOPS achieved: 14.77 TF/s

Prefill latency: 0.1324676349759102 sec
Decode latency: 5.165562888607383 sec
Time for inference 10: 5.30 sec total, 193.25 tokens/sec
Decode latency: 5.17 sec
Prefill latency: 0.13 sec
Bandwidth achieved: 2900.60 GB/s
FLOPS achieved: 14.50 TF/s

==========
Batch Size: 4
Prompt Length: 1024
Generated tokens: 256
Average decode latency: 5.1094 sec
Average prefill latency: 0.1324 sec
Average tokens/sec: 195.34
Memory used: 18.96 GB
