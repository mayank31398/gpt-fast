flash_kv_decode is set to True
Using device=cuda
Loading model ...
GPTLadder(
  (tok_embeddings): Embedding(128256, 4096)
  (layers): ModuleList(
    (0-31): 32 x LadderTransformerBlock(
      semi_compiled = False
      (attention): Attention(
        (wqkv): Linear(in_features=4096, out_features=6144, bias=False)
        (wo): Linear(in_features=4096, out_features=4096, bias=False)
      )
      (feed_forward): FeedForward(
        (w1): Linear(in_features=4096, out_features=28672, bias=False)
        (w2): Linear(in_features=14336, out_features=4096, bias=False)
      )
      (ffn_norm): RMSNorm()
      (attention_norm): RMSNorm()
    )
  )
  (norm): RMSNorm()
  (output): Linear(in_features=4096, out_features=128256, bias=False)
)
Time to load model: 0.23 seconds
/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/contextlib.py:103: FutureWarning: `torch.backends.cuda.sdp_kernel()` is deprecated. In the future, this context manager will be removed. Please see `torch.nn.attention.sdpa_kernel()` for the new context manager, with updated signature.
  self.gen = func(*args, **kwds)
Prefill latency: 1.8988231159746647 sec
Decode latency: 7.4246811885386705 sec
Compilation time: 9.32 seconds
Prefill latency: 0.1335234884172678 sec
Decode latency: 7.210993319749832 sec
Prefill latency: 0.1323273740708828 sec
Decode latency: 7.161984596401453 sec
Prefill latency: 0.13291884027421474 sec
Decode latency: 7.14376506768167 sec
Prefill latency: 0.13207084126770496 sec
Decode latency: 7.158505843952298 sec
Prefill latency: 0.1336993109434843 sec
Decode latency: 7.219106812030077 sec
Time for inference 1: 7.35 sec total, 139.25 tokens/sec
Decode latency: 7.22 sec
Prefill latency: 0.13 sec
Bandwidth achieved: 2090.06 GB/s
FLOPS achieved: 10.45 TF/s

Prefill latency: 0.13363861292600632 sec
Decode latency: 7.302851017564535 sec
Time for inference 2: 7.44 sec total, 137.68 tokens/sec
Decode latency: 7.30 sec
Prefill latency: 0.13 sec
Bandwidth achieved: 2066.50 GB/s
FLOPS achieved: 10.33 TF/s

Prefill latency: 0.13239997252821922 sec
Decode latency: 7.282274272292852 sec
Time for inference 3: 7.42 sec total, 138.08 tokens/sec
Decode latency: 7.28 sec
Prefill latency: 0.13 sec
Bandwidth achieved: 2072.62 GB/s
FLOPS achieved: 10.36 TF/s

Prefill latency: 0.1335815116763115 sec
Decode latency: 7.188923180103302 sec
Time for inference 4: 7.32 sec total, 139.82 tokens/sec
Decode latency: 7.19 sec
Prefill latency: 0.13 sec
Bandwidth achieved: 2098.71 GB/s
FLOPS achieved: 10.49 TF/s

Prefill latency: 0.13341456837952137 sec
Decode latency: 7.0997549425810575 sec
Time for inference 5: 7.23 sec total, 141.55 tokens/sec
Decode latency: 7.10 sec
Prefill latency: 0.13 sec
Bandwidth achieved: 2124.62 GB/s
FLOPS achieved: 10.62 TF/s

Prefill latency: 0.1335605587810278 sec
Decode latency: 7.100022392347455 sec
Time for inference 6: 7.23 sec total, 141.54 tokens/sec
Decode latency: 7.10 sec
Prefill latency: 0.13 sec
Bandwidth achieved: 2124.50 GB/s
FLOPS achieved: 10.62 TF/s

Prefill latency: 0.13306078501045704 sec
Decode latency: 7.113782657310367 sec
Time for inference 7: 7.25 sec total, 141.28 tokens/sec
Decode latency: 7.11 sec
Prefill latency: 0.13 sec
Bandwidth achieved: 2120.60 GB/s
FLOPS achieved: 10.60 TF/s

Prefill latency: 0.13492572493851185 sec
Decode latency: 7.098619991913438 sec
Time for inference 8: 7.23 sec total, 141.54 tokens/sec
Decode latency: 7.10 sec
Prefill latency: 0.13 sec
Bandwidth achieved: 2124.52 GB/s
FLOPS achieved: 10.62 TF/s

Prefill latency: 0.13263222202658653 sec
Decode latency: 7.11652796715498 sec
Time for inference 9: 7.25 sec total, 141.24 tokens/sec
Decode latency: 7.12 sec
Prefill latency: 0.13 sec
Bandwidth achieved: 2119.94 GB/s
FLOPS achieved: 10.60 TF/s

Prefill latency: 0.1328912228345871 sec
Decode latency: 7.181259585544467 sec
Time for inference 10: 7.32 sec total, 139.98 tokens/sec
Decode latency: 7.18 sec
Prefill latency: 0.13 sec
Bandwidth achieved: 2101.11 GB/s
FLOPS achieved: 10.51 TF/s

==========
Batch Size: 4
Prompt Length: 1024
Generated tokens: 256
Average decode latency: 7.1703 sec
Average prefill latency: 0.1334 sec
Average tokens/sec: 140.20
Memory used: 19.07 GB
