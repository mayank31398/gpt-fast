flash_kv_decode is set to True
Using device=cuda
Loading model ...
GPTLadder(
  (tok_embeddings): Embedding(128256, 4096)
  (layers): ModuleList(
    (0-31): 32 x LadderTransformerBlock(
      semi_compiled = False
      (attention): Attention(
        (wqkv): Linear(in_features=4096, out_features=6144, bias=False)
        (wo): Linear(in_features=4096, out_features=4096, bias=False)
      )
      (feed_forward): FeedForward(
        (w1): Linear(in_features=4096, out_features=28672, bias=False)
        (w2): Linear(in_features=14336, out_features=4096, bias=False)
      )
      (ffn_norm): RMSNorm()
      (attention_norm): RMSNorm()
    )
  )
  (norm): RMSNorm()
  (output): Linear(in_features=4096, out_features=128256, bias=False)
)
Time to load model: 0.23 seconds
/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/contextlib.py:103: FutureWarning: `torch.backends.cuda.sdp_kernel()` is deprecated. In the future, this context manager will be removed. Please see `torch.nn.attention.sdpa_kernel()` for the new context manager, with updated signature.
  self.gen = func(*args, **kwds)
Prefill latency: 2.324194461107254 sec
Decode latency: 7.297649700194597 sec
Compilation time: 9.62 seconds
Prefill latency: 0.5334835201501846 sec
Decode latency: 7.08789992891252 sec
Prefill latency: 0.5342628117650747 sec
Decode latency: 7.00822844542563 sec
Prefill latency: 0.5340641587972641 sec
Decode latency: 7.028522031381726 sec
Prefill latency: 0.5293849594891071 sec
Decode latency: 7.068340567871928 sec
Prefill latency: 0.5313511695712805 sec
Decode latency: 7.105638587847352 sec
Time for inference 1: 7.64 sec total, 536.27 tokens/sec
Decode latency: 7.11 sec
Prefill latency: 0.53 sec
Bandwidth achieved: 8049.26 GB/s
FLOPS achieved: 40.25 TF/s

Prefill latency: 0.5339446719735861 sec
Decode latency: 7.246651483699679 sec
Time for inference 2: 7.78 sec total, 526.36 tokens/sec
Decode latency: 7.25 sec
Prefill latency: 0.53 sec
Bandwidth achieved: 7900.65 GB/s
FLOPS achieved: 39.50 TF/s

Prefill latency: 0.5315189696848392 sec
Decode latency: 7.130510052666068 sec
Time for inference 3: 7.66 sec total, 534.51 tokens/sec
Decode latency: 7.13 sec
Prefill latency: 0.53 sec
Bandwidth achieved: 8022.89 GB/s
FLOPS achieved: 40.11 TF/s

Prefill latency: 0.5322464723140001 sec
Decode latency: 7.091678470373154 sec
Time for inference 4: 7.62 sec total, 537.18 tokens/sec
Decode latency: 7.09 sec
Prefill latency: 0.53 sec
Bandwidth achieved: 8063.03 GB/s
FLOPS achieved: 40.32 TF/s

Prefill latency: 0.5342545565217733 sec
Decode latency: 7.072857528924942 sec
Time for inference 5: 7.61 sec total, 538.36 tokens/sec
Decode latency: 7.07 sec
Prefill latency: 0.53 sec
Bandwidth achieved: 8080.74 GB/s
FLOPS achieved: 40.40 TF/s

Prefill latency: 0.5311203896999359 sec
Decode latency: 7.074680397287011 sec
Time for inference 6: 7.61 sec total, 538.46 tokens/sec
Decode latency: 7.07 sec
Prefill latency: 0.53 sec
Bandwidth achieved: 8082.19 GB/s
FLOPS achieved: 40.41 TF/s

Prefill latency: 0.5318166557699442 sec
Decode latency: 7.037081368267536 sec
Time for inference 7: 7.57 sec total, 541.08 tokens/sec
Decode latency: 7.04 sec
Prefill latency: 0.53 sec
Bandwidth achieved: 8121.59 GB/s
FLOPS achieved: 40.61 TF/s

Prefill latency: 0.5303003638982773 sec
Decode latency: 7.100869024172425 sec
Time for inference 8: 7.63 sec total, 536.68 tokens/sec
Decode latency: 7.10 sec
Prefill latency: 0.53 sec
Bandwidth achieved: 8055.43 GB/s
FLOPS achieved: 40.28 TF/s

Prefill latency: 0.5307310409843922 sec
Decode latency: 7.057444924488664 sec
Time for inference 9: 7.59 sec total, 539.71 tokens/sec
Decode latency: 7.06 sec
Prefill latency: 0.53 sec
Bandwidth achieved: 8101.02 GB/s
FLOPS achieved: 40.51 TF/s

Prefill latency: 0.5334848649799824 sec
Decode latency: 7.099928580224514 sec
Time for inference 10: 7.63 sec total, 536.51 tokens/sec
Decode latency: 7.10 sec
Prefill latency: 0.53 sec
Bandwidth achieved: 8052.89 GB/s
FLOPS achieved: 40.26 TF/s

==========
Batch Size: 16
Prompt Length: 1024
Generated tokens: 256
Average decode latency: 7.1017 sec
Average prefill latency: 0.5321 sec
Average tokens/sec: 536.51
Memory used: 26.83 GB
