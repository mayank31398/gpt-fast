flash_kv_decode is set to True
Using device=cuda
Loading model ...
GPTEnsemble(
  (tok_embeddings): Embedding(128256, 4096)
  (layers): ModuleList(
    (0-31): 32 x EnsembleTransformerBlock(
      semi_compiled = False
      (attention): Attention(
        (wqkv): Linear(in_features=4096, out_features=6144, bias=False)
        (wo): Linear(in_features=4096, out_features=4096, bias=False)
      )
      (feed_forward): FeedForward(
        (w1): Linear(in_features=4096, out_features=28672, bias=False)
        (w2): Linear(in_features=14336, out_features=4096, bias=False)
      )
      (ffn_norm): RMSNorm()
      (attention_norm): RMSNorm()
    )
  )
  (norm): RMSNorm()
  (output): Linear(in_features=4096, out_features=128256, bias=False)
)
Time to load model: 0.94 seconds
Prefill latency: 0.130310776992701 sec
Decode latency: 0.28505301603581756 sec
Compilation time: 0.42 seconds
Prefill latency: 0.13067165506072342 sec
Decode latency: 0.28430031903553754 sec
Prefill latency: 0.1309785849880427 sec
Decode latency: 0.2842504469444975 sec
Prefill latency: 0.12991095904726535 sec
Decode latency: 0.2837400749558583 sec
Prefill latency: 0.1294543599942699 sec
Decode latency: 0.2837267239810899 sec
Prefill latency: 0.13020173204131424 sec
Decode latency: 0.2840070530073717 sec
Time for inference 1: 0.41 sec total, 308.63 tokens/sec
Decode latency: 0.28 sec
Prefill latency: 0.13 sec
Bandwidth achieved: 4632.51 GB/s
FLOPS achieved: 152.87 TF/s

Prefill latency: 0.13255480502266437 sec
Decode latency: 0.28387511405162513 sec
Time for inference 2: 0.42 sec total, 307.03 tokens/sec
Decode latency: 0.28 sec
Prefill latency: 0.13 sec
Bandwidth achieved: 4608.43 GB/s
FLOPS achieved: 152.08 TF/s

Prefill latency: 0.13210885401349515 sec
Decode latency: 0.27953904599417 sec
Time for inference 3: 0.41 sec total, 310.62 tokens/sec
Decode latency: 0.28 sec
Prefill latency: 0.13 sec
Bandwidth achieved: 4662.30 GB/s
FLOPS achieved: 153.86 TF/s

Prefill latency: 0.13062494504265487 sec
Decode latency: 0.28385404497385025 sec
Time for inference 4: 0.41 sec total, 308.52 tokens/sec
Decode latency: 0.28 sec
Prefill latency: 0.13 sec
Bandwidth achieved: 4630.83 GB/s
FLOPS achieved: 152.82 TF/s

Prefill latency: 0.1305440659634769 sec
Decode latency: 0.28324913198594004 sec
Time for inference 5: 0.41 sec total, 309.03 tokens/sec
Decode latency: 0.28 sec
Prefill latency: 0.13 sec
Bandwidth achieved: 4638.48 GB/s
FLOPS achieved: 153.07 TF/s

Prefill latency: 0.1307970789493993 sec
Decode latency: 0.2833687859820202 sec
Time for inference 6: 0.41 sec total, 308.72 tokens/sec
Decode latency: 0.28 sec
Prefill latency: 0.13 sec
Bandwidth achieved: 4633.90 GB/s
FLOPS achieved: 152.92 TF/s

Prefill latency: 0.13113418803550303 sec
Decode latency: 0.2843006980838254 sec
Time for inference 7: 0.42 sec total, 307.79 tokens/sec
Decode latency: 0.28 sec
Prefill latency: 0.13 sec
Bandwidth achieved: 4619.85 GB/s
FLOPS achieved: 152.46 TF/s

Prefill latency: 0.13174852496013045 sec
Decode latency: 0.28479236899875104 sec
Time for inference 8: 0.42 sec total, 306.98 tokens/sec
Decode latency: 0.28 sec
Prefill latency: 0.13 sec
Bandwidth achieved: 4607.76 GB/s
FLOPS achieved: 152.06 TF/s

Prefill latency: 0.1318870090181008 sec
Decode latency: 0.28403842402622104 sec
Time for inference 9: 0.42 sec total, 307.44 tokens/sec
Decode latency: 0.28 sec
Prefill latency: 0.13 sec
Bandwidth achieved: 4614.58 GB/s
FLOPS achieved: 152.28 TF/s

Prefill latency: 0.1317939800210297 sec
Decode latency: 0.2838730509392917 sec
Time for inference 10: 0.42 sec total, 307.61 tokens/sec
Decode latency: 0.28 sec
Prefill latency: 0.13 sec
Bandwidth achieved: 4617.22 GB/s
FLOPS achieved: 152.37 TF/s

==========
Batch Size: 4
Prompt Length: 1024
Generated tokens: 32
Average decode latency: 0.2835 sec
Average prefill latency: 0.1313 sec
Average tokens/sec: 308.24
Memory used: 18.77 GB
Done. we are killing the process
