flash_kv_decode is set to True
Using device=cuda
Loading model ...
GPTDense(
  (tok_embeddings): Embedding(128256, 4096)
  (layers): ModuleList(
    (0-31): 32 x DenseTransformerBlock(
      semi_compiled = False
      (attention): Attention(
        (wqkv): Linear(in_features=4096, out_features=6144, bias=False)
        (wo): Linear(in_features=4096, out_features=4096, bias=False)
      )
      (feed_forward): FeedForward(
        (w1): Linear(in_features=4096, out_features=28672, bias=False)
        (w2): Linear(in_features=14336, out_features=4096, bias=False)
      )
      (ffn_norm): RMSNorm()
      (attention_norm): RMSNorm()
    )
  )
  (norm): RMSNorm()
  (output): Linear(in_features=4096, out_features=128256, bias=False)
)
Time to load model: 1.00 seconds
[rank0]:[W1001 20:28:10.962935268 CUDAGraph.cpp:150] Warning: Waiting for pending NCCL work to finish before starting graph capture. (function operator())
Prefill latency: 0.5335471059661359 sec
Decode latency: 0.31621507194358855 sec
Compilation time: 0.85 seconds
Prefill latency: 0.533842392032966 sec
Decode latency: 0.31446254800539464 sec
Prefill latency: 0.5350286280736327 sec
Decode latency: 0.31444614799693227 sec
Prefill latency: 0.5355188739486039 sec
Decode latency: 0.31462811201345176 sec
Prefill latency: 0.5361756150377914 sec
Decode latency: 0.3150513640139252 sec
Prefill latency: 0.5340644230600446 sec
Decode latency: 0.31501581496559083 sec
Time for inference 1: 0.85 sec total, 602.67 tokens/sec
Decode latency: 0.32 sec
Prefill latency: 0.53 sec
Bandwidth achieved: 9046.06 GB/s
FLOPS achieved: 298.52 TF/s

Prefill latency: 0.5357602069852874 sec
Decode latency: 0.3142097690142691 sec
Time for inference 2: 0.85 sec total, 602.01 tokens/sec
Decode latency: 0.31 sec
Prefill latency: 0.54 sec
Bandwidth achieved: 9036.05 GB/s
FLOPS achieved: 298.19 TF/s

Prefill latency: 0.535614900989458 sec
Decode latency: 0.31476134003605694 sec
Time for inference 3: 0.85 sec total, 601.74 tokens/sec
Decode latency: 0.31 sec
Prefill latency: 0.54 sec
Bandwidth achieved: 9032.09 GB/s
FLOPS achieved: 298.06 TF/s

Prefill latency: 0.5331937739392743 sec
Decode latency: 0.31455659901257604 sec
Time for inference 4: 0.85 sec total, 603.62 tokens/sec
Decode latency: 0.31 sec
Prefill latency: 0.53 sec
Bandwidth achieved: 9060.22 GB/s
FLOPS achieved: 298.99 TF/s

Prefill latency: 0.5357680339366198 sec
Decode latency: 0.3156024510972202 sec
Time for inference 5: 0.85 sec total, 601.07 tokens/sec
Decode latency: 0.32 sec
Prefill latency: 0.54 sec
Bandwidth achieved: 9021.90 GB/s
FLOPS achieved: 297.72 TF/s

Prefill latency: 0.5362995089963078 sec
Decode latency: 0.3146845209412277 sec
Time for inference 6: 0.85 sec total, 601.29 tokens/sec
Decode latency: 0.31 sec
Prefill latency: 0.54 sec
Bandwidth achieved: 9025.26 GB/s
FLOPS achieved: 297.83 TF/s

Prefill latency: 0.5354849239811301 sec
Decode latency: 0.31450486998073757 sec
Time for inference 7: 0.85 sec total, 602.02 tokens/sec
Decode latency: 0.31 sec
Prefill latency: 0.54 sec
Bandwidth achieved: 9036.22 GB/s
FLOPS achieved: 298.20 TF/s

Prefill latency: 0.5361723279347643 sec
Decode latency: 0.3147585359402001 sec
Time for inference 8: 0.85 sec total, 601.35 tokens/sec
Decode latency: 0.31 sec
Prefill latency: 0.54 sec
Bandwidth achieved: 9026.19 GB/s
FLOPS achieved: 297.86 TF/s

Prefill latency: 0.5363487430149689 sec
Decode latency: 0.3148354609729722 sec
Time for inference 9: 0.85 sec total, 601.19 tokens/sec
Decode latency: 0.31 sec
Prefill latency: 0.54 sec
Bandwidth achieved: 9023.71 GB/s
FLOPS achieved: 297.78 TF/s

Prefill latency: 0.5349127210211009 sec
Decode latency: 0.3144861781038344 sec
Time for inference 10: 0.85 sec total, 602.45 tokens/sec
Decode latency: 0.31 sec
Prefill latency: 0.53 sec
Bandwidth achieved: 9042.74 GB/s
FLOPS achieved: 298.41 TF/s

==========
Batch Size: 16
Prompt Length: 1024
Generated tokens: 32
Average decode latency: 0.3147 sec
Average prefill latency: 0.5354 sec
Average tokens/sec: 601.94
Memory used: 35.07 GB
Done. we are killing the process
