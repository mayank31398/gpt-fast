flash_kv_decode is set to True
Using device=cuda
Loading model ...
GPTDense(
  (tok_embeddings): Embedding(128256, 4096)
  (layers): ModuleList(
    (0-31): 32 x DenseTransformerBlock(
      semi_compiled = False
      (attention): Attention(
        (wqkv): Linear(in_features=4096, out_features=6144, bias=False)
        (wo): Linear(in_features=4096, out_features=4096, bias=False)
      )
      (feed_forward): FeedForward(
        (w1): Linear(in_features=4096, out_features=28672, bias=False)
        (w2): Linear(in_features=14336, out_features=4096, bias=False)
      )
      (ffn_norm): RMSNorm()
      (attention_norm): RMSNorm()
    )
  )
  (norm): RMSNorm()
  (output): Linear(in_features=4096, out_features=128256, bias=False)
)
Time to load model: 0.95 seconds
[rank0]:[W1001 20:26:57.763585961 CUDAGraph.cpp:150] Warning: Waiting for pending NCCL work to finish before starting graph capture. (function operator())
Prefill latency: 0.13122151291463524 sec
Decode latency: 0.290642432984896 sec
Compilation time: 0.42 seconds
Prefill latency: 0.13291814492549747 sec
Decode latency: 0.2883476740680635 sec
Prefill latency: 0.1321595920016989 sec
Decode latency: 0.2886811629869044 sec
Prefill latency: 0.1332851129118353 sec
Decode latency: 0.28786222101189196 sec
Prefill latency: 0.1309260429115966 sec
Decode latency: 0.28858837101142853 sec
Prefill latency: 0.13138979801442474 sec
Decode latency: 0.2887249859049916 sec
Time for inference 1: 0.42 sec total, 304.31 tokens/sec
Decode latency: 0.29 sec
Prefill latency: 0.13 sec
Bandwidth achieved: 4567.62 GB/s
FLOPS achieved: 150.73 TF/s

Prefill latency: 0.13184514897875488 sec
Decode latency: 0.28798380901571363 sec
Time for inference 2: 0.42 sec total, 304.52 tokens/sec
Decode latency: 0.29 sec
Prefill latency: 0.13 sec
Bandwidth achieved: 4570.82 GB/s
FLOPS achieved: 150.84 TF/s

Prefill latency: 0.1329665519297123 sec
Decode latency: 0.28823519009165466 sec
Time for inference 3: 0.42 sec total, 303.53 tokens/sec
Decode latency: 0.29 sec
Prefill latency: 0.13 sec
Bandwidth achieved: 4555.95 GB/s
FLOPS achieved: 150.35 TF/s

Prefill latency: 0.13104831194505095 sec
Decode latency: 0.2886608890257776 sec
Time for inference 4: 0.42 sec total, 304.61 tokens/sec
Decode latency: 0.29 sec
Prefill latency: 0.13 sec
Bandwidth achieved: 4572.22 GB/s
FLOPS achieved: 150.88 TF/s

Prefill latency: 0.1325105440337211 sec
Decode latency: 0.2881326120113954 sec
Time for inference 5: 0.42 sec total, 303.95 tokens/sec
Decode latency: 0.29 sec
Prefill latency: 0.13 sec
Bandwidth achieved: 4562.20 GB/s
FLOPS achieved: 150.55 TF/s

Prefill latency: 0.13227902993094176 sec
Decode latency: 0.2882180770393461 sec
Time for inference 6: 0.42 sec total, 304.06 tokens/sec
Decode latency: 0.29 sec
Prefill latency: 0.13 sec
Bandwidth achieved: 4563.84 GB/s
FLOPS achieved: 150.61 TF/s

Prefill latency: 0.1325829979032278 sec
Decode latency: 0.2880431819939986 sec
Time for inference 7: 0.42 sec total, 303.97 tokens/sec
Decode latency: 0.29 sec
Prefill latency: 0.13 sec
Bandwidth achieved: 4562.50 GB/s
FLOPS achieved: 150.56 TF/s

Prefill latency: 0.1326024739537388 sec
Decode latency: 0.2881962629035115 sec
Time for inference 8: 0.42 sec total, 303.83 tokens/sec
Decode latency: 0.29 sec
Prefill latency: 0.13 sec
Bandwidth achieved: 4560.49 GB/s
FLOPS achieved: 150.50 TF/s

Prefill latency: 0.13189025095198303 sec
Decode latency: 0.2887046090327203 sec
Time for inference 9: 0.42 sec total, 303.98 tokens/sec
Decode latency: 0.29 sec
Prefill latency: 0.13 sec
Bandwidth achieved: 4562.75 GB/s
FLOPS achieved: 150.57 TF/s

Prefill latency: 0.1342250929446891 sec
Decode latency: 0.2888684320496395 sec
Time for inference 10: 0.42 sec total, 302.18 tokens/sec
Decode latency: 0.29 sec
Prefill latency: 0.13 sec
Bandwidth achieved: 4535.75 GB/s
FLOPS achieved: 149.68 TF/s

==========
Batch Size: 4
Prompt Length: 1024
Generated tokens: 32
Average decode latency: 0.2884 sec
Average prefill latency: 0.1323 sec
Average tokens/sec: 303.89
Memory used: 21.01 GB
Done. we are killing the process
