flash_kv_decode is set to True
Using device=cuda
Loading model ...
GPTParallel(
  (tok_embeddings): Embedding(128256, 4096)
  (layers): ModuleList(
    (0-31): 32 x ParallelTransformerBlock(
      semi_compiled = False
      (attention): FuseAttentionMLP(
        (wqkv1): Linear(in_features=4096, out_features=34816, bias=False)
        (wo): Linear(in_features=4096, out_features=4096, bias=False)
        (w2): Linear(in_features=14336, out_features=4096, bias=False)
      )
      (attention_norm): RMSNorm()
    )
  )
  (norm): RMSNorm()
  (output): Linear(in_features=4096, out_features=128256, bias=False)
)
Time to load model: 0.91 seconds
[rank0]:[W1001 20:37:38.048047141 CUDAGraph.cpp:150] Warning: Waiting for pending NCCL work to finish before starting graph capture. (function operator())
Prefill latency: 0.12960772903170437 sec
Decode latency: 0.28948762197978795 sec
Compilation time: 0.42 seconds
Prefill latency: 0.12944234197493643 sec
Decode latency: 0.28964593494310975 sec
Prefill latency: 0.12882292398717254 sec
Decode latency: 0.2896377509459853 sec
Prefill latency: 0.1296392100630328 sec
Decode latency: 0.2892910080263391 sec
Prefill latency: 0.12856061803177 sec
Decode latency: 0.2897633370012045 sec
Prefill latency: 0.12970010295975953 sec
Decode latency: 0.28973364597186446 sec
Time for inference 1: 0.42 sec total, 304.75 tokens/sec
Decode latency: 0.29 sec
Prefill latency: 0.13 sec
Bandwidth achieved: 4574.15 GB/s
FLOPS achieved: 150.95 TF/s

Prefill latency: 0.12939348397776484 sec
Decode latency: 0.2895009840140119 sec
Time for inference 2: 0.42 sec total, 305.13 tokens/sec
Decode latency: 0.29 sec
Prefill latency: 0.13 sec
Bandwidth achieved: 4579.95 GB/s
FLOPS achieved: 151.14 TF/s

Prefill latency: 0.12910825305152684 sec
Decode latency: 0.28918265807442367 sec
Time for inference 3: 0.42 sec total, 305.58 tokens/sec
Decode latency: 0.29 sec
Prefill latency: 0.13 sec
Bandwidth achieved: 4586.63 GB/s
FLOPS achieved: 151.36 TF/s

Prefill latency: 0.12886268110014498 sec
Decode latency: 0.28966950299218297 sec
Time for inference 4: 0.42 sec total, 305.40 tokens/sec
Decode latency: 0.29 sec
Prefill latency: 0.13 sec
Bandwidth achieved: 4583.94 GB/s
FLOPS achieved: 151.27 TF/s

Prefill latency: 0.12970013602171093 sec
Decode latency: 0.2894835750339553 sec
Time for inference 5: 0.42 sec total, 304.96 tokens/sec
Decode latency: 0.29 sec
Prefill latency: 0.13 sec
Bandwidth achieved: 4577.37 GB/s
FLOPS achieved: 151.05 TF/s

Prefill latency: 0.12870479898992926 sec
Decode latency: 0.2891099649714306 sec
Time for inference 6: 0.42 sec total, 305.96 tokens/sec
Decode latency: 0.29 sec
Prefill latency: 0.13 sec
Bandwidth achieved: 4592.26 GB/s
FLOPS achieved: 151.54 TF/s

Prefill latency: 0.12909847300034016 sec
Decode latency: 0.28988803701940924 sec
Time for inference 7: 0.42 sec total, 305.11 tokens/sec
Decode latency: 0.29 sec
Prefill latency: 0.13 sec
Bandwidth achieved: 4579.55 GB/s
FLOPS achieved: 151.13 TF/s

Prefill latency: 0.1300571809988469 sec
Decode latency: 0.2888286180095747 sec
Time for inference 8: 0.42 sec total, 305.20 tokens/sec
Decode latency: 0.29 sec
Prefill latency: 0.13 sec
Bandwidth achieved: 4580.89 GB/s
FLOPS achieved: 151.17 TF/s

Prefill latency: 0.13018172699958086 sec
Decode latency: 0.2894345490494743 sec
Time for inference 9: 0.42 sec total, 304.66 tokens/sec
Decode latency: 0.29 sec
Prefill latency: 0.13 sec
Bandwidth achieved: 4572.79 GB/s
FLOPS achieved: 150.90 TF/s

Prefill latency: 0.13144144299440086 sec
Decode latency: 0.2895757749211043 sec
Time for inference 10: 0.42 sec total, 303.65 tokens/sec
Decode latency: 0.29 sec
Prefill latency: 0.13 sec
Bandwidth achieved: 4557.74 GB/s
FLOPS achieved: 150.41 TF/s

==========
Batch Size: 4
Prompt Length: 1024
Generated tokens: 32
Average decode latency: 0.2894 sec
Average prefill latency: 0.1296 sec
Average tokens/sec: 305.04
Memory used: 19.83 GB
Done. we are killing the process
