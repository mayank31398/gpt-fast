flash_kv_decode is set to True
Using device=cuda
Loading model ...
GPTEnsemble(
  (tok_embeddings): Embedding(128256, 4096)
  (layers): ModuleList(
    (0-31): 32 x EnsembleTransformerBlock(
      semi_compiled = False
      (attention): Attention(
        (wqkv): Linear(in_features=4096, out_features=6144, bias=False)
        (wo): Linear(in_features=4096, out_features=4096, bias=False)
      )
      (feed_forward): FeedForward(
        (w1): Linear(in_features=4096, out_features=28672, bias=False)
        (w2): Linear(in_features=14336, out_features=4096, bias=False)
      )
      (ffn_norm): RMSNorm()
      (attention_norm): RMSNorm()
    )
  )
  (norm): RMSNorm()
  (output): Linear(in_features=4096, out_features=128256, bias=False)
)
Time to load model: 1.04 seconds
Prefill latency: 0.13219067105092108 sec
Decode latency: 0.28610999695956707 sec
Compilation time: 0.42 seconds
Prefill latency: 0.1301840009400621 sec
Decode latency: 0.28510220895987004 sec
Prefill latency: 0.1312260900158435 sec
Decode latency: 0.28533836698625237 sec
Prefill latency: 0.12958978593815118 sec
Decode latency: 0.28656770603265613 sec
Prefill latency: 0.13193233404308558 sec
Decode latency: 0.2861413609934971 sec
Prefill latency: 0.1312790079973638 sec
Decode latency: 0.2858718519564718 sec
Time for inference 1: 0.42 sec total, 306.55 tokens/sec
Decode latency: 0.29 sec
Prefill latency: 0.13 sec
Bandwidth achieved: 4601.33 GB/s
FLOPS achieved: 151.84 TF/s

Prefill latency: 0.13092034205328673 sec
Decode latency: 0.28508359601255506 sec
Time for inference 2: 0.42 sec total, 307.40 tokens/sec
Decode latency: 0.29 sec
Prefill latency: 0.13 sec
Bandwidth achieved: 4614.05 GB/s
FLOPS achieved: 152.26 TF/s

Prefill latency: 0.13248531403951347 sec
Decode latency: 0.28577627905178815 sec
Time for inference 3: 0.42 sec total, 305.73 tokens/sec
Decode latency: 0.29 sec
Prefill latency: 0.13 sec
Bandwidth achieved: 4588.97 GB/s
FLOPS achieved: 151.44 TF/s

Prefill latency: 0.13293984706979245 sec
Decode latency: 0.28528441907837987 sec
Time for inference 4: 0.42 sec total, 305.76 tokens/sec
Decode latency: 0.29 sec
Prefill latency: 0.13 sec
Bandwidth achieved: 4589.46 GB/s
FLOPS achieved: 151.45 TF/s

Prefill latency: 0.13207676995079964 sec
Decode latency: 0.2848833539756015 sec
Time for inference 5: 0.42 sec total, 306.69 tokens/sec
Decode latency: 0.28 sec
Prefill latency: 0.13 sec
Bandwidth achieved: 4603.37 GB/s
FLOPS achieved: 151.91 TF/s

Prefill latency: 0.13423849700484425 sec
Decode latency: 0.28513570001814514 sec
Time for inference 6: 0.42 sec total, 304.94 tokens/sec
Decode latency: 0.29 sec
Prefill latency: 0.13 sec
Bandwidth achieved: 4577.05 GB/s
FLOPS achieved: 151.04 TF/s

Prefill latency: 0.1318903740029782 sec
Decode latency: 0.28609311406034976 sec
Time for inference 7: 0.42 sec total, 305.94 tokens/sec
Decode latency: 0.29 sec
Prefill latency: 0.13 sec
Bandwidth achieved: 4592.18 GB/s
FLOPS achieved: 151.54 TF/s

Prefill latency: 0.13072147604543716 sec
Decode latency: 0.2861877119867131 sec
Time for inference 8: 0.42 sec total, 306.74 tokens/sec
Decode latency: 0.29 sec
Prefill latency: 0.13 sec
Bandwidth achieved: 4604.10 GB/s
FLOPS achieved: 151.94 TF/s

Prefill latency: 0.13113740109838545 sec
Decode latency: 0.28598341601900756 sec
Time for inference 9: 0.42 sec total, 306.57 tokens/sec
Decode latency: 0.29 sec
Prefill latency: 0.13 sec
Bandwidth achieved: 4601.63 GB/s
FLOPS achieved: 151.85 TF/s

Prefill latency: 0.13125237706117332 sec
Decode latency: 0.2853877489687875 sec
Time for inference 10: 0.42 sec total, 306.91 tokens/sec
Decode latency: 0.29 sec
Prefill latency: 0.13 sec
Bandwidth achieved: 4606.65 GB/s
FLOPS achieved: 152.02 TF/s

==========
Batch Size: 4
Prompt Length: 1024
Generated tokens: 32
Average decode latency: 0.2856 sec
Average prefill latency: 0.1319 sec
Average tokens/sec: 306.32
Memory used: 19.13 GB
Done. we are killing the process
