W1118 16:09:01.975000 2859656 site-packages/torch/distributed/run.py:793] 
W1118 16:09:01.975000 2859656 site-packages/torch/distributed/run.py:793] *****************************************
W1118 16:09:01.975000 2859656 site-packages/torch/distributed/run.py:793] Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
W1118 16:09:01.975000 2859656 site-packages/torch/distributed/run.py:793] *****************************************
rank: 2, global_rank: 10, world_size: 8, global_world_size: 16
rank: 4, global_rank: 12, world_size: 8, global_world_size: 16
rank: 0, global_rank: 8, world_size: 8, global_world_size: 16
rank: 7, global_rank: 15, world_size: 8, global_world_size: 16
rank: 1, global_rank: 9, world_size: 8, global_world_size: 16
rank: 6, global_rank: 14, world_size: 8, global_world_size: 16
rank: 3, global_rank: 11, world_size: 8, global_world_size: 16
rank: 5, global_rank: 13, world_size: 8, global_world_size: 16
rank: 0, global_rank: 8, world_size: 8, global_world_size: 16
rank: 0, global_rank: 8, world_size: 8, global_world_size: 16
rank: 0, global_rank: 8, world_size: 8, global_world_size: 16
rank: 0, global_rank: 8, world_size: 8, global_world_size: 16
rank: 0, global_rank: 8, world_size: 8, global_world_size: 16
rank: 4, global_rank: 12, world_size: 8, global_world_size: 16
rank: 4, global_rank: 12, world_size: 8, global_world_size: 16
rank: 4, global_rank: 12, world_size: 8, global_world_size: 16
rank: 4, global_rank: 12, world_size: 8, global_world_size: 16
rank: 4, global_rank: 12, world_size: 8, global_world_size: 16
rank: 6, global_rank: 14, world_size: 8, global_world_size: 16
rank: 6, global_rank: 14, world_size: 8, global_world_size: 16
rank: 6, global_rank: 14, world_size: 8, global_world_size: 16
rank: 6, global_rank: 14, world_size: 8, global_world_size: 16
rank: 6, global_rank: 14, world_size: 8, global_world_size: 16
rank: 7, global_rank: 15, world_size: 8, global_world_size: 16
rank: 7, global_rank: 15, world_size: 8, global_world_size: 16
rank: 7, global_rank: 15, world_size: 8, global_world_size: 16
rank: 7, global_rank: 15, world_size: 8, global_world_size: 16
rank: 7, global_rank: 15, world_size: 8, global_world_size: 16
rank: 2, global_rank: 10, world_size: 8, global_world_size: 16
rank: 1, global_rank: 9, world_size: 8, global_world_size: 16
rank: 2, global_rank: 10, world_size: 8, global_world_size: 16
rank: 2, global_rank: 10, world_size: 8, global_world_size: 16
rank: 1, global_rank: 9, world_size: 8, global_world_size: 16
rank: 1, global_rank: 9, world_size: 8, global_world_size: 16
rank: 2, global_rank: 10, world_size: 8, global_world_size: 16
rank: 1, global_rank: 9, world_size: 8, global_world_size: 16
rank: 2, global_rank: 10, world_size: 8, global_world_size: 16
rank: 1, global_rank: 9, world_size: 8, global_world_size: 16
rank: 5, global_rank: 13, world_size: 8, global_world_size: 16
rank: 5, global_rank: 13, world_size: 8, global_world_size: 16
rank: 5, global_rank: 13, world_size: 8, global_world_size: 16
rank: 5, global_rank: 13, world_size: 8, global_world_size: 16
rank: 5, global_rank: 13, world_size: 8, global_world_size: 16
rank: 3, global_rank: 11, world_size: 8, global_world_size: 16
rank: 3, global_rank: 11, world_size: 8, global_world_size: 16
rank: 3, global_rank: 11, world_size: 8, global_world_size: 16
rank: 3, global_rank: 11, world_size: 8, global_world_size: 16
rank: 3, global_rank: 11, world_size: 8, global_world_size: 16
/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/contextlib.py:103: FutureWarning: `torch.backends.cuda.sdp_kernel()` is deprecated. In the future, this context manager will be removed. Please see `torch.nn.attention.sdpa_kernel()` for the new context manager, with updated signature.
  self.gen = func(*args, **kwds)
/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/contextlib.py:103: FutureWarning: `torch.backends.cuda.sdp_kernel()` is deprecated. In the future, this context manager will be removed. Please see `torch.nn.attention.sdpa_kernel()` for the new context manager, with updated signature.
  self.gen = func(*args, **kwds)
/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/contextlib.py:103: FutureWarning: `torch.backends.cuda.sdp_kernel()` is deprecated. In the future, this context manager will be removed. Please see `torch.nn.attention.sdpa_kernel()` for the new context manager, with updated signature.
  self.gen = func(*args, **kwds)
[rank15]: Traceback (most recent call last):
[rank15]:   File "/home/charlie/skip-residual/gpt-fast/benchmark.py", line 492, in <module>
[rank15]:     main(
[rank15]:   File "/home/charlie/skip-residual/gpt-fast/benchmark.py", line 419, in main
[rank15]:     y, decode_latency, prefill_latency = generate(
[rank15]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/utils/_contextlib.py", line 116, in decorate_context
[rank15]:     return func(*args, **kwargs)
[rank15]:   File "/home/charlie/skip-residual/gpt-fast/benchmark.py", line 140, in generate
[rank15]:     next_token = prefill(model, prompt.view(batch_size, -1), input_pos, **sampling_kwargs)
[rank15]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/eval_frame.py", line 556, in _fn
[rank15]:     return fn(*args, **kwargs)
[rank15]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/convert_frame.py", line 1395, in __call__
[rank15]:     return self._torchdynamo_orig_callable(
[rank15]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/convert_frame.py", line 545, in __call__
[rank15]:     return _compile(
[rank15]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/convert_frame.py", line 977, in _compile
[rank15]:     guarded_code = compile_inner(code, one_graph, hooks, transform)
[rank15]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/convert_frame.py", line 706, in compile_inner
[rank15]:     return _compile_inner(code, one_graph, hooks, transform)
[rank15]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_utils_internal.py", line 95, in wrapper_function
[rank15]:     return function(*args, **kwargs)
[rank15]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/convert_frame.py", line 741, in _compile_inner
[rank15]:     out_code = transform_code_object(code, transform)
[rank15]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/bytecode_transformation.py", line 1348, in transform_code_object
[rank15]:     transformations(instructions, code_options)
[rank15]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/convert_frame.py", line 229, in _fn
[rank15]:     return fn(*args, **kwargs)
[rank15]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/convert_frame.py", line 658, in transform
[rank15]:     tracer.run()
[rank15]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 2912, in run
[rank15]:     super().run()
[rank15]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 1120, in run
[rank15]:     while self.step():
[rank15]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 1032, in step
[rank15]:     self.dispatch_table[inst.opcode](self, inst)
[rank15]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 640, in wrapper
[rank15]:     return inner_fn(self, inst)
[rank15]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 1816, in CALL_FUNCTION_EX
[rank15]:     self.call_function(fn, argsvars.items, kwargsvars)
[rank15]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 967, in call_function
[rank15]:     self.push(fn.call_function(self, args, kwargs))  # type: ignore[arg-type]
[rank15]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/variables/lazy.py", line 170, in realize_and_forward
[rank15]:     return getattr(self.realize(), name)(*args, **kwargs)
[rank15]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/variables/functions.py", line 349, in call_function
[rank15]:     return super().call_function(tx, args, kwargs)
[rank15]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/variables/functions.py", line 125, in call_function
[rank15]:     return tx.inline_user_function_return(self, [*self.self_args(), *args], kwargs)
[rank15]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 973, in inline_user_function_return
[rank15]:     return InliningInstructionTranslator.inline_call(self, fn, args, kwargs)
[rank15]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 3127, in inline_call
[rank15]:     return cls.inline_call_(parent, func, args, kwargs)
[rank15]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 3255, in inline_call_
[rank15]:     tracer.run()
[rank15]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 1120, in run
[rank15]:     while self.step():
[rank15]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 1032, in step
[rank15]:     self.dispatch_table[inst.opcode](self, inst)
[rank15]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 640, in wrapper
[rank15]:     return inner_fn(self, inst)
[rank15]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 1816, in CALL_FUNCTION_EX
[rank15]:     self.call_function(fn, argsvars.items, kwargsvars)
[rank15]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 967, in call_function
[rank15]:     self.push(fn.call_function(self, args, kwargs))  # type: ignore[arg-type]
[rank15]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/variables/functions.py", line 349, in call_function
[rank15]:     return super().call_function(tx, args, kwargs)
[rank15]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/variables/functions.py", line 125, in call_function
[rank15]:     return tx.inline_user_function_return(self, [*self.self_args(), *args], kwargs)
[rank15]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 973, in inline_user_function_return
[rank15]:     return InliningInstructionTranslator.inline_call(self, fn, args, kwargs)
[rank15]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 3127, in inline_call
[rank15]:     return cls.inline_call_(parent, func, args, kwargs)
[rank15]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 3255, in inline_call_
[rank15]:     tracer.run()
[rank15]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 1120, in run
[rank15]:     while self.step():
[rank15]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 1032, in step
[rank15]:     self.dispatch_table[inst.opcode](self, inst)
[rank15]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 640, in wrapper
[rank15]:     return inner_fn(self, inst)
[rank15]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 1738, in CALL_FUNCTION
[rank15]:     self.call_function(fn, args, {})
[rank15]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 967, in call_function
[rank15]:     self.push(fn.call_function(self, args, kwargs))  # type: ignore[arg-type]
[rank15]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/variables/nn_module.py", line 913, in call_function
[rank15]:     return variables.UserFunctionVariable(fn, source=source).call_function(
[rank15]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/variables/functions.py", line 349, in call_function
[rank15]:     return super().call_function(tx, args, kwargs)
[rank15]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/variables/functions.py", line 125, in call_function
[rank15]:     return tx.inline_user_function_return(self, [*self.self_args(), *args], kwargs)
[rank15]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 973, in inline_user_function_return
[rank15]:     return InliningInstructionTranslator.inline_call(self, fn, args, kwargs)
[rank15]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 3127, in inline_call
[rank15]:     return cls.inline_call_(parent, func, args, kwargs)
[rank15]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 3255, in inline_call_
[rank15]:     tracer.run()
[rank15]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 1120, in run
[rank15]:     while self.step():
[rank15]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 1032, in step
[rank15]:     self.dispatch_table[inst.opcode](self, inst)
[rank15]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 640, in wrapper
[rank15]:     return inner_fn(self, inst)
[rank15]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 1738, in CALL_FUNCTION
[rank15]:     self.call_function(fn, args, {})
[rank15]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 967, in call_function
[rank15]:     self.push(fn.call_function(self, args, kwargs))  # type: ignore[arg-type]
[rank15]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/variables/nn_module.py", line 913, in call_function
[rank15]:     return variables.UserFunctionVariable(fn, source=source).call_function(
[rank15]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/variables/functions.py", line 349, in call_function
[rank15]:     return super().call_function(tx, args, kwargs)
[rank15]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/variables/functions.py", line 125, in call_function
[rank15]:     return tx.inline_user_function_return(self, [*self.self_args(), *args], kwargs)
[rank15]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 973, in inline_user_function_return
[rank15]:     return InliningInstructionTranslator.inline_call(self, fn, args, kwargs)
[rank15]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 3127, in inline_call
[rank15]:     return cls.inline_call_(parent, func, args, kwargs)
[rank15]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 3255, in inline_call_
[rank15]:     tracer.run()
[rank15]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 1120, in run
[rank15]:     while self.step():
[rank15]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 1032, in step
[rank15]:     self.dispatch_table[inst.opcode](self, inst)
[rank15]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 1432, in SETUP_WITH
[rank15]:     self.setup_or_before_with(inst)
[rank15]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 2445, in setup_or_before_with
[rank15]:     unimplemented(f"{inst.opname} {ctx}")
[rank15]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/exc.py", line 313, in unimplemented
[rank15]:     raise Unsupported(msg, case_name=case_name)
[rank15]: torch._dynamo.exc.Unsupported: SETUP_WITH ConstantVariable(device: device(type='cuda', index=7))

[rank15]: from user code:
[rank15]:    File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/external_utils.py", line 31, in inner
[rank15]:     return fn(*args, **kwargs)
[rank15]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/utils/_contextlib.py", line 116, in decorate_context
[rank15]:     return func(*args, **kwargs)
[rank15]:   File "/home/charlie/skip-residual/gpt-fast/benchmark.py", line 82, in prefill
[rank15]:     logits = model(x, input_pos)
[rank15]:   File "/home/charlie/skip-residual/gpt-fast/gpt_fast/gpt_ladder_TP.py", line 132, in forward
[rank15]:     previous_attention_out, previous_mlp_out, x, attention_handle, mlp_handle = layer(
[rank15]:   File "/home/charlie/skip-residual/gpt-fast/gpt_fast/gpt_ladder_TP.py", line 199, in forward
[rank15]:     with torch.device(residual.device):

[rank15]: Set TORCH_LOGS="+dynamo" and TORCHDYNAMO_VERBOSE=1 for more information


[rank15]: You can suppress this exception and fall back to eager by setting:
[rank15]:     import torch._dynamo
[rank15]:     torch._dynamo.config.suppress_errors = True

[rank12]: Traceback (most recent call last):
[rank12]:   File "/home/charlie/skip-residual/gpt-fast/benchmark.py", line 492, in <module>
[rank12]:     main(
[rank12]:   File "/home/charlie/skip-residual/gpt-fast/benchmark.py", line 419, in main
[rank12]:     y, decode_latency, prefill_latency = generate(
[rank12]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/utils/_contextlib.py", line 116, in decorate_context
[rank12]:     return func(*args, **kwargs)
[rank12]:   File "/home/charlie/skip-residual/gpt-fast/benchmark.py", line 140, in generate
[rank12]:     next_token = prefill(model, prompt.view(batch_size, -1), input_pos, **sampling_kwargs)
[rank12]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/eval_frame.py", line 556, in _fn
[rank12]:     return fn(*args, **kwargs)
[rank12]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/convert_frame.py", line 1395, in __call__
[rank12]:     return self._torchdynamo_orig_callable(
[rank12]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/convert_frame.py", line 545, in __call__
[rank12]:     return _compile(
[rank12]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/convert_frame.py", line 977, in _compile
[rank12]:     guarded_code = compile_inner(code, one_graph, hooks, transform)
[rank12]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/convert_frame.py", line 706, in compile_inner
[rank12]:     return _compile_inner(code, one_graph, hooks, transform)
[rank12]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_utils_internal.py", line 95, in wrapper_function
[rank12]:     return function(*args, **kwargs)
[rank12]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/convert_frame.py", line 741, in _compile_inner
[rank12]:     out_code = transform_code_object(code, transform)
[rank12]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/bytecode_transformation.py", line 1348, in transform_code_object
[rank12]:     transformations(instructions, code_options)
[rank12]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/convert_frame.py", line 229, in _fn
[rank12]:     return fn(*args, **kwargs)
[rank12]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/convert_frame.py", line 658, in transform
[rank12]:     tracer.run()
[rank12]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 2912, in run
[rank12]:     super().run()
[rank12]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 1120, in run
[rank12]:     while self.step():
[rank12]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 1032, in step
[rank12]:     self.dispatch_table[inst.opcode](self, inst)
[rank12]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 640, in wrapper
[rank12]:     return inner_fn(self, inst)
[rank12]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 1816, in CALL_FUNCTION_EX
[rank12]:     self.call_function(fn, argsvars.items, kwargsvars)
[rank12]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 967, in call_function
[rank12]:     self.push(fn.call_function(self, args, kwargs))  # type: ignore[arg-type]
[rank12]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/variables/lazy.py", line 170, in realize_and_forward
[rank12]:     return getattr(self.realize(), name)(*args, **kwargs)
[rank12]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/variables/functions.py", line 349, in call_function
[rank12]:     return super().call_function(tx, args, kwargs)
[rank12]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/variables/functions.py", line 125, in call_function
[rank12]:     return tx.inline_user_function_return(self, [*self.self_args(), *args], kwargs)
[rank12]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 973, in inline_user_function_return
[rank12]:     return InliningInstructionTranslator.inline_call(self, fn, args, kwargs)
[rank12]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 3127, in inline_call
[rank12]:     return cls.inline_call_(parent, func, args, kwargs)
[rank12]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 3255, in inline_call_
[rank12]:     tracer.run()
[rank12]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 1120, in run
[rank12]:     while self.step():
[rank12]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 1032, in step
[rank12]:     self.dispatch_table[inst.opcode](self, inst)
[rank12]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 640, in wrapper
[rank12]:     return inner_fn(self, inst)
[rank12]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 1816, in CALL_FUNCTION_EX
[rank12]:     self.call_function(fn, argsvars.items, kwargsvars)
[rank12]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 967, in call_function
[rank12]:     self.push(fn.call_function(self, args, kwargs))  # type: ignore[arg-type]
[rank12]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/variables/functions.py", line 349, in call_function
[rank12]:     return super().call_function(tx, args, kwargs)
[rank12]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/variables/functions.py", line 125, in call_function
[rank12]:     return tx.inline_user_function_return(self, [*self.self_args(), *args], kwargs)
[rank12]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 973, in inline_user_function_return
[rank12]:     return InliningInstructionTranslator.inline_call(self, fn, args, kwargs)
[rank12]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 3127, in inline_call
[rank12]:     return cls.inline_call_(parent, func, args, kwargs)
[rank12]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 3255, in inline_call_
[rank12]:     tracer.run()
[rank12]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 1120, in run
[rank12]:     while self.step():
[rank12]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 1032, in step
[rank12]:     self.dispatch_table[inst.opcode](self, inst)
[rank12]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 640, in wrapper
[rank12]:     return inner_fn(self, inst)
[rank12]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 1738, in CALL_FUNCTION
[rank12]:     self.call_function(fn, args, {})
[rank12]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 967, in call_function
[rank12]:     self.push(fn.call_function(self, args, kwargs))  # type: ignore[arg-type]
[rank12]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/variables/nn_module.py", line 913, in call_function
[rank12]:     return variables.UserFunctionVariable(fn, source=source).call_function(
[rank12]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/variables/functions.py", line 349, in call_function
[rank12]:     return super().call_function(tx, args, kwargs)
[rank12]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/variables/functions.py", line 125, in call_function
[rank12]:     return tx.inline_user_function_return(self, [*self.self_args(), *args], kwargs)
[rank12]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 973, in inline_user_function_return
[rank12]:     return InliningInstructionTranslator.inline_call(self, fn, args, kwargs)
[rank12]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 3127, in inline_call
[rank12]:     return cls.inline_call_(parent, func, args, kwargs)
[rank12]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 3255, in inline_call_
[rank12]:     tracer.run()
[rank12]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 1120, in run
[rank12]:     while self.step():
[rank12]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 1032, in step
[rank12]:     self.dispatch_table[inst.opcode](self, inst)
[rank12]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 640, in wrapper
[rank12]:     return inner_fn(self, inst)
[rank12]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 1738, in CALL_FUNCTION
[rank12]:     self.call_function(fn, args, {})
[rank12]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 967, in call_function
[rank12]:     self.push(fn.call_function(self, args, kwargs))  # type: ignore[arg-type]
[rank12]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/variables/nn_module.py", line 913, in call_function
[rank12]:     return variables.UserFunctionVariable(fn, source=source).call_function(
[rank12]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/variables/functions.py", line 349, in call_function
[rank12]:     return super().call_function(tx, args, kwargs)
[rank12]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/variables/functions.py", line 125, in call_function
[rank12]:     return tx.inline_user_function_return(self, [*self.self_args(), *args], kwargs)
[rank12]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 973, in inline_user_function_return
[rank12]:     return InliningInstructionTranslator.inline_call(self, fn, args, kwargs)
[rank12]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 3127, in inline_call
[rank12]:     return cls.inline_call_(parent, func, args, kwargs)
[rank12]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 3255, in inline_call_
[rank12]:     tracer.run()
[rank12]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 1120, in run
[rank12]:     while self.step():
[rank12]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 1032, in step
[rank12]:     self.dispatch_table[inst.opcode](self, inst)
[rank12]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 1432, in SETUP_WITH
[rank12]:     self.setup_or_before_with(inst)
[rank12]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 2445, in setup_or_before_with
[rank12]:     unimplemented(f"{inst.opname} {ctx}")
[rank12]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/exc.py", line 313, in unimplemented
[rank12]:     raise Unsupported(msg, case_name=case_name)
[rank12]: torch._dynamo.exc.Unsupported: SETUP_WITH ConstantVariable(device: device(type='cuda', index=4))

[rank12]: from user code:
[rank12]:    File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/external_utils.py", line 31, in inner
[rank12]:     return fn(*args, **kwargs)
[rank12]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/utils/_contextlib.py", line 116, in decorate_context
[rank12]:     return func(*args, **kwargs)
[rank12]:   File "/home/charlie/skip-residual/gpt-fast/benchmark.py", line 82, in prefill
[rank12]:     logits = model(x, input_pos)
[rank12]:   File "/home/charlie/skip-residual/gpt-fast/gpt_fast/gpt_ladder_TP.py", line 132, in forward
[rank12]:     previous_attention_out, previous_mlp_out, x, attention_handle, mlp_handle = layer(
[rank12]:   File "/home/charlie/skip-residual/gpt-fast/gpt_fast/gpt_ladder_TP.py", line 199, in forward
[rank12]:     with torch.device(residual.device):

[rank12]: Set TORCH_LOGS="+dynamo" and TORCHDYNAMO_VERBOSE=1 for more information


[rank12]: You can suppress this exception and fall back to eager by setting:
[rank12]:     import torch._dynamo
[rank12]:     torch._dynamo.config.suppress_errors = True

/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/contextlib.py:103: FutureWarning: `torch.backends.cuda.sdp_kernel()` is deprecated. In the future, this context manager will be removed. Please see `torch.nn.attention.sdpa_kernel()` for the new context manager, with updated signature.
  self.gen = func(*args, **kwds)
[rank14]: Traceback (most recent call last):
[rank14]:   File "/home/charlie/skip-residual/gpt-fast/benchmark.py", line 492, in <module>
[rank14]:     main(
[rank14]:   File "/home/charlie/skip-residual/gpt-fast/benchmark.py", line 419, in main
[rank14]:     y, decode_latency, prefill_latency = generate(
[rank14]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/utils/_contextlib.py", line 116, in decorate_context
[rank14]:     return func(*args, **kwargs)
[rank14]:   File "/home/charlie/skip-residual/gpt-fast/benchmark.py", line 140, in generate
[rank14]:     next_token = prefill(model, prompt.view(batch_size, -1), input_pos, **sampling_kwargs)
[rank14]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/eval_frame.py", line 556, in _fn
[rank14]:     return fn(*args, **kwargs)
[rank14]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/convert_frame.py", line 1395, in __call__
[rank14]:     return self._torchdynamo_orig_callable(
[rank14]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/convert_frame.py", line 545, in __call__
[rank14]:     return _compile(
[rank14]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/convert_frame.py", line 977, in _compile
[rank14]:     guarded_code = compile_inner(code, one_graph, hooks, transform)
[rank14]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/convert_frame.py", line 706, in compile_inner
[rank14]:     return _compile_inner(code, one_graph, hooks, transform)
[rank14]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_utils_internal.py", line 95, in wrapper_function
[rank14]:     return function(*args, **kwargs)
[rank14]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/convert_frame.py", line 741, in _compile_inner
[rank14]:     out_code = transform_code_object(code, transform)
[rank14]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/bytecode_transformation.py", line 1348, in transform_code_object
[rank14]:     transformations(instructions, code_options)
[rank14]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/convert_frame.py", line 229, in _fn
[rank14]:     return fn(*args, **kwargs)
[rank14]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/convert_frame.py", line 658, in transform
[rank14]:     tracer.run()
[rank14]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 2912, in run
[rank14]:     super().run()
[rank14]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 1120, in run
[rank14]:     while self.step():
[rank14]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 1032, in step
[rank14]:     self.dispatch_table[inst.opcode](self, inst)
[rank14]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 640, in wrapper
[rank14]:     return inner_fn(self, inst)
[rank14]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 1816, in CALL_FUNCTION_EX
[rank14]:     self.call_function(fn, argsvars.items, kwargsvars)
[rank14]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 967, in call_function
[rank14]:     self.push(fn.call_function(self, args, kwargs))  # type: ignore[arg-type]
[rank14]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/variables/lazy.py", line 170, in realize_and_forward
[rank14]:     return getattr(self.realize(), name)(*args, **kwargs)
[rank14]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/variables/functions.py", line 349, in call_function
[rank14]:     return super().call_function(tx, args, kwargs)
[rank14]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/variables/functions.py", line 125, in call_function
[rank14]:     return tx.inline_user_function_return(self, [*self.self_args(), *args], kwargs)
[rank14]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 973, in inline_user_function_return
[rank14]:     return InliningInstructionTranslator.inline_call(self, fn, args, kwargs)
[rank14]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 3127, in inline_call
[rank14]:     return cls.inline_call_(parent, func, args, kwargs)
[rank14]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 3255, in inline_call_
[rank14]:     tracer.run()
[rank14]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 1120, in run
[rank14]:     while self.step():
[rank14]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 1032, in step
[rank14]:     self.dispatch_table[inst.opcode](self, inst)
[rank14]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 640, in wrapper
[rank14]:     return inner_fn(self, inst)
[rank14]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 1816, in CALL_FUNCTION_EX
[rank14]:     self.call_function(fn, argsvars.items, kwargsvars)
[rank14]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 967, in call_function
[rank14]:     self.push(fn.call_function(self, args, kwargs))  # type: ignore[arg-type]
[rank14]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/variables/functions.py", line 349, in call_function
[rank14]:     return super().call_function(tx, args, kwargs)
[rank14]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/variables/functions.py", line 125, in call_function
[rank14]:     return tx.inline_user_function_return(self, [*self.self_args(), *args], kwargs)
[rank14]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 973, in inline_user_function_return
[rank14]:     return InliningInstructionTranslator.inline_call(self, fn, args, kwargs)
[rank14]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 3127, in inline_call
[rank14]:     return cls.inline_call_(parent, func, args, kwargs)
[rank14]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 3255, in inline_call_
[rank14]:     tracer.run()
[rank14]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 1120, in run
[rank14]:     while self.step():
[rank14]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 1032, in step
[rank14]:     self.dispatch_table[inst.opcode](self, inst)
[rank14]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 640, in wrapper
[rank14]:     return inner_fn(self, inst)
[rank14]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 1738, in CALL_FUNCTION
[rank14]:     self.call_function(fn, args, {})
[rank14]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 967, in call_function
[rank14]:     self.push(fn.call_function(self, args, kwargs))  # type: ignore[arg-type]
[rank14]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/variables/nn_module.py", line 913, in call_function
[rank14]:     return variables.UserFunctionVariable(fn, source=source).call_function(
[rank14]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/variables/functions.py", line 349, in call_function
[rank14]:     return super().call_function(tx, args, kwargs)
[rank14]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/variables/functions.py", line 125, in call_function
[rank14]:     return tx.inline_user_function_return(self, [*self.self_args(), *args], kwargs)
[rank14]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 973, in inline_user_function_return
[rank14]:     return InliningInstructionTranslator.inline_call(self, fn, args, kwargs)
[rank14]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 3127, in inline_call
[rank14]:     return cls.inline_call_(parent, func, args, kwargs)
[rank14]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 3255, in inline_call_
[rank14]:     tracer.run()
[rank14]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 1120, in run
[rank14]:     while self.step():
[rank14]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 1032, in step
[rank14]:     self.dispatch_table[inst.opcode](self, inst)
[rank14]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 640, in wrapper
[rank14]:     return inner_fn(self, inst)
[rank14]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 1738, in CALL_FUNCTION
[rank14]:     self.call_function(fn, args, {})
[rank14]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 967, in call_function
[rank14]:     self.push(fn.call_function(self, args, kwargs))  # type: ignore[arg-type]
[rank14]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/variables/nn_module.py", line 913, in call_function
[rank14]:     return variables.UserFunctionVariable(fn, source=source).call_function(
[rank14]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/variables/functions.py", line 349, in call_function
[rank14]:     return super().call_function(tx, args, kwargs)
[rank14]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/variables/functions.py", line 125, in call_function
[rank14]:     return tx.inline_user_function_return(self, [*self.self_args(), *args], kwargs)
[rank14]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 973, in inline_user_function_return
[rank14]:     return InliningInstructionTranslator.inline_call(self, fn, args, kwargs)
[rank14]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 3127, in inline_call
[rank14]:     return cls.inline_call_(parent, func, args, kwargs)
[rank14]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 3255, in inline_call_
[rank14]:     tracer.run()
[rank14]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 1120, in run
[rank14]:     while self.step():
[rank14]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 1032, in step
[rank14]:     self.dispatch_table[inst.opcode](self, inst)
[rank14]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 1432, in SETUP_WITH
[rank14]:     self.setup_or_before_with(inst)
[rank14]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 2445, in setup_or_before_with
[rank14]:     unimplemented(f"{inst.opname} {ctx}")
[rank14]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/exc.py", line 313, in unimplemented
[rank14]:     raise Unsupported(msg, case_name=case_name)
[rank14]: torch._dynamo.exc.Unsupported: SETUP_WITH ConstantVariable(device: device(type='cuda', index=6))

[rank14]: from user code:
[rank14]:    File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/external_utils.py", line 31, in inner
[rank14]:     return fn(*args, **kwargs)
[rank14]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/utils/_contextlib.py", line 116, in decorate_context
[rank14]:     return func(*args, **kwargs)
[rank14]:   File "/home/charlie/skip-residual/gpt-fast/benchmark.py", line 82, in prefill
[rank14]:     logits = model(x, input_pos)
[rank14]:   File "/home/charlie/skip-residual/gpt-fast/gpt_fast/gpt_ladder_TP.py", line 132, in forward
[rank14]:     previous_attention_out, previous_mlp_out, x, attention_handle, mlp_handle = layer(
[rank14]:   File "/home/charlie/skip-residual/gpt-fast/gpt_fast/gpt_ladder_TP.py", line 199, in forward
[rank14]:     with torch.device(residual.device):

[rank14]: Set TORCH_LOGS="+dynamo" and TORCHDYNAMO_VERBOSE=1 for more information


[rank14]: You can suppress this exception and fall back to eager by setting:
[rank14]:     import torch._dynamo
[rank14]:     torch._dynamo.config.suppress_errors = True

/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/contextlib.py:103: FutureWarning: `torch.backends.cuda.sdp_kernel()` is deprecated. In the future, this context manager will be removed. Please see `torch.nn.attention.sdpa_kernel()` for the new context manager, with updated signature.
  self.gen = func(*args, **kwds)
/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/contextlib.py:103: FutureWarning: `torch.backends.cuda.sdp_kernel()` is deprecated. In the future, this context manager will be removed. Please see `torch.nn.attention.sdpa_kernel()` for the new context manager, with updated signature.
  self.gen = func(*args, **kwds)
/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/contextlib.py:103: FutureWarning: `torch.backends.cuda.sdp_kernel()` is deprecated. In the future, this context manager will be removed. Please see `torch.nn.attention.sdpa_kernel()` for the new context manager, with updated signature.
  self.gen = func(*args, **kwds)
/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/contextlib.py:103: FutureWarning: `torch.backends.cuda.sdp_kernel()` is deprecated. In the future, this context manager will be removed. Please see `torch.nn.attention.sdpa_kernel()` for the new context manager, with updated signature.
  self.gen = func(*args, **kwds)
[rank11]: Traceback (most recent call last):
[rank11]:   File "/home/charlie/skip-residual/gpt-fast/benchmark.py", line 492, in <module>
[rank11]:     main(
[rank11]:   File "/home/charlie/skip-residual/gpt-fast/benchmark.py", line 419, in main
[rank11]:     y, decode_latency, prefill_latency = generate(
[rank11]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/utils/_contextlib.py", line 116, in decorate_context
[rank11]:     return func(*args, **kwargs)
[rank11]:   File "/home/charlie/skip-residual/gpt-fast/benchmark.py", line 140, in generate
[rank11]:     next_token = prefill(model, prompt.view(batch_size, -1), input_pos, **sampling_kwargs)
[rank11]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/eval_frame.py", line 556, in _fn
[rank11]:     return fn(*args, **kwargs)
[rank11]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/convert_frame.py", line 1395, in __call__
[rank11]:     return self._torchdynamo_orig_callable(
[rank11]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/convert_frame.py", line 545, in __call__
[rank11]:     return _compile(
[rank11]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/convert_frame.py", line 977, in _compile
[rank11]:     guarded_code = compile_inner(code, one_graph, hooks, transform)
[rank11]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/convert_frame.py", line 706, in compile_inner
[rank11]:     return _compile_inner(code, one_graph, hooks, transform)
[rank11]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_utils_internal.py", line 95, in wrapper_function
[rank11]:     return function(*args, **kwargs)
[rank11]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/convert_frame.py", line 741, in _compile_inner
[rank11]:     out_code = transform_code_object(code, transform)
[rank11]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/bytecode_transformation.py", line 1348, in transform_code_object
[rank11]:     transformations(instructions, code_options)
[rank11]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/convert_frame.py", line 229, in _fn
[rank11]:     return fn(*args, **kwargs)
[rank11]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/convert_frame.py", line 658, in transform
[rank11]:     tracer.run()
[rank11]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 2912, in run
[rank11]:     super().run()
[rank11]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 1120, in run
[rank11]:     while self.step():
[rank11]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 1032, in step
[rank11]:     self.dispatch_table[inst.opcode](self, inst)
[rank11]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 640, in wrapper
[rank11]:     return inner_fn(self, inst)
[rank11]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 1816, in CALL_FUNCTION_EX
[rank11]:     self.call_function(fn, argsvars.items, kwargsvars)
[rank11]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 967, in call_function
[rank11]:     self.push(fn.call_function(self, args, kwargs))  # type: ignore[arg-type]
[rank11]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/variables/lazy.py", line 170, in realize_and_forward
[rank11]:     return getattr(self.realize(), name)(*args, **kwargs)
[rank11]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/variables/functions.py", line 349, in call_function
[rank11]:     return super().call_function(tx, args, kwargs)
[rank11]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/variables/functions.py", line 125, in call_function
[rank11]:     return tx.inline_user_function_return(self, [*self.self_args(), *args], kwargs)
[rank11]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 973, in inline_user_function_return
[rank11]:     return InliningInstructionTranslator.inline_call(self, fn, args, kwargs)
[rank11]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 3127, in inline_call
[rank11]:     return cls.inline_call_(parent, func, args, kwargs)
[rank11]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 3255, in inline_call_
[rank11]:     tracer.run()
[rank11]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 1120, in run
[rank11]:     while self.step():
[rank11]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 1032, in step
[rank11]:     self.dispatch_table[inst.opcode](self, inst)
[rank11]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 640, in wrapper
[rank11]:     return inner_fn(self, inst)
[rank11]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 1816, in CALL_FUNCTION_EX
[rank11]:     self.call_function(fn, argsvars.items, kwargsvars)
[rank11]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 967, in call_function
[rank11]:     self.push(fn.call_function(self, args, kwargs))  # type: ignore[arg-type]
[rank11]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/variables/functions.py", line 349, in call_function
[rank11]:     return super().call_function(tx, args, kwargs)
[rank11]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/variables/functions.py", line 125, in call_function
[rank11]:     return tx.inline_user_function_return(self, [*self.self_args(), *args], kwargs)
[rank11]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 973, in inline_user_function_return
[rank11]:     return InliningInstructionTranslator.inline_call(self, fn, args, kwargs)
[rank11]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 3127, in inline_call
[rank11]:     return cls.inline_call_(parent, func, args, kwargs)
[rank11]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 3255, in inline_call_
[rank11]:     tracer.run()
[rank11]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 1120, in run
[rank11]:     while self.step():
[rank11]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 1032, in step
[rank11]:     self.dispatch_table[inst.opcode](self, inst)
[rank11]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 640, in wrapper
[rank11]:     return inner_fn(self, inst)
[rank11]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 1738, in CALL_FUNCTION
[rank11]:     self.call_function(fn, args, {})
[rank11]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 967, in call_function
[rank11]:     self.push(fn.call_function(self, args, kwargs))  # type: ignore[arg-type]
[rank11]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/variables/nn_module.py", line 913, in call_function
[rank11]:     return variables.UserFunctionVariable(fn, source=source).call_function(
[rank11]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/variables/functions.py", line 349, in call_function
[rank11]:     return super().call_function(tx, args, kwargs)
[rank11]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/variables/functions.py", line 125, in call_function
[rank11]:     return tx.inline_user_function_return(self, [*self.self_args(), *args], kwargs)
[rank11]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 973, in inline_user_function_return
[rank11]:     return InliningInstructionTranslator.inline_call(self, fn, args, kwargs)
[rank11]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 3127, in inline_call
[rank11]:     return cls.inline_call_(parent, func, args, kwargs)
[rank11]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 3255, in inline_call_
[rank11]:     tracer.run()
[rank11]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 1120, in run
[rank11]:     while self.step():
[rank11]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 1032, in step
[rank11]:     self.dispatch_table[inst.opcode](self, inst)
[rank11]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 640, in wrapper
[rank11]:     return inner_fn(self, inst)
[rank11]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 1738, in CALL_FUNCTION
[rank11]:     self.call_function(fn, args, {})
[rank11]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 967, in call_function
[rank11]:     self.push(fn.call_function(self, args, kwargs))  # type: ignore[arg-type]
[rank11]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/variables/nn_module.py", line 913, in call_function
[rank11]:     return variables.UserFunctionVariable(fn, source=source).call_function(
[rank11]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/variables/functions.py", line 349, in call_function
[rank11]:     return super().call_function(tx, args, kwargs)
[rank11]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/variables/functions.py", line 125, in call_function
[rank11]:     return tx.inline_user_function_return(self, [*self.self_args(), *args], kwargs)
[rank11]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 973, in inline_user_function_return
[rank11]:     return InliningInstructionTranslator.inline_call(self, fn, args, kwargs)
[rank11]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 3127, in inline_call
[rank11]:     return cls.inline_call_(parent, func, args, kwargs)
[rank11]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 3255, in inline_call_
[rank11]:     tracer.run()
[rank11]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 1120, in run
[rank11]:     while self.step():
[rank11]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 1032, in step
[rank11]:     self.dispatch_table[inst.opcode](self, inst)
[rank11]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 1432, in SETUP_WITH
[rank11]:     self.setup_or_before_with(inst)
[rank11]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 2445, in setup_or_before_with
[rank11]:     unimplemented(f"{inst.opname} {ctx}")
[rank11]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/exc.py", line 313, in unimplemented
[rank11]:     raise Unsupported(msg, case_name=case_name)
[rank11]: torch._dynamo.exc.Unsupported: SETUP_WITH ConstantVariable(device: device(type='cuda', index=3))

[rank11]: from user code:
[rank11]:    File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/external_utils.py", line 31, in inner
[rank11]:     return fn(*args, **kwargs)
[rank11]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/utils/_contextlib.py", line 116, in decorate_context
[rank11]:     return func(*args, **kwargs)
[rank11]:   File "/home/charlie/skip-residual/gpt-fast/benchmark.py", line 82, in prefill
[rank11]:     logits = model(x, input_pos)
[rank11]:   File "/home/charlie/skip-residual/gpt-fast/gpt_fast/gpt_ladder_TP.py", line 132, in forward
[rank11]:     previous_attention_out, previous_mlp_out, x, attention_handle, mlp_handle = layer(
[rank11]:   File "/home/charlie/skip-residual/gpt-fast/gpt_fast/gpt_ladder_TP.py", line 199, in forward
[rank11]:     with torch.device(residual.device):

[rank11]: Set TORCH_LOGS="+dynamo" and TORCHDYNAMO_VERBOSE=1 for more information


[rank11]: You can suppress this exception and fall back to eager by setting:
[rank11]:     import torch._dynamo
[rank11]:     torch._dynamo.config.suppress_errors = True

[rank8]: Traceback (most recent call last):
[rank8]:   File "/home/charlie/skip-residual/gpt-fast/benchmark.py", line 492, in <module>
[rank8]:     main(
[rank8]:   File "/home/charlie/skip-residual/gpt-fast/benchmark.py", line 419, in main
[rank8]:     y, decode_latency, prefill_latency = generate(
[rank8]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/utils/_contextlib.py", line 116, in decorate_context
[rank8]:     return func(*args, **kwargs)
[rank8]:   File "/home/charlie/skip-residual/gpt-fast/benchmark.py", line 140, in generate
[rank8]:     next_token = prefill(model, prompt.view(batch_size, -1), input_pos, **sampling_kwargs)
[rank8]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/eval_frame.py", line 556, in _fn
[rank8]:     return fn(*args, **kwargs)
[rank8]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/convert_frame.py", line 1395, in __call__
[rank8]:     return self._torchdynamo_orig_callable(
[rank8]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/convert_frame.py", line 545, in __call__
[rank8]:     return _compile(
[rank8]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/convert_frame.py", line 977, in _compile
[rank8]:     guarded_code = compile_inner(code, one_graph, hooks, transform)
[rank8]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/convert_frame.py", line 706, in compile_inner
[rank8]:     return _compile_inner(code, one_graph, hooks, transform)
[rank8]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_utils_internal.py", line 95, in wrapper_function
[rank8]:     return function(*args, **kwargs)
[rank8]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/convert_frame.py", line 741, in _compile_inner
[rank8]:     out_code = transform_code_object(code, transform)
[rank8]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/bytecode_transformation.py", line 1348, in transform_code_object
[rank8]:     transformations(instructions, code_options)
[rank8]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/convert_frame.py", line 229, in _fn
[rank8]:     return fn(*args, **kwargs)
[rank8]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/convert_frame.py", line 658, in transform
[rank8]:     tracer.run()
[rank8]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 2912, in run
[rank8]:     super().run()
[rank8]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 1120, in run
[rank8]:     while self.step():
[rank8]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 1032, in step
[rank8]:     self.dispatch_table[inst.opcode](self, inst)
[rank8]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 640, in wrapper
[rank8]:     return inner_fn(self, inst)
[rank8]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 1816, in CALL_FUNCTION_EX
[rank8]:     self.call_function(fn, argsvars.items, kwargsvars)
[rank8]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 967, in call_function
[rank8]:     self.push(fn.call_function(self, args, kwargs))  # type: ignore[arg-type]
[rank8]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/variables/lazy.py", line 170, in realize_and_forward
[rank8]:     return getattr(self.realize(), name)(*args, **kwargs)
[rank8]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/variables/functions.py", line 349, in call_function
[rank8]:     return super().call_function(tx, args, kwargs)
[rank8]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/variables/functions.py", line 125, in call_function
[rank8]:     return tx.inline_user_function_return(self, [*self.self_args(), *args], kwargs)
[rank8]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 973, in inline_user_function_return
[rank8]:     return InliningInstructionTranslator.inline_call(self, fn, args, kwargs)
[rank8]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 3127, in inline_call
[rank8]:     return cls.inline_call_(parent, func, args, kwargs)
[rank8]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 3255, in inline_call_
[rank8]:     tracer.run()
[rank8]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 1120, in run
[rank8]:     while self.step():
[rank8]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 1032, in step
[rank8]:     self.dispatch_table[inst.opcode](self, inst)
[rank8]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 640, in wrapper
[rank8]:     return inner_fn(self, inst)
[rank8]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 1816, in CALL_FUNCTION_EX
[rank8]:     self.call_function(fn, argsvars.items, kwargsvars)
[rank8]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 967, in call_function
[rank8]:     self.push(fn.call_function(self, args, kwargs))  # type: ignore[arg-type]
[rank8]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/variables/functions.py", line 349, in call_function
[rank8]:     return super().call_function(tx, args, kwargs)
[rank8]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/variables/functions.py", line 125, in call_function
[rank8]:     return tx.inline_user_function_return(self, [*self.self_args(), *args], kwargs)
[rank8]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 973, in inline_user_function_return
[rank8]:     return InliningInstructionTranslator.inline_call(self, fn, args, kwargs)
[rank8]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 3127, in inline_call
[rank8]:     return cls.inline_call_(parent, func, args, kwargs)
[rank8]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 3255, in inline_call_
[rank8]:     tracer.run()
[rank8]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 1120, in run
[rank8]:     while self.step():
[rank8]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 1032, in step
[rank8]:     self.dispatch_table[inst.opcode](self, inst)
[rank8]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 640, in wrapper
[rank8]:     return inner_fn(self, inst)
[rank8]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 1738, in CALL_FUNCTION
[rank8]:     self.call_function(fn, args, {})
[rank8]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 967, in call_function
[rank8]:     self.push(fn.call_function(self, args, kwargs))  # type: ignore[arg-type]
[rank8]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/variables/nn_module.py", line 913, in call_function
[rank8]:     return variables.UserFunctionVariable(fn, source=source).call_function(
[rank8]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/variables/functions.py", line 349, in call_function
[rank8]:     return super().call_function(tx, args, kwargs)
[rank8]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/variables/functions.py", line 125, in call_function
[rank8]:     return tx.inline_user_function_return(self, [*self.self_args(), *args], kwargs)
[rank8]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 973, in inline_user_function_return
[rank8]:     return InliningInstructionTranslator.inline_call(self, fn, args, kwargs)
[rank8]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 3127, in inline_call
[rank8]:     return cls.inline_call_(parent, func, args, kwargs)
[rank8]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 3255, in inline_call_
[rank8]:     tracer.run()
[rank8]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 1120, in run
[rank8]:     while self.step():
[rank8]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 1032, in step
[rank8]:     self.dispatch_table[inst.opcode](self, inst)
[rank8]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 640, in wrapper
[rank8]:     return inner_fn(self, inst)
[rank8]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 1738, in CALL_FUNCTION
[rank8]:     self.call_function(fn, args, {})
[rank8]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 967, in call_function
[rank8]:     self.push(fn.call_function(self, args, kwargs))  # type: ignore[arg-type]
[rank8]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/variables/nn_module.py", line 913, in call_function
[rank8]:     return variables.UserFunctionVariable(fn, source=source).call_function(
[rank8]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/variables/functions.py", line 349, in call_function
[rank8]:     return super().call_function(tx, args, kwargs)
[rank8]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/variables/functions.py", line 125, in call_function
[rank8]:     return tx.inline_user_function_return(self, [*self.self_args(), *args], kwargs)
[rank8]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 973, in inline_user_function_return
[rank8]:     return InliningInstructionTranslator.inline_call(self, fn, args, kwargs)
[rank8]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 3127, in inline_call
[rank8]:     return cls.inline_call_(parent, func, args, kwargs)
[rank8]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 3255, in inline_call_
[rank8]:     tracer.run()
[rank8]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 1120, in run
[rank8]:     while self.step():
[rank8]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 1032, in step
[rank8]:     self.dispatch_table[inst.opcode](self, inst)
[rank8]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 1432, in SETUP_WITH
[rank8]:     self.setup_or_before_with(inst)
[rank8]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 2445, in setup_or_before_with
[rank8]:     unimplemented(f"{inst.opname} {ctx}")
[rank8]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/exc.py", line 313, in unimplemented
[rank8]:     raise Unsupported(msg, case_name=case_name)
[rank8]: torch._dynamo.exc.Unsupported: SETUP_WITH ConstantVariable(device: device(type='cuda', index=0))

[rank8]: from user code:
[rank8]:    File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/external_utils.py", line 31, in inner
[rank8]:     return fn(*args, **kwargs)
[rank8]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/utils/_contextlib.py", line 116, in decorate_context
[rank8]:     return func(*args, **kwargs)
[rank8]:   File "/home/charlie/skip-residual/gpt-fast/benchmark.py", line 82, in prefill
[rank8]:     logits = model(x, input_pos)
[rank8]:   File "/home/charlie/skip-residual/gpt-fast/gpt_fast/gpt_ladder_TP.py", line 132, in forward
[rank8]:     previous_attention_out, previous_mlp_out, x, attention_handle, mlp_handle = layer(
[rank8]:   File "/home/charlie/skip-residual/gpt-fast/gpt_fast/gpt_ladder_TP.py", line 199, in forward
[rank8]:     with torch.device(residual.device):

[rank8]: Set TORCH_LOGS="+dynamo" and TORCHDYNAMO_VERBOSE=1 for more information


[rank8]: You can suppress this exception and fall back to eager by setting:
[rank8]:     import torch._dynamo
[rank8]:     torch._dynamo.config.suppress_errors = True

[rank10]: Traceback (most recent call last):
[rank10]:   File "/home/charlie/skip-residual/gpt-fast/benchmark.py", line 492, in <module>
[rank10]:     main(
[rank10]:   File "/home/charlie/skip-residual/gpt-fast/benchmark.py", line 419, in main
[rank10]:     y, decode_latency, prefill_latency = generate(
[rank10]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/utils/_contextlib.py", line 116, in decorate_context
[rank10]:     return func(*args, **kwargs)
[rank10]:   File "/home/charlie/skip-residual/gpt-fast/benchmark.py", line 140, in generate
[rank10]:     next_token = prefill(model, prompt.view(batch_size, -1), input_pos, **sampling_kwargs)
[rank10]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/eval_frame.py", line 556, in _fn
[rank10]:     return fn(*args, **kwargs)
[rank10]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/convert_frame.py", line 1395, in __call__
[rank10]:     return self._torchdynamo_orig_callable(
[rank10]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/convert_frame.py", line 545, in __call__
[rank10]:     return _compile(
[rank10]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/convert_frame.py", line 977, in _compile
[rank10]:     guarded_code = compile_inner(code, one_graph, hooks, transform)
[rank10]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/convert_frame.py", line 706, in compile_inner
[rank10]:     return _compile_inner(code, one_graph, hooks, transform)
[rank10]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_utils_internal.py", line 95, in wrapper_function
[rank10]:     return function(*args, **kwargs)
[rank10]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/convert_frame.py", line 741, in _compile_inner
[rank10]:     out_code = transform_code_object(code, transform)
[rank10]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/bytecode_transformation.py", line 1348, in transform_code_object
[rank10]:     transformations(instructions, code_options)
[rank10]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/convert_frame.py", line 229, in _fn
[rank10]:     return fn(*args, **kwargs)
[rank10]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/convert_frame.py", line 658, in transform
[rank10]:     tracer.run()
[rank10]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 2912, in run
[rank10]:     super().run()
[rank10]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 1120, in run
[rank10]:     while self.step():
[rank10]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 1032, in step
[rank10]:     self.dispatch_table[inst.opcode](self, inst)
[rank10]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 640, in wrapper
[rank10]:     return inner_fn(self, inst)
[rank10]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 1816, in CALL_FUNCTION_EX
[rank10]:     self.call_function(fn, argsvars.items, kwargsvars)
[rank10]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 967, in call_function
[rank10]:     self.push(fn.call_function(self, args, kwargs))  # type: ignore[arg-type]
[rank10]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/variables/lazy.py", line 170, in realize_and_forward
[rank10]:     return getattr(self.realize(), name)(*args, **kwargs)
[rank10]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/variables/functions.py", line 349, in call_function
[rank10]:     return super().call_function(tx, args, kwargs)
[rank10]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/variables/functions.py", line 125, in call_function
[rank10]:     return tx.inline_user_function_return(self, [*self.self_args(), *args], kwargs)
[rank10]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 973, in inline_user_function_return
[rank10]:     return InliningInstructionTranslator.inline_call(self, fn, args, kwargs)
[rank10]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 3127, in inline_call
[rank10]:     return cls.inline_call_(parent, func, args, kwargs)
[rank10]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 3255, in inline_call_
[rank10]:     tracer.run()
[rank10]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 1120, in run
[rank10]:     while self.step():
[rank10]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 1032, in step
[rank10]:     self.dispatch_table[inst.opcode](self, inst)
[rank10]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 640, in wrapper
[rank10]:     return inner_fn(self, inst)
[rank10]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 1816, in CALL_FUNCTION_EX
[rank10]:     self.call_function(fn, argsvars.items, kwargsvars)
[rank10]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 967, in call_function
[rank10]:     self.push(fn.call_function(self, args, kwargs))  # type: ignore[arg-type]
[rank10]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/variables/functions.py", line 349, in call_function
[rank10]:     return super().call_function(tx, args, kwargs)
[rank10]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/variables/functions.py", line 125, in call_function
[rank10]:     return tx.inline_user_function_return(self, [*self.self_args(), *args], kwargs)
[rank10]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 973, in inline_user_function_return
[rank10]:     return InliningInstructionTranslator.inline_call(self, fn, args, kwargs)
[rank10]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 3127, in inline_call
[rank10]:     return cls.inline_call_(parent, func, args, kwargs)
[rank10]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 3255, in inline_call_
[rank10]:     tracer.run()
[rank10]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 1120, in run
[rank10]:     while self.step():
[rank10]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 1032, in step
[rank10]:     self.dispatch_table[inst.opcode](self, inst)
[rank10]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 640, in wrapper
[rank10]:     return inner_fn(self, inst)
[rank10]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 1738, in CALL_FUNCTION
[rank10]:     self.call_function(fn, args, {})
[rank10]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 967, in call_function
[rank10]:     self.push(fn.call_function(self, args, kwargs))  # type: ignore[arg-type]
[rank10]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/variables/nn_module.py", line 913, in call_function
[rank10]:     return variables.UserFunctionVariable(fn, source=source).call_function(
[rank10]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/variables/functions.py", line 349, in call_function
[rank10]:     return super().call_function(tx, args, kwargs)
[rank10]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/variables/functions.py", line 125, in call_function
[rank10]:     return tx.inline_user_function_return(self, [*self.self_args(), *args], kwargs)
[rank10]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 973, in inline_user_function_return
[rank10]:     return InliningInstructionTranslator.inline_call(self, fn, args, kwargs)
[rank10]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 3127, in inline_call
[rank10]:     return cls.inline_call_(parent, func, args, kwargs)
[rank10]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 3255, in inline_call_
[rank10]:     tracer.run()
[rank10]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 1120, in run
[rank10]:     while self.step():
[rank10]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 1032, in step
[rank10]:     self.dispatch_table[inst.opcode](self, inst)
[rank10]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 640, in wrapper
[rank10]:     return inner_fn(self, inst)
[rank10]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 1738, in CALL_FUNCTION
[rank10]:     self.call_function(fn, args, {})
[rank10]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 967, in call_function
[rank10]:     self.push(fn.call_function(self, args, kwargs))  # type: ignore[arg-type]
[rank10]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/variables/nn_module.py", line 913, in call_function
[rank10]:     return variables.UserFunctionVariable(fn, source=source).call_function(
[rank10]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/variables/functions.py", line 349, in call_function
[rank10]:     return super().call_function(tx, args, kwargs)
[rank10]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/variables/functions.py", line 125, in call_function
[rank10]:     return tx.inline_user_function_return(self, [*self.self_args(), *args], kwargs)
[rank10]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 973, in inline_user_function_return
[rank10]:     return InliningInstructionTranslator.inline_call(self, fn, args, kwargs)
[rank10]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 3127, in inline_call
[rank10]:     return cls.inline_call_(parent, func, args, kwargs)
[rank10]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 3255, in inline_call_
[rank10]:     tracer.run()
[rank10]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 1120, in run
[rank10]:     while self.step():
[rank10]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 1032, in step
[rank10]:     self.dispatch_table[inst.opcode](self, inst)
[rank10]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 1432, in SETUP_WITH
[rank10]:     self.setup_or_before_with(inst)
[rank10]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 2445, in setup_or_before_with
[rank10]:     unimplemented(f"{inst.opname} {ctx}")
[rank10]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/exc.py", line 313, in unimplemented
[rank10]:     raise Unsupported(msg, case_name=case_name)
[rank10]: torch._dynamo.exc.Unsupported: SETUP_WITH ConstantVariable(device: device(type='cuda', index=2))

[rank10]: from user code:
[rank10]:    File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/external_utils.py", line 31, in inner
[rank10]:     return fn(*args, **kwargs)
[rank10]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/utils/_contextlib.py", line 116, in decorate_context
[rank10]:     return func(*args, **kwargs)
[rank10]:   File "/home/charlie/skip-residual/gpt-fast/benchmark.py", line 82, in prefill
[rank10]:     logits = model(x, input_pos)
[rank10]:   File "/home/charlie/skip-residual/gpt-fast/gpt_fast/gpt_ladder_TP.py", line 132, in forward
[rank10]:     previous_attention_out, previous_mlp_out, x, attention_handle, mlp_handle = layer(
[rank10]:   File "/home/charlie/skip-residual/gpt-fast/gpt_fast/gpt_ladder_TP.py", line 199, in forward
[rank10]:     with torch.device(residual.device):

[rank10]: Set TORCH_LOGS="+dynamo" and TORCHDYNAMO_VERBOSE=1 for more information


[rank10]: You can suppress this exception and fall back to eager by setting:
[rank10]:     import torch._dynamo
[rank10]:     torch._dynamo.config.suppress_errors = True

[rank13]: Traceback (most recent call last):
[rank13]:   File "/home/charlie/skip-residual/gpt-fast/benchmark.py", line 492, in <module>
[rank13]:     main(
[rank13]:   File "/home/charlie/skip-residual/gpt-fast/benchmark.py", line 419, in main
[rank13]:     y, decode_latency, prefill_latency = generate(
[rank13]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/utils/_contextlib.py", line 116, in decorate_context
[rank13]:     return func(*args, **kwargs)
[rank13]:   File "/home/charlie/skip-residual/gpt-fast/benchmark.py", line 140, in generate
[rank13]:     next_token = prefill(model, prompt.view(batch_size, -1), input_pos, **sampling_kwargs)
[rank13]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/eval_frame.py", line 556, in _fn
[rank13]:     return fn(*args, **kwargs)
[rank13]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/convert_frame.py", line 1395, in __call__
[rank13]:     return self._torchdynamo_orig_callable(
[rank13]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/convert_frame.py", line 545, in __call__
[rank13]:     return _compile(
[rank13]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/convert_frame.py", line 977, in _compile
[rank13]:     guarded_code = compile_inner(code, one_graph, hooks, transform)
[rank13]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/convert_frame.py", line 706, in compile_inner
[rank13]:     return _compile_inner(code, one_graph, hooks, transform)
[rank13]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_utils_internal.py", line 95, in wrapper_function
[rank13]:     return function(*args, **kwargs)
[rank13]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/convert_frame.py", line 741, in _compile_inner
[rank13]:     out_code = transform_code_object(code, transform)
[rank13]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/bytecode_transformation.py", line 1348, in transform_code_object
[rank13]:     transformations(instructions, code_options)
[rank13]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/convert_frame.py", line 229, in _fn
[rank13]:     return fn(*args, **kwargs)
[rank13]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/convert_frame.py", line 658, in transform
[rank13]:     tracer.run()
[rank13]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 2912, in run
[rank13]:     super().run()
[rank13]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 1120, in run
[rank13]:     while self.step():
[rank13]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 1032, in step
[rank13]:     self.dispatch_table[inst.opcode](self, inst)
[rank13]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 640, in wrapper
[rank13]:     return inner_fn(self, inst)
[rank13]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 1816, in CALL_FUNCTION_EX
[rank13]:     self.call_function(fn, argsvars.items, kwargsvars)
[rank13]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 967, in call_function
[rank13]:     self.push(fn.call_function(self, args, kwargs))  # type: ignore[arg-type]
[rank13]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/variables/lazy.py", line 170, in realize_and_forward
[rank13]:     return getattr(self.realize(), name)(*args, **kwargs)
[rank13]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/variables/functions.py", line 349, in call_function
[rank13]:     return super().call_function(tx, args, kwargs)
[rank13]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/variables/functions.py", line 125, in call_function
[rank13]:     return tx.inline_user_function_return(self, [*self.self_args(), *args], kwargs)
[rank13]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 973, in inline_user_function_return
[rank13]:     return InliningInstructionTranslator.inline_call(self, fn, args, kwargs)
[rank13]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 3127, in inline_call
[rank13]:     return cls.inline_call_(parent, func, args, kwargs)
[rank13]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 3255, in inline_call_
[rank13]:     tracer.run()
[rank13]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 1120, in run
[rank13]:     while self.step():
[rank13]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 1032, in step
[rank13]:     self.dispatch_table[inst.opcode](self, inst)
[rank13]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 640, in wrapper
[rank13]:     return inner_fn(self, inst)
[rank13]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 1816, in CALL_FUNCTION_EX
[rank13]:     self.call_function(fn, argsvars.items, kwargsvars)
[rank13]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 967, in call_function
[rank13]:     self.push(fn.call_function(self, args, kwargs))  # type: ignore[arg-type]
[rank13]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/variables/functions.py", line 349, in call_function
[rank13]:     return super().call_function(tx, args, kwargs)
[rank13]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/variables/functions.py", line 125, in call_function
[rank13]:     return tx.inline_user_function_return(self, [*self.self_args(), *args], kwargs)
[rank13]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 973, in inline_user_function_return
[rank13]:     return InliningInstructionTranslator.inline_call(self, fn, args, kwargs)
[rank13]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 3127, in inline_call
[rank13]:     return cls.inline_call_(parent, func, args, kwargs)
[rank13]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 3255, in inline_call_
[rank13]:     tracer.run()
[rank13]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 1120, in run
[rank13]:     while self.step():
[rank13]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 1032, in step
[rank13]:     self.dispatch_table[inst.opcode](self, inst)
[rank13]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 640, in wrapper
[rank13]:     return inner_fn(self, inst)
[rank13]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 1738, in CALL_FUNCTION
[rank13]:     self.call_function(fn, args, {})
[rank13]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 967, in call_function
[rank13]:     self.push(fn.call_function(self, args, kwargs))  # type: ignore[arg-type]
[rank13]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/variables/nn_module.py", line 913, in call_function
[rank13]:     return variables.UserFunctionVariable(fn, source=source).call_function(
[rank13]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/variables/functions.py", line 349, in call_function
[rank13]:     return super().call_function(tx, args, kwargs)
[rank13]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/variables/functions.py", line 125, in call_function
[rank13]:     return tx.inline_user_function_return(self, [*self.self_args(), *args], kwargs)
[rank13]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 973, in inline_user_function_return
[rank13]:     return InliningInstructionTranslator.inline_call(self, fn, args, kwargs)
[rank13]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 3127, in inline_call
[rank13]:     return cls.inline_call_(parent, func, args, kwargs)
[rank13]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 3255, in inline_call_
[rank13]:     tracer.run()
[rank13]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 1120, in run
[rank13]:     while self.step():
[rank13]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 1032, in step
[rank13]:     self.dispatch_table[inst.opcode](self, inst)
[rank13]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 640, in wrapper
[rank13]:     return inner_fn(self, inst)
[rank13]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 1738, in CALL_FUNCTION
[rank13]:     self.call_function(fn, args, {})
[rank13]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 967, in call_function
[rank13]:     self.push(fn.call_function(self, args, kwargs))  # type: ignore[arg-type]
[rank13]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/variables/nn_module.py", line 913, in call_function
[rank13]:     return variables.UserFunctionVariable(fn, source=source).call_function(
[rank13]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/variables/functions.py", line 349, in call_function
[rank13]:     return super().call_function(tx, args, kwargs)
[rank13]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/variables/functions.py", line 125, in call_function
[rank13]:     return tx.inline_user_function_return(self, [*self.self_args(), *args], kwargs)
[rank13]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 973, in inline_user_function_return
[rank13]:     return InliningInstructionTranslator.inline_call(self, fn, args, kwargs)
[rank13]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 3127, in inline_call
[rank13]:     return cls.inline_call_(parent, func, args, kwargs)
[rank13]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 3255, in inline_call_
[rank13]:     tracer.run()
[rank13]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 1120, in run
[rank13]:     while self.step():
[rank13]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 1032, in step
[rank13]:     self.dispatch_table[inst.opcode](self, inst)
[rank13]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 1432, in SETUP_WITH
[rank13]:     self.setup_or_before_with(inst)
[rank13]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 2445, in setup_or_before_with
[rank13]:     unimplemented(f"{inst.opname} {ctx}")
[rank13]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/exc.py", line 313, in unimplemented
[rank13]:     raise Unsupported(msg, case_name=case_name)
[rank13]: torch._dynamo.exc.Unsupported: SETUP_WITH ConstantVariable(device: device(type='cuda', index=5))

[rank13]: from user code:
[rank13]:    File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/external_utils.py", line 31, in inner
[rank13]:     return fn(*args, **kwargs)
[rank13]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/utils/_contextlib.py", line 116, in decorate_context
[rank13]:     return func(*args, **kwargs)
[rank13]:   File "/home/charlie/skip-residual/gpt-fast/benchmark.py", line 82, in prefill
[rank13]:     logits = model(x, input_pos)
[rank13]:   File "/home/charlie/skip-residual/gpt-fast/gpt_fast/gpt_ladder_TP.py", line 132, in forward
[rank13]:     previous_attention_out, previous_mlp_out, x, attention_handle, mlp_handle = layer(
[rank13]:   File "/home/charlie/skip-residual/gpt-fast/gpt_fast/gpt_ladder_TP.py", line 199, in forward
[rank13]:     with torch.device(residual.device):

[rank13]: Set TORCH_LOGS="+dynamo" and TORCHDYNAMO_VERBOSE=1 for more information


[rank13]: You can suppress this exception and fall back to eager by setting:
[rank13]:     import torch._dynamo
[rank13]:     torch._dynamo.config.suppress_errors = True

[rank9]: Traceback (most recent call last):
[rank9]:   File "/home/charlie/skip-residual/gpt-fast/benchmark.py", line 492, in <module>
[rank9]:     main(
[rank9]:   File "/home/charlie/skip-residual/gpt-fast/benchmark.py", line 419, in main
[rank9]:     y, decode_latency, prefill_latency = generate(
[rank9]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/utils/_contextlib.py", line 116, in decorate_context
[rank9]:     return func(*args, **kwargs)
[rank9]:   File "/home/charlie/skip-residual/gpt-fast/benchmark.py", line 140, in generate
[rank9]:     next_token = prefill(model, prompt.view(batch_size, -1), input_pos, **sampling_kwargs)
[rank9]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/eval_frame.py", line 556, in _fn
[rank9]:     return fn(*args, **kwargs)
[rank9]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/convert_frame.py", line 1395, in __call__
[rank9]:     return self._torchdynamo_orig_callable(
[rank9]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/convert_frame.py", line 545, in __call__
[rank9]:     return _compile(
[rank9]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/convert_frame.py", line 977, in _compile
[rank9]:     guarded_code = compile_inner(code, one_graph, hooks, transform)
[rank9]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/convert_frame.py", line 706, in compile_inner
[rank9]:     return _compile_inner(code, one_graph, hooks, transform)
[rank9]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_utils_internal.py", line 95, in wrapper_function
[rank9]:     return function(*args, **kwargs)
[rank9]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/convert_frame.py", line 741, in _compile_inner
[rank9]:     out_code = transform_code_object(code, transform)
[rank9]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/bytecode_transformation.py", line 1348, in transform_code_object
[rank9]:     transformations(instructions, code_options)
[rank9]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/convert_frame.py", line 229, in _fn
[rank9]:     return fn(*args, **kwargs)
[rank9]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/convert_frame.py", line 658, in transform
[rank9]:     tracer.run()
[rank9]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 2912, in run
[rank9]:     super().run()
[rank9]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 1120, in run
[rank9]:     while self.step():
[rank9]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 1032, in step
[rank9]:     self.dispatch_table[inst.opcode](self, inst)
[rank9]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 640, in wrapper
[rank9]:     return inner_fn(self, inst)
[rank9]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 1816, in CALL_FUNCTION_EX
[rank9]:     self.call_function(fn, argsvars.items, kwargsvars)
[rank9]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 967, in call_function
[rank9]:     self.push(fn.call_function(self, args, kwargs))  # type: ignore[arg-type]
[rank9]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/variables/lazy.py", line 170, in realize_and_forward
[rank9]:     return getattr(self.realize(), name)(*args, **kwargs)
[rank9]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/variables/functions.py", line 349, in call_function
[rank9]:     return super().call_function(tx, args, kwargs)
[rank9]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/variables/functions.py", line 125, in call_function
[rank9]:     return tx.inline_user_function_return(self, [*self.self_args(), *args], kwargs)
[rank9]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 973, in inline_user_function_return
[rank9]:     return InliningInstructionTranslator.inline_call(self, fn, args, kwargs)
[rank9]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 3127, in inline_call
[rank9]:     return cls.inline_call_(parent, func, args, kwargs)
[rank9]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 3255, in inline_call_
[rank9]:     tracer.run()
[rank9]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 1120, in run
[rank9]:     while self.step():
[rank9]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 1032, in step
[rank9]:     self.dispatch_table[inst.opcode](self, inst)
[rank9]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 640, in wrapper
[rank9]:     return inner_fn(self, inst)
[rank9]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 1816, in CALL_FUNCTION_EX
[rank9]:     self.call_function(fn, argsvars.items, kwargsvars)
[rank9]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 967, in call_function
[rank9]:     self.push(fn.call_function(self, args, kwargs))  # type: ignore[arg-type]
[rank9]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/variables/functions.py", line 349, in call_function
[rank9]:     return super().call_function(tx, args, kwargs)
[rank9]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/variables/functions.py", line 125, in call_function
[rank9]:     return tx.inline_user_function_return(self, [*self.self_args(), *args], kwargs)
[rank9]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 973, in inline_user_function_return
[rank9]:     return InliningInstructionTranslator.inline_call(self, fn, args, kwargs)
[rank9]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 3127, in inline_call
[rank9]:     return cls.inline_call_(parent, func, args, kwargs)
[rank9]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 3255, in inline_call_
[rank9]:     tracer.run()
[rank9]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 1120, in run
[rank9]:     while self.step():
[rank9]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 1032, in step
[rank9]:     self.dispatch_table[inst.opcode](self, inst)
[rank9]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 640, in wrapper
[rank9]:     return inner_fn(self, inst)
[rank9]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 1738, in CALL_FUNCTION
[rank9]:     self.call_function(fn, args, {})
[rank9]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 967, in call_function
[rank9]:     self.push(fn.call_function(self, args, kwargs))  # type: ignore[arg-type]
[rank9]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/variables/nn_module.py", line 913, in call_function
[rank9]:     return variables.UserFunctionVariable(fn, source=source).call_function(
[rank9]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/variables/functions.py", line 349, in call_function
[rank9]:     return super().call_function(tx, args, kwargs)
[rank9]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/variables/functions.py", line 125, in call_function
[rank9]:     return tx.inline_user_function_return(self, [*self.self_args(), *args], kwargs)
[rank9]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 973, in inline_user_function_return
[rank9]:     return InliningInstructionTranslator.inline_call(self, fn, args, kwargs)
[rank9]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 3127, in inline_call
[rank9]:     return cls.inline_call_(parent, func, args, kwargs)
[rank9]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 3255, in inline_call_
[rank9]:     tracer.run()
[rank9]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 1120, in run
[rank9]:     while self.step():
[rank9]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 1032, in step
[rank9]:     self.dispatch_table[inst.opcode](self, inst)
[rank9]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 640, in wrapper
[rank9]:     return inner_fn(self, inst)
[rank9]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 1738, in CALL_FUNCTION
[rank9]:     self.call_function(fn, args, {})
[rank9]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 967, in call_function
[rank9]:     self.push(fn.call_function(self, args, kwargs))  # type: ignore[arg-type]
[rank9]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/variables/nn_module.py", line 913, in call_function
[rank9]:     return variables.UserFunctionVariable(fn, source=source).call_function(
[rank9]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/variables/functions.py", line 349, in call_function
[rank9]:     return super().call_function(tx, args, kwargs)
[rank9]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/variables/functions.py", line 125, in call_function
[rank9]:     return tx.inline_user_function_return(self, [*self.self_args(), *args], kwargs)
[rank9]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 973, in inline_user_function_return
[rank9]:     return InliningInstructionTranslator.inline_call(self, fn, args, kwargs)
[rank9]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 3127, in inline_call
[rank9]:     return cls.inline_call_(parent, func, args, kwargs)
[rank9]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 3255, in inline_call_
[rank9]:     tracer.run()
[rank9]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 1120, in run
[rank9]:     while self.step():
[rank9]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 1032, in step
[rank9]:     self.dispatch_table[inst.opcode](self, inst)
[rank9]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 1432, in SETUP_WITH
[rank9]:     self.setup_or_before_with(inst)
[rank9]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/symbolic_convert.py", line 2445, in setup_or_before_with
[rank9]:     unimplemented(f"{inst.opname} {ctx}")
[rank9]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/exc.py", line 313, in unimplemented
[rank9]:     raise Unsupported(msg, case_name=case_name)
[rank9]: torch._dynamo.exc.Unsupported: SETUP_WITH ConstantVariable(device: device(type='cuda', index=1))

[rank9]: from user code:
[rank9]:    File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/_dynamo/external_utils.py", line 31, in inner
[rank9]:     return fn(*args, **kwargs)
[rank9]:   File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/utils/_contextlib.py", line 116, in decorate_context
[rank9]:     return func(*args, **kwargs)
[rank9]:   File "/home/charlie/skip-residual/gpt-fast/benchmark.py", line 82, in prefill
[rank9]:     logits = model(x, input_pos)
[rank9]:   File "/home/charlie/skip-residual/gpt-fast/gpt_fast/gpt_ladder_TP.py", line 132, in forward
[rank9]:     previous_attention_out, previous_mlp_out, x, attention_handle, mlp_handle = layer(
[rank9]:   File "/home/charlie/skip-residual/gpt-fast/gpt_fast/gpt_ladder_TP.py", line 199, in forward
[rank9]:     with torch.device(residual.device):

[rank9]: Set TORCH_LOGS="+dynamo" and TORCHDYNAMO_VERBOSE=1 for more information


[rank9]: You can suppress this exception and fall back to eager by setting:
[rank9]:     import torch._dynamo
[rank9]:     torch._dynamo.config.suppress_errors = True

[rank8]:[W1118 16:09:07.131686672 ProcessGroupNCCL.cpp:1374] Warning: WARNING: process group has NOT been destroyed before we destruct ProcessGroupNCCL. On normal program exit, the application should call destroy_process_group to ensure that any pending NCCL operations have finished in this process. In rare cases this process can exit before this point and block the progress of another member of the process group. This constraint has always been present,  but this warning has only been added since PyTorch 2.4 (function operator())
W1118 16:09:07.299000 2859656 site-packages/torch/distributed/elastic/multiprocessing/api.py:897] Sending process 2859722 closing signal SIGTERM
W1118 16:09:07.300000 2859656 site-packages/torch/distributed/elastic/multiprocessing/api.py:897] Sending process 2859723 closing signal SIGTERM
W1118 16:09:07.300000 2859656 site-packages/torch/distributed/elastic/multiprocessing/api.py:897] Sending process 2859724 closing signal SIGTERM
W1118 16:09:07.300000 2859656 site-packages/torch/distributed/elastic/multiprocessing/api.py:897] Sending process 2859725 closing signal SIGTERM
W1118 16:09:07.301000 2859656 site-packages/torch/distributed/elastic/multiprocessing/api.py:897] Sending process 2859726 closing signal SIGTERM
W1118 16:09:07.302000 2859656 site-packages/torch/distributed/elastic/multiprocessing/api.py:897] Sending process 2859727 closing signal SIGTERM
W1118 16:09:07.302000 2859656 site-packages/torch/distributed/elastic/multiprocessing/api.py:897] Sending process 2859728 closing signal SIGTERM
E1118 16:09:08.043000 2859656 site-packages/torch/distributed/elastic/multiprocessing/api.py:869] failed (exitcode: 1) local_rank: 7 (pid: 2859729) of binary: /home/charlie/anaconda3/envs/gpt-fast/bin/python
Traceback (most recent call last):
  File "/home/charlie/anaconda3/envs/gpt-fast/bin/torchrun", line 8, in <module>
    sys.exit(main())
  File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/distributed/elastic/multiprocessing/errors/__init__.py", line 355, in wrapper
    return f(*args, **kwargs)
  File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/distributed/run.py", line 919, in main
    run(args)
  File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/distributed/run.py", line 910, in run
    elastic_launch(
  File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/distributed/launcher/api.py", line 138, in __call__
    return launch_agent(self._config, self._entrypoint, list(args))
  File "/home/charlie/anaconda3/envs/gpt-fast/lib/python3.10/site-packages/torch/distributed/launcher/api.py", line 269, in launch_agent
    raise ChildFailedError(
torch.distributed.elastic.multiprocessing.errors.ChildFailedError: 
============================================================
benchmark.py FAILED
------------------------------------------------------------
Failures:
  <NO_OTHER_FAILURES>
------------------------------------------------------------
Root Cause (first observed failure):
[0]:
  time      : 2024-11-18_16:09:07
  host      : mk-xii-06.cloud.together.ai
  rank      : 15 (local_rank: 7)
  exitcode  : 1 (pid: 2859729)
  error_file: <N/A>
  traceback : To enable traceback see: https://pytorch.org/docs/stable/elastic/errors.html
============================================================
