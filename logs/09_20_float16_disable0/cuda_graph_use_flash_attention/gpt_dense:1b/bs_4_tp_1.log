flash_kv_decode is set to True
Using device=cuda
Loading model ...
GPTDense(
  (tok_embeddings): Embedding(49152, 1536)
  (layers): ModuleList(
    (0-39): 40 x DenseTransformerBlock(
      semi_compiled = False
      (attention): Attention(
        (wqkv): Linear(in_features=1536, out_features=4608, bias=False)
        (wo): Linear(in_features=1536, out_features=1536, bias=False)
      )
      (feed_forward): FeedForward(
        (w1): Linear(in_features=1536, out_features=8192, bias=False)
        (w2): Linear(in_features=4096, out_features=1536, bias=False)
      )
      (ffn_norm): RMSNorm()
      (attention_norm): RMSNorm()
    )
  )
  (norm): RMSNorm()
  (output): Linear(in_features=1536, out_features=49152, bias=False)
)
Time to load model: 0.95 seconds
[rank0]:[W1001 01:29:25.666570530 CUDAGraph.cpp:150] Warning: Waiting for pending NCCL work to finish before starting graph capture. (function operator())
Prefill latency: 0.055467108031734824 sec
Decode latency: 2.4467854410177097 sec
Compilation time: 2.50 seconds
Prefill latency: 0.05527790903579444 sec
Decode latency: 2.4452583129750565 sec
Prefill latency: 0.055227615986950696 sec
Decode latency: 2.440059249056503 sec
Prefill latency: 0.05501253204420209 sec
Decode latency: 2.4400017539737746 sec
Prefill latency: 0.055093183065764606 sec
Decode latency: 2.4396367369918153 sec
Prefill latency: 0.05504787294194102 sec
Decode latency: 2.439789134077728 sec
Time for inference 1: 2.50 sec total, 410.34 tokens/sec
Decode latency: 2.44 sec
Prefill latency: 0.06 sec
Bandwidth achieved: 991.45 GB/s
FLOPS achieved: 4.96 TF/s

Prefill latency: 0.055047746980562806 sec
Decode latency: 2.4395014389883727 sec
Time for inference 2: 2.50 sec total, 410.38 tokens/sec
Decode latency: 2.44 sec
Prefill latency: 0.06 sec
Bandwidth achieved: 991.54 GB/s
FLOPS achieved: 4.96 TF/s

Prefill latency: 0.05511136201675981 sec
Decode latency: 2.4398429869906977 sec
Time for inference 3: 2.50 sec total, 410.31 tokens/sec
Decode latency: 2.44 sec
Prefill latency: 0.06 sec
Bandwidth achieved: 991.38 GB/s
FLOPS achieved: 4.96 TF/s

Prefill latency: 0.055061995051801205 sec
Decode latency: 2.439501791028306 sec
Time for inference 4: 2.50 sec total, 410.34 tokens/sec
Decode latency: 2.44 sec
Prefill latency: 0.06 sec
Bandwidth achieved: 991.45 GB/s
FLOPS achieved: 4.96 TF/s

Prefill latency: 0.05515342904254794 sec
Decode latency: 2.4403912030393258 sec
Time for inference 5: 2.50 sec total, 410.20 tokens/sec
Decode latency: 2.44 sec
Prefill latency: 0.06 sec
Bandwidth achieved: 991.10 GB/s
FLOPS achieved: 4.96 TF/s

Prefill latency: 0.055182666052132845 sec
Decode latency: 2.4395308680832386 sec
Time for inference 6: 2.50 sec total, 410.34 tokens/sec
Decode latency: 2.44 sec
Prefill latency: 0.06 sec
Bandwidth achieved: 991.46 GB/s
FLOPS achieved: 4.96 TF/s

Prefill latency: 0.05506159202195704 sec
Decode latency: 2.440258966991678 sec
Time for inference 7: 2.50 sec total, 410.24 tokens/sec
Decode latency: 2.44 sec
Prefill latency: 0.06 sec
Bandwidth achieved: 991.22 GB/s
FLOPS achieved: 4.96 TF/s

Prefill latency: 0.05511879897676408 sec
Decode latency: 2.4397060530027375 sec
Time for inference 8: 2.50 sec total, 410.33 tokens/sec
Decode latency: 2.44 sec
Prefill latency: 0.06 sec
Bandwidth achieved: 991.44 GB/s
FLOPS achieved: 4.96 TF/s

Prefill latency: 0.05508608091622591 sec
Decode latency: 2.4396011560456827 sec
Time for inference 9: 2.50 sec total, 410.36 tokens/sec
Decode latency: 2.44 sec
Prefill latency: 0.06 sec
Bandwidth achieved: 991.51 GB/s
FLOPS achieved: 4.96 TF/s

Prefill latency: 0.05506714200600982 sec
Decode latency: 2.4395910140592605 sec
Time for inference 10: 2.50 sec total, 410.36 tokens/sec
Decode latency: 2.44 sec
Prefill latency: 0.06 sec
Bandwidth achieved: 991.50 GB/s
FLOPS achieved: 4.96 TF/s

==========
Batch Size: 4
Prompt Length: 1024
Generated tokens: 256
Average decode latency: 2.4398 sec
Average prefill latency: 0.0551 sec
Average tokens/sec: 410.32
Memory used: 6.16 GB
Done. we are killing the process
