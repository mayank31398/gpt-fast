flash_kv_decode is set to True
Using device=cuda
Loading model ...
GPTEnsemble(
  (tok_embeddings): Embedding(49152, 1536)
  (layers): ModuleList(
    (0-39): 40 x EnsembleTransformerBlock(
      semi_compiled = False
      (attention): Attention(
        (wqkv): Linear(in_features=1536, out_features=2560, bias=False)
        (wo): Linear(in_features=1536, out_features=1536, bias=False)
      )
      (feed_forward): FeedForward(
        (w1): Linear(in_features=1536, out_features=8192, bias=False)
        (w2): Linear(in_features=4096, out_features=1536, bias=False)
      )
      (ffn_norm): RMSNorm()
      (attention_norm): RMSNorm()
    )
  )
  (norm): RMSNorm()
  (output): Linear(in_features=1536, out_features=49152, bias=False)
)
Time to load model: 0.94 seconds
[rank0]:[W930 19:39:24.815057471 CUDAGraph.cpp:150] Warning: Waiting for pending NCCL work to finish before starting graph capture. (function operator())
Prefill latency: 0.0935527270194143 sec
Decode latency: 2.8803749730577692 sec
Compilation time: 2.98 seconds
Prefill latency: 0.09331100701820105 sec
Decode latency: 2.9885618740227073 sec
Prefill latency: 0.09308140201028436 sec
Decode latency: 2.9870543259894475 sec
Prefill latency: 0.09300326800439507 sec
Decode latency: 2.98754498292692 sec
Prefill latency: 0.09314475499559194 sec
Decode latency: 2.9867271460825577 sec
Prefill latency: 0.09307916497346014 sec
Decode latency: 2.9871684970567003 sec
Time for inference 1: 3.08 sec total, 664.73 tokens/sec
Decode latency: 2.99 sec
Prefill latency: 0.09 sec
Bandwidth achieved: 1438.81 GB/s
FLOPS achieved: 7.19 TF/s

Prefill latency: 0.09305668296292424 sec
Decode latency: 2.9882147719617933 sec
Time for inference 2: 3.08 sec total, 664.51 tokens/sec
Decode latency: 2.99 sec
Prefill latency: 0.09 sec
Bandwidth achieved: 1438.34 GB/s
FLOPS achieved: 7.19 TF/s

Prefill latency: 0.09303957899101079 sec
Decode latency: 2.9877465809695423 sec
Time for inference 3: 3.08 sec total, 664.61 tokens/sec
Decode latency: 2.99 sec
Prefill latency: 0.09 sec
Bandwidth achieved: 1438.55 GB/s
FLOPS achieved: 7.19 TF/s

Prefill latency: 0.09303003503009677 sec
Decode latency: 2.909689659019932 sec
Time for inference 4: 3.00 sec total, 681.88 tokens/sec
Decode latency: 2.91 sec
Prefill latency: 0.09 sec
Bandwidth achieved: 1475.94 GB/s
FLOPS achieved: 7.38 TF/s

Prefill latency: 0.09303957503288984 sec
Decode latency: 2.9883859959663823 sec
Time for inference 5: 3.08 sec total, 664.45 tokens/sec
Decode latency: 2.99 sec
Prefill latency: 0.09 sec
Bandwidth achieved: 1438.22 GB/s
FLOPS achieved: 7.19 TF/s

Prefill latency: 0.0931122211040929 sec
Decode latency: 2.987282023066655 sec
Time for inference 6: 3.08 sec total, 664.69 tokens/sec
Decode latency: 2.99 sec
Prefill latency: 0.09 sec
Bandwidth achieved: 1438.73 GB/s
FLOPS achieved: 7.19 TF/s

Prefill latency: 0.09302111901342869 sec
Decode latency: 2.986583766993135 sec
Time for inference 7: 3.08 sec total, 664.86 tokens/sec
Decode latency: 2.99 sec
Prefill latency: 0.09 sec
Bandwidth achieved: 1439.09 GB/s
FLOPS achieved: 7.20 TF/s

Prefill latency: 0.09304486401379108 sec
Decode latency: 2.987628133967519 sec
Time for inference 8: 3.08 sec total, 664.64 tokens/sec
Decode latency: 2.99 sec
Prefill latency: 0.09 sec
Bandwidth achieved: 1438.61 GB/s
FLOPS achieved: 7.19 TF/s

Prefill latency: 0.09304379997774959 sec
Decode latency: 2.966918198042549 sec
Time for inference 9: 3.06 sec total, 669.14 tokens/sec
Decode latency: 2.97 sec
Prefill latency: 0.09 sec
Bandwidth achieved: 1448.36 GB/s
FLOPS achieved: 7.24 TF/s

Prefill latency: 0.09303384693339467 sec
Decode latency: 2.987115369993262 sec
Time for inference 10: 3.08 sec total, 664.75 tokens/sec
Decode latency: 2.99 sec
Prefill latency: 0.09 sec
Bandwidth achieved: 1438.86 GB/s
FLOPS achieved: 7.19 TF/s

==========
Batch Size: 8
Prompt Length: 1024
Generated tokens: 256
Average decode latency: 2.9777 sec
Average prefill latency: 0.0931 sec
Average tokens/sec: 666.83
Memory used: 5.88 GB
Done. we are killing the process
