flash_kv_decode is set to True
Using device=cuda
Loading model ...
GPTEnsemble(
  (tok_embeddings): Embedding(49152, 1536)
  (layers): ModuleList(
    (0-39): 40 x EnsembleTransformerBlock(
      semi_compiled = False
      (attention): Attention(
        (wqkv): Linear(in_features=1536, out_features=2560, bias=False)
        (wo): Linear(in_features=1536, out_features=1536, bias=False)
      )
      (feed_forward): FeedForward(
        (w1): Linear(in_features=1536, out_features=8192, bias=False)
        (w2): Linear(in_features=4096, out_features=1536, bias=False)
      )
      (ffn_norm): RMSNorm()
      (attention_norm): RMSNorm()
    )
  )
  (norm): RMSNorm()
  (output): Linear(in_features=1536, out_features=49152, bias=False)
)
Time to load model: 0.97 seconds
Prefill latency: 0.048768782056868076 sec
Decode latency: 2.5490488160867244 sec
Compilation time: 2.60 seconds
Prefill latency: 0.048523124074563384 sec
Decode latency: 2.475125674973242 sec
Prefill latency: 0.04844924295321107 sec
Decode latency: 2.5460403240285814 sec
Prefill latency: 0.04845949704758823 sec
Decode latency: 2.546335297054611 sec
Prefill latency: 0.048465419095009565 sec
Decode latency: 2.5461006519617513 sec
Prefill latency: 0.04848973697517067 sec
Decode latency: 2.5400784740922973 sec
Time for inference 1: 2.59 sec total, 395.48 tokens/sec
Decode latency: 2.54 sec
Prefill latency: 0.05 sec
Bandwidth achieved: 856.03 GB/s
FLOPS achieved: 4.28 TF/s

Prefill latency: 0.04833973397035152 sec
Decode latency: 2.4097990409936756 sec
Time for inference 2: 2.46 sec total, 416.46 tokens/sec
Decode latency: 2.41 sec
Prefill latency: 0.05 sec
Bandwidth achieved: 901.44 GB/s
FLOPS achieved: 4.51 TF/s

Prefill latency: 0.04842146998271346 sec
Decode latency: 2.411953882081434 sec
Time for inference 3: 2.46 sec total, 416.08 tokens/sec
Decode latency: 2.41 sec
Prefill latency: 0.05 sec
Bandwidth achieved: 900.62 GB/s
FLOPS achieved: 4.50 TF/s

Prefill latency: 0.04829252406489104 sec
Decode latency: 2.5412726999493316 sec
Time for inference 4: 2.59 sec total, 395.33 tokens/sec
Decode latency: 2.54 sec
Prefill latency: 0.05 sec
Bandwidth achieved: 855.70 GB/s
FLOPS achieved: 4.28 TF/s

Prefill latency: 0.048312784056179225 sec
Decode latency: 2.540952663985081 sec
Time for inference 5: 2.59 sec total, 395.38 tokens/sec
Decode latency: 2.54 sec
Prefill latency: 0.05 sec
Bandwidth achieved: 855.80 GB/s
FLOPS achieved: 4.28 TF/s

Prefill latency: 0.048360993969254196 sec
Decode latency: 2.5411835650447756 sec
Time for inference 6: 2.59 sec total, 395.33 tokens/sec
Decode latency: 2.54 sec
Prefill latency: 0.05 sec
Bandwidth achieved: 855.69 GB/s
FLOPS achieved: 4.28 TF/s

Prefill latency: 0.04837216599844396 sec
Decode latency: 2.5413656739983708 sec
Time for inference 7: 2.59 sec total, 395.29 tokens/sec
Decode latency: 2.54 sec
Prefill latency: 0.05 sec
Bandwidth achieved: 855.62 GB/s
FLOPS achieved: 4.28 TF/s

Prefill latency: 0.0484084120253101 sec
Decode latency: 2.5408788750646636 sec
Time for inference 8: 2.59 sec total, 395.37 tokens/sec
Decode latency: 2.54 sec
Prefill latency: 0.05 sec
Bandwidth achieved: 855.78 GB/s
FLOPS achieved: 4.28 TF/s

Prefill latency: 0.04842943698167801 sec
Decode latency: 2.427577366004698 sec
Time for inference 9: 2.48 sec total, 413.45 tokens/sec
Decode latency: 2.43 sec
Prefill latency: 0.05 sec
Bandwidth achieved: 894.93 GB/s
FLOPS achieved: 4.47 TF/s

Prefill latency: 0.04832727194298059 sec
Decode latency: 2.5412256630370393 sec
Time for inference 10: 2.59 sec total, 395.33 tokens/sec
Decode latency: 2.54 sec
Prefill latency: 0.05 sec
Bandwidth achieved: 855.70 GB/s
FLOPS achieved: 4.28 TF/s

==========
Batch Size: 4
Prompt Length: 1024
Generated tokens: 256
Average decode latency: 2.5036 sec
Average prefill latency: 0.0484 sec
Average tokens/sec: 401.35
Memory used: 4.19 GB
Done. we are killing the process
