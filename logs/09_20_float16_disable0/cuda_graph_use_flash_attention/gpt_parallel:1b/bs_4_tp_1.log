flash_kv_decode is set to True
Using device=cuda
Loading model ...
GPTParallel(
  (tok_embeddings): Embedding(49152, 1536)
  (layers): ModuleList(
    (0-39): 40 x ParallelTransformerBlock(
      semi_compiled = False
      (attention): FuseAttentionMLP(
        (wqkv1): Linear(in_features=1536, out_features=10752, bias=False)
        (wo): Linear(in_features=1536, out_features=1536, bias=False)
        (w2): Linear(in_features=4096, out_features=1536, bias=False)
      )
      (attention_norm): RMSNorm()
    )
  )
  (norm): RMSNorm()
  (output): Linear(in_features=1536, out_features=49152, bias=False)
)
Time to load model: 0.90 seconds
[rank0]:[W930 19:16:24.895383208 CUDAGraph.cpp:150] Warning: Waiting for pending NCCL work to finish before starting graph capture. (function operator())
Prefill latency: 0.04780345689505339 sec
Decode latency: 2.4930699249962345 sec
Compilation time: 2.54 seconds
Prefill latency: 0.04751031391788274 sec
Decode latency: 2.491943964967504 sec
Prefill latency: 0.047494968050159514 sec
Decode latency: 2.492086968035437 sec
Prefill latency: 0.047434631967917085 sec
Decode latency: 2.492711319006048 sec
Prefill latency: 0.047430130071006715 sec
Decode latency: 2.4926055549876764 sec
Prefill latency: 0.047499443986453116 sec
Decode latency: 2.4935487940674648 sec
Time for inference 1: 2.54 sec total, 402.87 tokens/sec
Decode latency: 2.49 sec
Prefill latency: 0.05 sec
Bandwidth achieved: 871.96 GB/s
FLOPS achieved: 4.36 TF/s

Prefill latency: 0.04743112903088331 sec
Decode latency: 2.492523605003953 sec
Time for inference 2: 2.54 sec total, 403.04 tokens/sec
Decode latency: 2.49 sec
Prefill latency: 0.05 sec
Bandwidth achieved: 872.33 GB/s
FLOPS achieved: 4.36 TF/s

Prefill latency: 0.04742045095190406 sec
Decode latency: 2.492604746017605 sec
Time for inference 3: 2.54 sec total, 403.03 tokens/sec
Decode latency: 2.49 sec
Prefill latency: 0.05 sec
Bandwidth achieved: 872.32 GB/s
FLOPS achieved: 4.36 TF/s

Prefill latency: 0.04749664990231395 sec
Decode latency: 2.388936255010776 sec
Time for inference 4: 2.44 sec total, 420.11 tokens/sec
Decode latency: 2.39 sec
Prefill latency: 0.05 sec
Bandwidth achieved: 909.27 GB/s
FLOPS achieved: 4.55 TF/s

Prefill latency: 0.047631580964662135 sec
Decode latency: 2.493246036930941 sec
Time for inference 5: 2.54 sec total, 402.86 tokens/sec
Decode latency: 2.49 sec
Prefill latency: 0.05 sec
Bandwidth achieved: 871.95 GB/s
FLOPS achieved: 4.36 TF/s

Prefill latency: 0.04746646003331989 sec
Decode latency: 2.4003221209859475 sec
Time for inference 6: 2.45 sec total, 418.20 tokens/sec
Decode latency: 2.40 sec
Prefill latency: 0.05 sec
Bandwidth achieved: 905.14 GB/s
FLOPS achieved: 4.53 TF/s

Prefill latency: 0.04759441991336644 sec
Decode latency: 2.4929341829847544 sec
Time for inference 7: 2.54 sec total, 402.94 tokens/sec
Decode latency: 2.49 sec
Prefill latency: 0.05 sec
Bandwidth achieved: 872.12 GB/s
FLOPS achieved: 4.36 TF/s

Prefill latency: 0.04743183800019324 sec
Decode latency: 2.4870487389853224 sec
Time for inference 8: 2.54 sec total, 403.90 tokens/sec
Decode latency: 2.49 sec
Prefill latency: 0.05 sec
Bandwidth achieved: 874.20 GB/s
FLOPS achieved: 4.37 TF/s

Prefill latency: 0.04742395703215152 sec
Decode latency: 2.4175764380488545 sec
Time for inference 9: 2.47 sec total, 415.28 tokens/sec
Decode latency: 2.42 sec
Prefill latency: 0.05 sec
Bandwidth achieved: 898.82 GB/s
FLOPS achieved: 4.49 TF/s

Prefill latency: 0.04736524599138647 sec
Decode latency: 2.487188447965309 sec
Time for inference 10: 2.54 sec total, 403.88 tokens/sec
Decode latency: 2.49 sec
Prefill latency: 0.05 sec
Bandwidth achieved: 874.16 GB/s
FLOPS achieved: 4.37 TF/s

==========
Batch Size: 4
Prompt Length: 1024
Generated tokens: 256
Average decode latency: 2.4646 sec
Average prefill latency: 0.0475 sec
Average tokens/sec: 407.61
Memory used: 4.34 GB
Done. we are killing the process
