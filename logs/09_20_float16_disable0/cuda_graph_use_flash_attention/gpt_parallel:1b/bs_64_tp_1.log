flash_kv_decode is set to True
Using device=cuda
Loading model ...
GPTParallel(
  (tok_embeddings): Embedding(49152, 1536)
  (layers): ModuleList(
    (0-39): 40 x ParallelTransformerBlock(
      semi_compiled = False
      (attention): FuseAttentionMLP(
        (wqkv1): Linear(in_features=1536, out_features=12800, bias=False)
        (wo): Linear(in_features=1536, out_features=1536, bias=False)
        (w2): Linear(in_features=4096, out_features=1536, bias=False)
      )
      (attention_norm): RMSNorm()
    )
  )
  (norm): RMSNorm()
  (output): Linear(in_features=1536, out_features=49152, bias=False)
)
Time to load model: 1.01 seconds
[rank0]:[W1001 02:18:09.285305500 CUDAGraph.cpp:150] Warning: Waiting for pending NCCL work to finish before starting graph capture. (function operator())
Prefill latency: 0.8105837740004063 sec
Decode latency: 8.516432626987807 sec
Compilation time: 9.33 seconds
Prefill latency: 0.8090076309163123 sec
Decode latency: 8.576380390906706 sec
Prefill latency: 0.8164239609614015 sec
Decode latency: 8.449285118025728 sec
Prefill latency: 0.8095873449929059 sec
Decode latency: 8.576303121983074 sec
Prefill latency: 0.8090342100476846 sec
Decode latency: 8.579639730975032 sec
Prefill latency: 0.8128163359360769 sec
Decode latency: 8.576032100943848 sec
Time for inference 1: 9.39 sec total, 1744.86 tokens/sec
Decode latency: 8.58 sec
Prefill latency: 0.81 sec
Bandwidth achieved: 4215.66 GB/s
FLOPS achieved: 21.08 TF/s

Prefill latency: 0.8095846209907904 sec
Decode latency: 8.52062643901445 sec
Time for inference 2: 9.33 sec total, 1755.83 tokens/sec
Decode latency: 8.52 sec
Prefill latency: 0.81 sec
Bandwidth achieved: 4242.17 GB/s
FLOPS achieved: 21.21 TF/s

Prefill latency: 0.8114367930684239 sec
Decode latency: 8.577168283984065 sec
Time for inference 3: 9.39 sec total, 1744.90 tokens/sec
Decode latency: 8.58 sec
Prefill latency: 0.81 sec
Bandwidth achieved: 4215.75 GB/s
FLOPS achieved: 21.08 TF/s

Prefill latency: 0.8088146150112152 sec
Decode latency: 8.578683452913538 sec
Time for inference 4: 9.39 sec total, 1745.11 tokens/sec
Decode latency: 8.58 sec
Prefill latency: 0.81 sec
Bandwidth achieved: 4216.26 GB/s
FLOPS achieved: 21.08 TF/s

Prefill latency: 0.8132217719685286 sec
Decode latency: 8.577674931962974 sec
Time for inference 5: 9.39 sec total, 1744.48 tokens/sec
Decode latency: 8.58 sec
Prefill latency: 0.81 sec
Bandwidth achieved: 4214.74 GB/s
FLOPS achieved: 21.07 TF/s

Prefill latency: 0.8088041410082951 sec
Decode latency: 8.579732139012776 sec
Time for inference 6: 9.39 sec total, 1744.88 tokens/sec
Decode latency: 8.58 sec
Prefill latency: 0.81 sec
Bandwidth achieved: 4215.71 GB/s
FLOPS achieved: 21.08 TF/s

Prefill latency: 0.811466958024539 sec
Decode latency: 8.576446510036476 sec
Time for inference 7: 9.39 sec total, 1745.04 tokens/sec
Decode latency: 8.58 sec
Prefill latency: 0.81 sec
Bandwidth achieved: 4216.08 GB/s
FLOPS achieved: 21.08 TF/s

Prefill latency: 0.8088551929686219 sec
Decode latency: 8.513759435038082 sec
Time for inference 8: 9.32 sec total, 1757.28 tokens/sec
Decode latency: 8.51 sec
Prefill latency: 0.81 sec
Bandwidth achieved: 4245.66 GB/s
FLOPS achieved: 21.23 TF/s

Prefill latency: 0.8088004189776257 sec
Decode latency: 8.49363624502439 sec
Time for inference 9: 9.30 sec total, 1761.06 tokens/sec
Decode latency: 8.49 sec
Prefill latency: 0.81 sec
Bandwidth achieved: 4254.80 GB/s
FLOPS achieved: 21.27 TF/s

Prefill latency: 0.8155019329860806 sec
Decode latency: 8.577196388039738 sec
Time for inference 10: 9.39 sec total, 1744.14 tokens/sec
Decode latency: 8.58 sec
Prefill latency: 0.82 sec
Bandwidth achieved: 4213.91 GB/s
FLOPS achieved: 21.07 TF/s

==========
Batch Size: 64
Prompt Length: 1024
Generated tokens: 256
Average decode latency: 8.5571 sec
Average prefill latency: 0.8109 sec
Average tokens/sec: 1748.76
Memory used: 43.73 GB
Done. we are killing the process
