flash_kv_decode is set to True
Using device=cuda
Loading model ...
GPTParallel(
  (tok_embeddings): Embedding(49152, 1536)
  (layers): ModuleList(
    (0-39): 40 x ParallelTransformerBlock(
      semi_compiled = False
      (attention): FuseAttentionMLP(
        (wqkv1): Linear(in_features=1536, out_features=10752, bias=False)
        (wo): Linear(in_features=1536, out_features=1536, bias=False)
        (w2): Linear(in_features=4096, out_features=1536, bias=False)
      )
      (attention_norm): RMSNorm()
    )
  )
  (norm): RMSNorm()
  (output): Linear(in_features=1536, out_features=49152, bias=False)
)
Time to load model: 0.96 seconds
[rank0]:[W930 19:26:27.540668618 CUDAGraph.cpp:150] Warning: Waiting for pending NCCL work to finish before starting graph capture. (function operator())
Prefill latency: 0.6945650461129844 sec
Decode latency: 10.534801903995685 sec
Compilation time: 11.23 seconds
Prefill latency: 0.6971795179415494 sec
Decode latency: 10.525841613998637 sec
Prefill latency: 0.6974274649983272 sec
Decode latency: 10.52365891507361 sec
Prefill latency: 0.6962649959605187 sec
Decode latency: 10.528067491017282 sec
Prefill latency: 0.6962047410197556 sec
Decode latency: 10.534130375017412 sec
Prefill latency: 0.6971177000086755 sec
Decode latency: 10.536500034038909 sec
Time for inference 1: 11.23 sec total, 1458.35 tokens/sec
Decode latency: 10.54 sec
Prefill latency: 0.70 sec
Bandwidth achieved: 3156.43 GB/s
FLOPS achieved: 15.78 TF/s

Prefill latency: 0.6956501000095159 sec
Decode latency: 10.53418639593292 sec
Time for inference 2: 11.23 sec total, 1458.84 tokens/sec
Decode latency: 10.53 sec
Prefill latency: 0.70 sec
Bandwidth achieved: 3157.50 GB/s
FLOPS achieved: 15.79 TF/s

Prefill latency: 0.6960042238933966 sec
Decode latency: 10.532537530991249 sec
Time for inference 3: 11.23 sec total, 1458.98 tokens/sec
Decode latency: 10.53 sec
Prefill latency: 0.70 sec
Bandwidth achieved: 3157.80 GB/s
FLOPS achieved: 15.79 TF/s

Prefill latency: 0.6967381560243666 sec
Decode latency: 10.53354220604524 sec
Time for inference 4: 11.23 sec total, 1458.78 tokens/sec
Decode latency: 10.53 sec
Prefill latency: 0.70 sec
Bandwidth achieved: 3157.37 GB/s
FLOPS achieved: 15.79 TF/s

Prefill latency: 0.6953730640234426 sec
Decode latency: 10.529786917963065 sec
Time for inference 5: 11.23 sec total, 1459.42 tokens/sec
Decode latency: 10.53 sec
Prefill latency: 0.70 sec
Bandwidth achieved: 3158.74 GB/s
FLOPS achieved: 15.79 TF/s

Prefill latency: 0.695873114047572 sec
Decode latency: 10.537351547041908 sec
Time for inference 6: 11.23 sec total, 1458.39 tokens/sec
Decode latency: 10.54 sec
Prefill latency: 0.70 sec
Bandwidth achieved: 3156.52 GB/s
FLOPS achieved: 15.78 TF/s

Prefill latency: 0.6952770230127499 sec
Decode latency: 10.533745122957043 sec
Time for inference 7: 11.23 sec total, 1458.95 tokens/sec
Decode latency: 10.53 sec
Prefill latency: 0.70 sec
Bandwidth achieved: 3157.73 GB/s
FLOPS achieved: 15.79 TF/s

Prefill latency: 0.6959410569397733 sec
Decode latency: 10.540689983055927 sec
Time for inference 8: 11.24 sec total, 1457.95 tokens/sec
Decode latency: 10.54 sec
Prefill latency: 0.70 sec
Bandwidth achieved: 3155.56 GB/s
FLOPS achieved: 15.78 TF/s

Prefill latency: 0.6969493220094591 sec
Decode latency: 10.53943686990533 sec
Time for inference 9: 11.24 sec total, 1457.98 tokens/sec
Decode latency: 10.54 sec
Prefill latency: 0.70 sec
Bandwidth achieved: 3155.64 GB/s
FLOPS achieved: 15.78 TF/s

Prefill latency: 0.695330747985281 sec
Decode latency: 10.531735050026327 sec
Time for inference 10: 11.23 sec total, 1459.20 tokens/sec
Decode latency: 10.53 sec
Prefill latency: 0.70 sec
Bandwidth achieved: 3158.27 GB/s
FLOPS achieved: 15.79 TF/s

==========
Batch Size: 64
Prompt Length: 1024
Generated tokens: 256
Average decode latency: 10.5350 sec
Average prefill latency: 0.6960 sec
Average tokens/sec: 1458.68
Memory used: 29.39 GB
Done. we are killing the process
