W1001 01:22:44.697000 22513277204288 torch/distributed/run.py:779] 
W1001 01:22:44.697000 22513277204288 torch/distributed/run.py:779] *****************************************
W1001 01:22:44.697000 22513277204288 torch/distributed/run.py:779] Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
W1001 01:22:44.697000 22513277204288 torch/distributed/run.py:779] *****************************************
flash_kv_decode is set to True
Using device=cuda
Loading model ...
GPTLadder(
  (tok_embeddings): Embedding(49152, 1536)
  (layers): ModuleList(
    (0-39): 40 x LadderTransformerBlock(
      semi_compiled = False
      (attention): Attention(
        (wqkv): Linear(in_features=1536, out_features=2304, bias=False)
        (wo): Linear(in_features=768, out_features=1536, bias=False)
      )
      (feed_forward): FeedForward(
        (w1): Linear(in_features=1536, out_features=4096, bias=False)
        (w2): Linear(in_features=2048, out_features=1536, bias=False)
      )
      (ffn_norm): RMSNorm()
      (attention_norm): RMSNorm()
    )
  )
  (norm): RMSNorm()
  (output): Linear(in_features=1536, out_features=49152, bias=False)
)
Time to load model: 0.13 seconds
[rank0]:[W1001 01:22:52.671646579 CUDAGraph.cpp:150] Warning: Waiting for pending NCCL work to finish before starting graph capture. (function operator())
Prefill latency: 0.448495959979482 sec
Decode latency: 5.23026906803716 sec
Compilation time: 5.74 seconds
Compilation time: 5.68 seconds
Prefill latency: 0.4495400410378352 sec
Decode latency: 5.22492733807303 sec
Prefill latency: 0.4492675530491397 sec
Decode latency: 5.226958354003727 sec
Prefill latency: 0.4487979559926316 sec
Decode latency: 5.227043080027215 sec
Prefill latency: 0.4497047800105065 sec
Decode latency: 5.225108383921906 sec
Prefill latency: 0.44885087094735354 sec
Decode latency: 5.223716373089701 sec
Time for inference 1: 5.67 sec total, 2887.80 tokens/sec
Decode latency: 5.22 sec
Prefill latency: 0.45 sec
Bandwidth achieved: 3707.08 GB/s
FLOPS achieved: 18.54 TF/s

Prefill latency: 0.4490613320376724 sec
Decode latency: 5.22724278701935 sec
Time for inference 2: 5.68 sec total, 2885.90 tokens/sec
Decode latency: 5.23 sec
Prefill latency: 0.45 sec
Bandwidth achieved: 3704.65 GB/s
FLOPS achieved: 18.52 TF/s

Prefill latency: 0.4494271329604089 sec
Decode latency: 5.225510526099242 sec
Time for inference 3: 5.68 sec total, 2886.66 tokens/sec
Decode latency: 5.23 sec
Prefill latency: 0.45 sec
Bandwidth achieved: 3705.62 GB/s
FLOPS achieved: 18.53 TF/s

Prefill latency: 0.44974663096945733 sec
Decode latency: 5.225386863923632 sec
Time for inference 4: 5.68 sec total, 2886.56 tokens/sec
Decode latency: 5.23 sec
Prefill latency: 0.45 sec
Bandwidth achieved: 3705.49 GB/s
FLOPS achieved: 18.53 TF/s

Prefill latency: 0.4494273189920932 sec
Decode latency: 5.225432708044536 sec
Time for inference 5: 5.68 sec total, 2886.61 tokens/sec
Decode latency: 5.23 sec
Prefill latency: 0.45 sec
Bandwidth achieved: 3705.56 GB/s
FLOPS achieved: 18.53 TF/s

Prefill latency: 0.44891398900654167 sec
Decode latency: 5.2247785601066425 sec
Time for inference 6: 5.67 sec total, 2887.18 tokens/sec
Decode latency: 5.22 sec
Prefill latency: 0.45 sec
Bandwidth achieved: 3706.29 GB/s
FLOPS achieved: 18.53 TF/s

Prefill latency: 0.44919892493635416 sec
Decode latency: 5.226181208039634 sec
Time for inference 7: 5.68 sec total, 2886.37 tokens/sec
Decode latency: 5.23 sec
Prefill latency: 0.45 sec
Bandwidth achieved: 3705.25 GB/s
FLOPS achieved: 18.53 TF/s

Prefill latency: 0.4503670509438962 sec
Decode latency: 5.223404523101635 sec
Time for inference 8: 5.67 sec total, 2887.29 tokens/sec
Decode latency: 5.22 sec
Prefill latency: 0.45 sec
Bandwidth achieved: 3706.43 GB/s
FLOPS achieved: 18.53 TF/s

Prefill latency: 0.4498219400411472 sec
Decode latency: 5.226224191952497 sec
Time for inference 9: 5.68 sec total, 2886.08 tokens/sec
Decode latency: 5.23 sec
Prefill latency: 0.45 sec
Bandwidth achieved: 3704.87 GB/s
FLOPS achieved: 18.52 TF/s

Prefill latency: 0.4495364569593221 sec
Decode latency: 5.224935124046169 sec
Time for inference 10: 5.68 sec total, 2886.79 tokens/sec
Decode latency: 5.22 sec
Prefill latency: 0.45 sec
Bandwidth achieved: 3705.79 GB/s
FLOPS achieved: 18.53 TF/s

==========
Batch Size: 64
Prompt Length: 1024
Generated tokens: 256
Average decode latency: 5.2253 sec
Average prefill latency: 0.4494 sec
Average tokens/sec: 2886.72
Memory used: 41.38 GB
Done. we are killing the process
