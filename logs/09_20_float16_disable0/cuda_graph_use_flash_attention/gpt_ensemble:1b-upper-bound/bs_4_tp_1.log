flash_kv_decode is set to True
Using device=cuda
Loading model ...
GPTEnsemble(
  (tok_embeddings): Embedding(49152, 1536)
  (layers): ModuleList(
    (0-39): 40 x EnsembleTransformerBlock(
      semi_compiled = False
      (attention): Attention(
        (wqkv): Linear(in_features=1536, out_features=4608, bias=False)
        (wo): Linear(in_features=1536, out_features=1536, bias=False)
      )
      (feed_forward): FeedForward(
        (w1): Linear(in_features=1536, out_features=8192, bias=False)
        (w2): Linear(in_features=4096, out_features=1536, bias=False)
      )
      (ffn_norm): RMSNorm()
      (attention_norm): RMSNorm()
    )
  )
  (norm): RMSNorm()
  (output): Linear(in_features=1536, out_features=49152, bias=False)
)
Time to load model: 0.99 seconds
Prefill latency: 0.055750339990481734 sec
Decode latency: 2.4359491439536214 sec
Compilation time: 2.49 seconds
Prefill latency: 0.055553429992869496 sec
Decode latency: 2.4278313679387793 sec
Prefill latency: 0.055365837062709033 sec
Decode latency: 2.379696831922047 sec
Prefill latency: 0.055305646965280175 sec
Decode latency: 2.4279371839948 sec
Prefill latency: 0.05532398505602032 sec
Decode latency: 2.427925324998796 sec
Prefill latency: 0.0553647760534659 sec
Decode latency: 2.4283092659898102 sec
Time for inference 1: 2.48 sec total, 412.18 tokens/sec
Decode latency: 2.43 sec
Prefill latency: 0.06 sec
Bandwidth achieved: 995.91 GB/s
FLOPS achieved: 4.98 TF/s

Prefill latency: 0.05532805097755045 sec
Decode latency: 2.4270964099559933 sec
Time for inference 2: 2.48 sec total, 412.39 tokens/sec
Decode latency: 2.43 sec
Prefill latency: 0.06 sec
Bandwidth achieved: 996.41 GB/s
FLOPS achieved: 4.98 TF/s

Prefill latency: 0.055444219964556396 sec
Decode latency: 2.427547530969605 sec
Time for inference 3: 2.48 sec total, 412.30 tokens/sec
Decode latency: 2.43 sec
Prefill latency: 0.06 sec
Bandwidth achieved: 996.18 GB/s
FLOPS achieved: 4.98 TF/s

Prefill latency: 0.05546577798668295 sec
Decode latency: 2.42833988298662 sec
Time for inference 4: 2.48 sec total, 412.17 tokens/sec
Decode latency: 2.43 sec
Prefill latency: 0.06 sec
Bandwidth achieved: 995.86 GB/s
FLOPS achieved: 4.98 TF/s

Prefill latency: 0.05534642399288714 sec
Decode latency: 2.428139996016398 sec
Time for inference 5: 2.48 sec total, 412.22 tokens/sec
Decode latency: 2.43 sec
Prefill latency: 0.06 sec
Bandwidth achieved: 996.00 GB/s
FLOPS achieved: 4.98 TF/s

Prefill latency: 0.05539912905078381 sec
Decode latency: 2.428107521031052 sec
Time for inference 6: 2.48 sec total, 412.21 tokens/sec
Decode latency: 2.43 sec
Prefill latency: 0.06 sec
Bandwidth achieved: 995.98 GB/s
FLOPS achieved: 4.98 TF/s

Prefill latency: 0.05546312499791384 sec
Decode latency: 2.4287430710392073 sec
Time for inference 7: 2.48 sec total, 412.10 tokens/sec
Decode latency: 2.43 sec
Prefill latency: 0.06 sec
Bandwidth achieved: 995.70 GB/s
FLOPS achieved: 4.98 TF/s

Prefill latency: 0.05529850104358047 sec
Decode latency: 2.428344280924648 sec
Time for inference 8: 2.48 sec total, 412.19 tokens/sec
Decode latency: 2.43 sec
Prefill latency: 0.06 sec
Bandwidth achieved: 995.92 GB/s
FLOPS achieved: 4.98 TF/s

Prefill latency: 0.05534427997190505 sec
Decode latency: 2.4123563980683684 sec
Time for inference 9: 2.47 sec total, 414.82 tokens/sec
Decode latency: 2.41 sec
Prefill latency: 0.06 sec
Bandwidth achieved: 1002.26 GB/s
FLOPS achieved: 5.01 TF/s

Prefill latency: 0.05537368101067841 sec
Decode latency: 2.4284712630324066 sec
Time for inference 10: 2.48 sec total, 412.14 tokens/sec
Decode latency: 2.43 sec
Prefill latency: 0.06 sec
Bandwidth achieved: 995.79 GB/s
FLOPS achieved: 4.98 TF/s

==========
Batch Size: 4
Prompt Length: 1024
Generated tokens: 256
Average decode latency: 2.4265 sec
Average prefill latency: 0.0554 sec
Average tokens/sec: 412.47
Memory used: 5.37 GB
Done. we are killing the process
