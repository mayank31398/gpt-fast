flash_kv_decode is set to True
Using device=cuda
Loading model ...
GPTEnsemble(
  (tok_embeddings): Embedding(49152, 2304)
  (layers): ModuleList(
    (0-39): 40 x EnsembleTransformerBlock(
      semi_compiled = False
      (attention): Attention(
        (wqkv): Linear(in_features=2304, out_features=6912, bias=False)
        (wo): Linear(in_features=2304, out_features=2304, bias=False)
      )
      (feed_forward): FeedForward(
        (w1): Linear(in_features=2304, out_features=18432, bias=False)
        (w2): Linear(in_features=9216, out_features=2304, bias=False)
      )
      (ffn_norm): RMSNorm()
      (attention_norm): RMSNorm()
    )
  )
  (norm): RMSNorm()
  (output): Linear(in_features=2304, out_features=49152, bias=False)
)
Time to load model: 1.58 seconds
[rank0]:[W1001 02:34:50.871493630 CUDAGraph.cpp:150] Warning: Waiting for pending NCCL work to finish before starting graph capture. (function operator())
Prefill latency: 0.3993744970066473 sec
Decode latency: 5.24372923199553 sec
Compilation time: 5.64 seconds
Prefill latency: 0.3976915000239387 sec
Decode latency: 5.2414873039815575 sec
Prefill latency: 0.398158994037658 sec
Decode latency: 5.241260458948091 sec
Prefill latency: 0.39841650694143027 sec
Decode latency: 5.2408684639958665 sec
Prefill latency: 0.398208710947074 sec
Decode latency: 5.240946686011739 sec
Prefill latency: 0.39857792598195374 sec
Decode latency: 5.241922729997896 sec
Time for inference 1: 5.64 sec total, 726.08 tokens/sec
Decode latency: 5.24 sec
Prefill latency: 0.40 sec
Bandwidth achieved: 5098.24 GB/s
FLOPS achieved: 25.49 TF/s

Prefill latency: 0.3982561599696055 sec
Decode latency: 5.24113333504647 sec
Time for inference 2: 5.64 sec total, 726.21 tokens/sec
Decode latency: 5.24 sec
Prefill latency: 0.40 sec
Bandwidth achieved: 5099.18 GB/s
FLOPS achieved: 25.50 TF/s

Prefill latency: 0.40064629004336894 sec
Decode latency: 5.240721757058054 sec
Time for inference 3: 5.64 sec total, 725.96 tokens/sec
Decode latency: 5.24 sec
Prefill latency: 0.40 sec
Bandwidth achieved: 5097.45 GB/s
FLOPS achieved: 25.49 TF/s

Prefill latency: 0.40240721695590764 sec
Decode latency: 5.2544277319684625 sec
Time for inference 4: 5.66 sec total, 723.99 tokens/sec
Decode latency: 5.25 sec
Prefill latency: 0.40 sec
Bandwidth achieved: 5083.58 GB/s
FLOPS achieved: 25.42 TF/s

Prefill latency: 0.39929098589345813 sec
Decode latency: 5.2527747069252655 sec
Time for inference 5: 5.65 sec total, 724.60 tokens/sec
Decode latency: 5.25 sec
Prefill latency: 0.40 sec
Bandwidth achieved: 5087.91 GB/s
FLOPS achieved: 25.44 TF/s

Prefill latency: 0.4014582160161808 sec
Decode latency: 5.254647067980841 sec
Time for inference 6: 5.66 sec total, 724.08 tokens/sec
Decode latency: 5.25 sec
Prefill latency: 0.40 sec
Bandwidth achieved: 5084.20 GB/s
FLOPS achieved: 25.42 TF/s

Prefill latency: 0.39938415098004043 sec
Decode latency: 5.255408548051491 sec
Time for inference 7: 5.66 sec total, 724.23 tokens/sec
Decode latency: 5.26 sec
Prefill latency: 0.40 sec
Bandwidth achieved: 5085.25 GB/s
FLOPS achieved: 25.43 TF/s

Prefill latency: 0.3996431379346177 sec
Decode latency: 5.24237507302314 sec
Time for inference 8: 5.64 sec total, 725.87 tokens/sec
Decode latency: 5.24 sec
Prefill latency: 0.40 sec
Bandwidth achieved: 5096.82 GB/s
FLOPS achieved: 25.48 TF/s

Prefill latency: 0.39790343795903027 sec
Decode latency: 5.2411278440849856 sec
Time for inference 9: 5.64 sec total, 726.27 tokens/sec
Decode latency: 5.24 sec
Prefill latency: 0.40 sec
Bandwidth achieved: 5099.58 GB/s
FLOPS achieved: 25.50 TF/s

Prefill latency: 0.3982975999824703 sec
Decode latency: 5.254788711084984 sec
Time for inference 10: 5.65 sec total, 724.46 tokens/sec
Decode latency: 5.25 sec
Prefill latency: 0.40 sec
Bandwidth achieved: 5086.88 GB/s
FLOPS achieved: 25.43 TF/s

==========
Batch Size: 16
Prompt Length: 1024
Generated tokens: 256
Average decode latency: 5.2479 sec
Average prefill latency: 0.3996 sec
Average tokens/sec: 725.17
Memory used: 21.44 GB
Done. we are killing the process
