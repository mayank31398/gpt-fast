W1114 09:43:27.730000 3634592 site-packages/torch/distributed/run.py:793] 
W1114 09:43:27.730000 3634592 site-packages/torch/distributed/run.py:793] *****************************************
W1114 09:43:27.730000 3634592 site-packages/torch/distributed/run.py:793] Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
W1114 09:43:27.730000 3634592 site-packages/torch/distributed/run.py:793] *****************************************
flash_kv_decode is set to False
Using device=cuda
Loading model ...
GPTLadder(
  (tok_embeddings): Embedding(128256, 4096)
  (layers): ModuleList(
    (0-31): 32 x LadderTransformerBlock(
      semi_compiled = False
      (attention): Attention(
        (wqkv): Linear(in_features=4096, out_features=1536, bias=False)
        (wo): Linear(in_features=1024, out_features=4096, bias=False)
      )
      (feed_forward): FeedForward(
        (w1): Linear(in_features=4096, out_features=7168, bias=False)
        (w2): Linear(in_features=3584, out_features=4096, bias=False)
      )
      (ffn_norm): RMSNorm()
      (attention_norm): RMSNorm()
    )
  )
  (norm): RMSNorm()
  (output): Linear(in_features=4096, out_features=128256, bias=False)
)
Time to load model: 0.06 seconds
/dccstor/mayankmish2/miniconda3/envs/ai/lib/python3.10/contextlib.py:103: FutureWarning: `torch.backends.cuda.sdp_kernel()` is deprecated. In the future, this context manager will be removed. Please see `torch.nn.attention.sdpa_kernel()` for the new context manager, with updated signature.
  self.gen = func(*args, **kwds)
/dccstor/mayankmish2/miniconda3/envs/ai/lib/python3.10/contextlib.py:103: FutureWarning: `torch.backends.cuda.sdp_kernel()` is deprecated. In the future, this context manager will be removed. Please see `torch.nn.attention.sdpa_kernel()` for the new context manager, with updated signature.
  self.gen = func(*args, **kwds)
/dccstor/mayankmish2/miniconda3/envs/ai/lib/python3.10/contextlib.py:103: FutureWarning: `torch.backends.cuda.sdp_kernel()` is deprecated. In the future, this context manager will be removed. Please see `torch.nn.attention.sdpa_kernel()` for the new context manager, with updated signature.
  self.gen = func(*args, **kwds)
Compiling prefill with dynamic=False
/dccstor/mayankmish2/miniconda3/envs/ai/lib/python3.10/contextlib.py:103: FutureWarning: `torch.backends.cuda.sdp_kernel()` is deprecated. In the future, this context manager will be removed. Please see `torch.nn.attention.sdpa_kernel()` for the new context manager, with updated signature.
  self.gen = func(*args, **kwds)
/dccstor/mayankmish2/miniconda3/envs/ai/lib/python3.10/site-packages/torch/_inductor/compile_fx.py:222: UserWarning: TensorFloat32 tensor cores for float32 matrix multiplication available but not enabled. Consider setting `torch.set_float32_matmul_precision('high')` for better performance.
  warnings.warn(
/dccstor/mayankmish2/miniconda3/envs/ai/lib/python3.10/site-packages/torch/_inductor/compile_fx.py:222: UserWarning: TensorFloat32 tensor cores for float32 matrix multiplication available but not enabled. Consider setting `torch.set_float32_matmul_precision('high')` for better performance.
  warnings.warn(
/dccstor/mayankmish2/miniconda3/envs/ai/lib/python3.10/site-packages/torch/_inductor/compile_fx.py:222: UserWarning: TensorFloat32 tensor cores for float32 matrix multiplication available but not enabled. Consider setting `torch.set_float32_matmul_precision('high')` for better performance.
  warnings.warn(
/dccstor/mayankmish2/miniconda3/envs/ai/lib/python3.10/site-packages/torch/_inductor/compile_fx.py:222: UserWarning: TensorFloat32 tensor cores for float32 matrix multiplication available but not enabled. Consider setting `torch.set_float32_matmul_precision('high')` for better performance.
  warnings.warn(
Prefill latency: 42.00533174490556 sec
/dccstor/mayankmish2/miniconda3/envs/ai/lib/python3.10/contextlib.py:103: FutureWarning: `torch.backends.cuda.sdp_kernel()` is deprecated. In the future, this context manager will be removed. Please see `torch.nn.attention.sdpa_kernel()` for the new context manager, with updated signature.
  self.gen = func(*args, **kwds)
/dccstor/mayankmish2/miniconda3/envs/ai/lib/python3.10/contextlib.py:103: FutureWarning: `torch.backends.cuda.sdp_kernel()` is deprecated. In the future, this context manager will be removed. Please see `torch.nn.attention.sdpa_kernel()` for the new context manager, with updated signature.
  self.gen = func(*args, **kwds)
/dccstor/mayankmish2/miniconda3/envs/ai/lib/python3.10/contextlib.py:103: FutureWarning: `torch.backends.cuda.sdp_kernel()` is deprecated. In the future, this context manager will be removed. Please see `torch.nn.attention.sdpa_kernel()` for the new context manager, with updated signature.
  self.gen = func(*args, **kwds)
/dccstor/mayankmish2/miniconda3/envs/ai/lib/python3.10/contextlib.py:103: FutureWarning: `torch.backends.cuda.sdp_kernel()` is deprecated. In the future, this context manager will be removed. Please see `torch.nn.attention.sdpa_kernel()` for the new context manager, with updated signature.
  self.gen = func(*args, **kwds)
/dccstor/mayankmish2/miniconda3/envs/ai/lib/python3.10/contextlib.py:103: FutureWarning: `torch.backends.cuda.sdp_kernel()` is deprecated. In the future, this context manager will be removed. Please see `torch.nn.attention.sdpa_kernel()` for the new context manager, with updated signature.
  self.gen = func(*args, **kwds)
/dccstor/mayankmish2/miniconda3/envs/ai/lib/python3.10/contextlib.py:103: FutureWarning: `torch.backends.cuda.sdp_kernel()` is deprecated. In the future, this context manager will be removed. Please see `torch.nn.attention.sdpa_kernel()` for the new context manager, with updated signature.
  self.gen = func(*args, **kwds)
/dccstor/mayankmish2/miniconda3/envs/ai/lib/python3.10/contextlib.py:103: FutureWarning: `torch.backends.cuda.sdp_kernel()` is deprecated. In the future, this context manager will be removed. Please see `torch.nn.attention.sdpa_kernel()` for the new context manager, with updated signature.
  self.gen = func(*args, **kwds)
/dccstor/mayankmish2/miniconda3/envs/ai/lib/python3.10/contextlib.py:103: FutureWarning: `torch.backends.cuda.sdp_kernel()` is deprecated. In the future, this context manager will be removed. Please see `torch.nn.attention.sdpa_kernel()` for the new context manager, with updated signature.
  self.gen = func(*args, **kwds)
/dccstor/mayankmish2/miniconda3/envs/ai/lib/python3.10/contextlib.py:103: FutureWarning: `torch.backends.cuda.sdp_kernel()` is deprecated. In the future, this context manager will be removed. Please see `torch.nn.attention.sdpa_kernel()` for the new context manager, with updated signature.
  self.gen = func(*args, **kwds)
/dccstor/mayankmish2/miniconda3/envs/ai/lib/python3.10/contextlib.py:103: FutureWarning: `torch.backends.cuda.sdp_kernel()` is deprecated. In the future, this context manager will be removed. Please see `torch.nn.attention.sdpa_kernel()` for the new context manager, with updated signature.
  self.gen = func(*args, **kwds)
/dccstor/mayankmish2/miniconda3/envs/ai/lib/python3.10/contextlib.py:103: FutureWarning: `torch.backends.cuda.sdp_kernel()` is deprecated. In the future, this context manager will be removed. Please see `torch.nn.attention.sdpa_kernel()` for the new context manager, with updated signature.
  self.gen = func(*args, **kwds)
/dccstor/mayankmish2/miniconda3/envs/ai/lib/python3.10/contextlib.py:103: FutureWarning: `torch.backends.cuda.sdp_kernel()` is deprecated. In the future, this context manager will be removed. Please see `torch.nn.attention.sdpa_kernel()` for the new context manager, with updated signature.
  self.gen = func(*args, **kwds)
Decode latency: 49.210192755796015 sec
Compilation time: 91.23 seconds
Compilation time: 91.23 seconds
Compilation time: 91.23 seconds
Compilation time: 91.22 seconds
Prefill latency: 0.8246442321687937 sec
/dccstor/mayankmish2/miniconda3/envs/ai/lib/python3.10/contextlib.py:103: FutureWarning: `torch.backends.cuda.sdp_kernel()` is deprecated. In the future, this context manager will be removed. Please see `torch.nn.attention.sdpa_kernel()` for the new context manager, with updated signature.
  self.gen = func(*args, **kwds)
/dccstor/mayankmish2/miniconda3/envs/ai/lib/python3.10/contextlib.py:103: FutureWarning: `torch.backends.cuda.sdp_kernel()` is deprecated. In the future, this context manager will be removed. Please see `torch.nn.attention.sdpa_kernel()` for the new context manager, with updated signature.
  self.gen = func(*args, **kwds)
/dccstor/mayankmish2/miniconda3/envs/ai/lib/python3.10/contextlib.py:103: FutureWarning: `torch.backends.cuda.sdp_kernel()` is deprecated. In the future, this context manager will be removed. Please see `torch.nn.attention.sdpa_kernel()` for the new context manager, with updated signature.
  self.gen = func(*args, **kwds)
/dccstor/mayankmish2/miniconda3/envs/ai/lib/python3.10/contextlib.py:103: FutureWarning: `torch.backends.cuda.sdp_kernel()` is deprecated. In the future, this context manager will be removed. Please see `torch.nn.attention.sdpa_kernel()` for the new context manager, with updated signature.
  self.gen = func(*args, **kwds)
Decode latency: 1.5280094943009317 sec
Prefill latency: 0.023273851722478867 sec
Decode latency: 1.5275509236380458 sec
Prefill latency: 0.021973883733153343 sec
Decode latency: 1.5269715022295713 sec
Prefill latency: 0.02313053933903575 sec
Decode latency: 1.5284936837852001 sec
Prefill latency: 0.022013465873897076 sec
Decode latency: 1.527532042004168 sec
Time for inference 1: 1.55 sec total, 329.99 tokens/sec
Decode latency: 1.53 sec
Prefill latency: 0.02 sec
Bandwidth achieved: 1498.46 GB/s
FLOPS achieved: 4.50 TF/s

Prefill latency: 0.022855654824525118 sec
Decode latency: 1.5277100219391286 sec
Time for inference 2: 1.55 sec total, 329.78 tokens/sec
Decode latency: 1.53 sec
Prefill latency: 0.02 sec
Bandwidth achieved: 1497.49 GB/s
FLOPS achieved: 4.49 TF/s

Prefill latency: 0.023346756119281054 sec
Decode latency: 1.5265192287042737 sec
Time for inference 3: 1.55 sec total, 329.93 tokens/sec
Decode latency: 1.53 sec
Prefill latency: 0.02 sec
Bandwidth achieved: 1498.18 GB/s
FLOPS achieved: 4.49 TF/s

Prefill latency: 0.022763872984796762 sec
Decode latency: 1.5267354720272124 sec
Time for inference 4: 1.55 sec total, 330.00 tokens/sec
Decode latency: 1.53 sec
Prefill latency: 0.02 sec
Bandwidth achieved: 1498.49 GB/s
FLOPS achieved: 4.50 TF/s

Prefill latency: 0.0219492856413126 sec
Decode latency: 1.5268161143176258 sec
Time for inference 5: 1.55 sec total, 330.16 tokens/sec
Decode latency: 1.53 sec
Prefill latency: 0.02 sec
Bandwidth achieved: 1499.23 GB/s
FLOPS achieved: 4.50 TF/s

Prefill latency: 0.02206140896305442 sec
Decode latency: 1.5267926333472133 sec
Time for inference 6: 1.55 sec total, 330.14 tokens/sec
Decode latency: 1.53 sec
Prefill latency: 0.02 sec
Bandwidth achieved: 1499.14 GB/s
FLOPS achieved: 4.50 TF/s

Prefill latency: 0.022557739168405533 sec
Decode latency: 1.5269578462466598 sec
Time for inference 7: 1.55 sec total, 330.03 tokens/sec
Decode latency: 1.53 sec
Prefill latency: 0.02 sec
Bandwidth achieved: 1498.60 GB/s
FLOPS achieved: 4.50 TF/s

Prefill latency: 0.023425057996064425 sec
Decode latency: 1.5277169030159712 sec
Time for inference 8: 1.55 sec total, 329.65 tokens/sec
Decode latency: 1.53 sec
Prefill latency: 0.02 sec
Bandwidth achieved: 1496.91 GB/s
FLOPS achieved: 4.49 TF/s

Prefill latency: 0.022900747135281563 sec
Decode latency: 1.526876965072006 sec
Time for inference 9: 1.55 sec total, 329.95 tokens/sec
Decode latency: 1.53 sec
Prefill latency: 0.02 sec
Bandwidth achieved: 1498.26 GB/s
FLOPS achieved: 4.49 TF/s

Prefill latency: 0.022650450933724642 sec
Decode latency: 1.5261904611252248 sec
Time for inference 10: 1.55 sec total, 330.14 tokens/sec
Decode latency: 1.53 sec
Prefill latency: 0.02 sec
Bandwidth achieved: 1499.13 GB/s
FLOPS achieved: 4.50 TF/s

==========
Batch Size: 1
Prompt Length: 1024
Generated tokens: 512
Average decode latency: 1.5270 sec
Average prefill latency: 0.0227 sec
Average tokens/sec: 329.98
Memory used: 6.65 GB
Done. we are killing the process
[rank0]:[W1114 09:45:30.211772592 ProcessGroupNCCL.cpp:1374] Warning: WARNING: process group has NOT been destroyed before we destruct ProcessGroupNCCL. On normal program exit, the application should call destroy_process_group to ensure that any pending NCCL operations have finished in this process. In rare cases this process can exit before this point and block the progress of another member of the process group. This constraint has always been present,  but this warning has only been added since PyTorch 2.4 (function operator())
